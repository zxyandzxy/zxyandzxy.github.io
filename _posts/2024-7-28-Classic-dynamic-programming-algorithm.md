---
layout: post
title: "ç»å…¸åŠ¨æ€è§„åˆ’ç®—æ³•"
date: 2024-7-28
tags: [labuladong]
comments: true
author: zxy
---

# åŠ¨æ€è§„åˆ’åŸºæœ¬æŠ€å·§

## åŠ¨æ€è§„åˆ’è®¾è®¡ï¼šæœ€é•¿é€’å¢å­åºåˆ—

åŠ¨æ€è§„åˆ’çš„å¥—è·¯ï¼šæ‰¾åˆ°äº†é—®é¢˜çš„ã€ŒçŠ¶æ€ã€ï¼Œæ˜ç¡®äº† `dp` æ•°ç»„/å‡½æ•°çš„å«ä¹‰ï¼Œå®šä¹‰äº† base caseï¼›ä½†æ˜¯ä¸çŸ¥é“å¦‚ä½•ç¡®å®šã€Œé€‰æ‹©ã€ï¼Œä¹Ÿå°±æ˜¯æ‰¾ä¸åˆ°çŠ¶æ€è½¬ç§»çš„å…³ç³»ï¼Œä¾ç„¶å†™ä¸å‡ºåŠ¨æ€è§„åˆ’è§£æ³•ï¼Œæ€ä¹ˆåŠï¼Ÿ

ä¸è¦æ‹…å¿ƒï¼ŒåŠ¨æ€è§„åˆ’çš„éš¾ç‚¹æœ¬æ¥å°±åœ¨äºå¯»æ‰¾æ­£ç¡®çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œæœ¬æ–‡å°±å€ŸåŠ©ç»å…¸çš„ã€Œæœ€é•¿é€’å¢å­åºåˆ—é—®é¢˜ã€æ¥è®²ä¸€è®²è®¾è®¡åŠ¨æ€è§„åˆ’çš„é€šç”¨æŠ€å·§ï¼š**æ•°å­¦å½’çº³æ€æƒ³**ã€‚

æœ€é•¿é€’å¢å­åºåˆ—ï¼ˆLongest Increasing Subsequenceï¼Œç®€å†™ LISï¼‰æ˜¯éå¸¸ç»å…¸çš„ä¸€ä¸ªç®—æ³•é—®é¢˜ï¼Œæ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„æ˜¯åŠ¨æ€è§„åˆ’è§£æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ O(N^2)ï¼Œæˆ‘ä»¬å€Ÿè¿™ä¸ªé—®é¢˜æ¥ç”±æµ…å…¥æ·±è®²è§£å¦‚ä½•æ‰¾çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œå¦‚ä½•å†™å‡ºåŠ¨æ€è§„åˆ’è§£æ³•ã€‚æ¯”è¾ƒéš¾æƒ³åˆ°çš„æ˜¯åˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(NlogN)ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ç§ç®€å•çš„çº¸ç‰Œæ¸¸æˆæ¥è¾…åŠ©ç†è§£è¿™ç§å·§å¦™çš„è§£æ³•ã€‚

> é¢˜ç›®

è¾“å…¥ä¸€ä¸ªæ— åºçš„æ•´æ•°æ•°ç»„ï¼Œè¯·ä½ æ‰¾åˆ°å…¶ä¸­æœ€é•¿çš„ä¸¥æ ¼é€’å¢å­åºåˆ—çš„é•¿åº¦ï¼Œå‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

```cpp
int lengthOfLIS(int[] nums);
```

æ¯”å¦‚è¯´è¾“å…¥ `nums=[10,9,2,5,3,7,101,18]`ï¼Œå…¶ä¸­æœ€é•¿çš„é€’å¢å­åºåˆ—æ˜¯ `[2,3,7,101]`ï¼Œæ‰€ä»¥ç®—æ³•çš„è¾“å‡ºåº”è¯¥æ˜¯ 4ã€‚

æ³¨æ„ã€Œå­åºåˆ—ã€å’Œã€Œå­ä¸²ã€è¿™ä¸¤ä¸ªåè¯çš„åŒºåˆ«ï¼Œå­ä¸²ä¸€å®šæ˜¯è¿ç»­çš„ï¼Œè€Œå­åºåˆ—ä¸ä¸€å®šæ˜¯è¿ç»­çš„ã€‚ä¸‹é¢å…ˆæ¥è®¾è®¡åŠ¨æ€è§„åˆ’ç®—æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

### åŠ¨æ€è§„åˆ’è§£æ³•

åŠ¨æ€è§„åˆ’çš„æ ¸å¿ƒè®¾è®¡æ€æƒ³æ˜¯æ•°å­¦å½’çº³æ³•ã€‚

ç›¸ä¿¡å¤§å®¶å¯¹æ•°å­¦å½’çº³æ³•éƒ½ä¸é™Œç”Ÿï¼Œé«˜ä¸­å°±å­¦è¿‡ï¼Œè€Œä¸”æ€è·¯å¾ˆç®€å•ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³è¯æ˜ä¸€ä¸ªæ•°å­¦ç»“è®ºï¼Œé‚£ä¹ˆ**æˆ‘ä»¬å…ˆå‡è®¾è¿™ä¸ªç»“è®ºåœ¨ `k < n` æ—¶æˆç«‹ï¼Œç„¶åæ ¹æ®è¿™ä¸ªå‡è®¾ï¼Œæƒ³åŠæ³•æ¨å¯¼è¯æ˜å‡º `k = n` çš„æ—¶å€™æ­¤ç»“è®ºä¹Ÿæˆç«‹**ã€‚å¦‚æœèƒ½å¤Ÿè¯æ˜å‡ºæ¥ï¼Œé‚£ä¹ˆå°±è¯´æ˜è¿™ä¸ªç»“è®ºå¯¹äº `k` ç­‰äºä»»ä½•æ•°éƒ½æˆç«‹ã€‚

ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬è®¾è®¡åŠ¨æ€è§„åˆ’ç®—æ³•ï¼Œä¸æ˜¯éœ€è¦ä¸€ä¸ª dp æ•°ç»„å—ï¼Ÿæˆ‘ä»¬å¯ä»¥å‡è®¾ `dp[0...i-1]` éƒ½å·²ç»è¢«ç®—å‡ºæ¥äº†ï¼Œç„¶åé—®è‡ªå·±ï¼šæ€ä¹ˆé€šè¿‡è¿™äº›ç»“æœç®—å‡º `dp[i]`ï¼Ÿ

ç›´æ¥æ‹¿æœ€é•¿é€’å¢å­åºåˆ—è¿™ä¸ªé—®é¢˜ä¸¾ä¾‹ä½ å°±æ˜ç™½äº†ã€‚ä¸è¿‡ï¼Œé¦–å…ˆè¦å®šä¹‰æ¸…æ¥š dp æ•°ç»„çš„å«ä¹‰ï¼Œå³ `dp[i]` çš„å€¼åˆ°åº•ä»£è¡¨ç€ä»€ä¹ˆï¼Ÿ

**æˆ‘ä»¬çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š`dp[i]` è¡¨ç¤ºä»¥ `nums[i]` è¿™ä¸ªæ•°ç»“å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦**ã€‚

æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¨å‡º base caseï¼š`dp[i]` åˆå§‹å€¼ä¸º 1ï¼Œå› ä¸ºä»¥ `nums[i]` ç»“å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—èµ·ç è¦åŒ…å«å®ƒè‡ªå·±ã€‚

ä¸¾ä¸¤ä¸ªä¾‹å­ï¼š

![img](https://labuladong.online/algo/images/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/8.jpeg)

è¿™ä¸ª GIF å±•ç¤ºäº†ç®—æ³•æ¼”è¿›çš„è¿‡ç¨‹ï¼š

![img](https://labuladong.online/algo/images/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/gif1.gif)

æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼Œæˆ‘ä»¬çš„æœ€ç»ˆç»“æœï¼ˆå­åºåˆ—çš„æœ€å¤§é•¿åº¦ï¼‰åº”è¯¥æ˜¯ dp æ•°ç»„ä¸­çš„æœ€å¤§å€¼ã€‚

```java
int res = 0;
for (int i = 0; i < dp.length; i++) {
    res = Math.max(res, dp[i]);
}
return res;
```

è¯»è€…ä¹Ÿè®¸ä¼šé—®ï¼Œåˆšæ‰çš„ç®—æ³•æ¼”è¿›è¿‡ç¨‹ä¸­æ¯ä¸ª `dp[i]` çš„ç»“æœæ˜¯æˆ‘ä»¬è‚‰çœ¼çœ‹å‡ºæ¥çš„ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆè®¾è®¡ç®—æ³•é€»è¾‘æ¥æ­£ç¡®è®¡ç®—æ¯ä¸ª `dp[i]` å‘¢ï¼Ÿ

è¿™å°±æ˜¯åŠ¨æ€è§„åˆ’çš„é‡å¤´æˆï¼Œå¦‚ä½•è®¾è®¡ç®—æ³•é€»è¾‘è¿›è¡ŒçŠ¶æ€è½¬ç§»ï¼Œæ‰èƒ½æ­£ç¡®è¿è¡Œå‘¢ï¼Ÿè¿™é‡Œéœ€è¦ä½¿ç”¨æ•°å­¦å½’çº³çš„æ€æƒ³ï¼š

**å‡è®¾æˆ‘ä»¬å·²ç»çŸ¥é“äº† `dp[0..4]` çš„æ‰€æœ‰ç»“æœï¼Œæˆ‘ä»¬å¦‚ä½•é€šè¿‡è¿™äº›å·²çŸ¥ç»“æœæ¨å‡º `dp[5]` å‘¢**ï¼Ÿ

![img](https://labuladong.online/algo/images/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/6.jpeg)

æ ¹æ®åˆšæ‰æˆ‘ä»¬å¯¹ `dp` æ•°ç»„çš„å®šä¹‰ï¼Œç°åœ¨æƒ³æ±‚ `dp[5]` çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æƒ³æ±‚ä»¥ `nums[5]` ä¸ºç»“å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—ã€‚

**`nums[5] = 3`ï¼Œæ—¢ç„¶æ˜¯é€’å¢å­åºåˆ—ï¼Œæˆ‘ä»¬åªè¦æ‰¾åˆ°å‰é¢é‚£äº›ç»“å°¾æ¯” 3 å°çš„å­åºåˆ—ï¼Œç„¶åæŠŠ 3 æ¥åˆ°è¿™äº›å­åºåˆ—æœ«å°¾ï¼Œå°±å¯ä»¥å½¢æˆä¸€ä¸ªæ–°çš„é€’å¢å­åºåˆ—ï¼Œè€Œä¸”è¿™ä¸ªæ–°çš„å­åºåˆ—é•¿åº¦åŠ ä¸€**ã€‚

`nums[5]` å‰é¢æœ‰å“ªäº›å…ƒç´ å°äº `nums[5]`ï¼Ÿè¿™ä¸ªå¥½ç®—ï¼Œç”¨ for å¾ªç¯æ¯”è¾ƒä¸€æ³¢å°±èƒ½æŠŠè¿™äº›å…ƒç´ æ‰¾å‡ºæ¥ã€‚

ä»¥è¿™äº›å…ƒç´ ä¸ºç»“å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦æ˜¯å¤šå°‘ï¼Ÿå›é¡¾ä¸€ä¸‹æˆ‘ä»¬å¯¹ `dp` æ•°ç»„çš„å®šä¹‰ï¼Œå®ƒè®°å½•çš„æ­£æ˜¯ä»¥æ¯ä¸ªå…ƒç´ ä¸ºæœ«å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚

ä»¥æˆ‘ä»¬ä¸¾çš„ä¾‹å­æ¥è¯´ï¼Œ`nums[0]` å’Œ `nums[4]` éƒ½æ˜¯å°äº `nums[5]` çš„ï¼Œç„¶åå¯¹æ¯” `dp[0]` å’Œ `dp[4]` çš„å€¼ï¼Œæˆ‘ä»¬è®© `nums[5]` å’Œæ›´é•¿çš„é€’å¢å­åºåˆ—ç»“åˆï¼Œå¾—å‡º `dp[5] = 3`ï¼š

![img](https://labuladong.online/algo/images/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/7.jpeg)

```java
for (int j = 0; j < i; j++) {
    if (nums[i] > nums[j]) {
        dp[i] = Math.max(dp[i], dp[j] + 1);
    }
}
```

å½“ `i = 5` æ—¶ï¼Œè¿™æ®µä»£ç çš„é€»è¾‘å°±å¯ä»¥ç®—å‡º `dp[5]`ã€‚å…¶å®åˆ°è¿™é‡Œï¼Œè¿™é“ç®—æ³•é¢˜æˆ‘ä»¬å°±åŸºæœ¬åšå®Œäº†ã€‚

```java
for (int i = 0; i < nums.length; i++) {
    for (int j = 0; j < i; j++) {
        // å¯»æ‰¾ nums[0..j-1] ä¸­æ¯” nums[i] å°çš„å…ƒç´ 
        if (nums[i] > nums[j]) {
            // æŠŠ nums[i] æ¥åœ¨åé¢ï¼Œå³å¯å½¢æˆé•¿åº¦ä¸º dp[j] + 1ï¼Œ
            // ä¸”ä»¥ nums[i] ä¸ºç»“å°¾çš„é€’å¢å­åºåˆ—
            dp[i] = Math.max(dp[i], dp[j] + 1);
        }
    }
}
```

ç»“åˆæˆ‘ä»¬åˆšæ‰è¯´çš„ base caseï¼Œä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸‹å®Œæ•´ä»£ç ï¼š

```cpp
class Solution {
public:
    int lengthOfLIS(vector<int>& nums) {
        // å®šä¹‰ï¼šdp[i] è¡¨ç¤ºä»¥ nums[i] è¿™ä¸ªæ•°ç»“å°¾çš„æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦
        vector<int> dp(nums.size());
        // base caseï¼šdp æ•°ç»„å…¨éƒ½åˆå§‹åŒ–ä¸º 1
        fill(dp.begin(), dp.end(), 1);
        for (int i = 0; i < nums.size(); i++) {
            for (int j = 0; j < i; j++) {
                if (nums[i] > nums[j]) 
                    dp[i] = max(dp[i], dp[j] + 1);
            }
        }
        
        int res = 0;
        for (int i = 0; i < dp.size(); i++) {
            res = max(res, dp[i]);
        }
        return res;
    }
};
```

è‡³æ­¤ï¼Œè¿™é“é¢˜å°±è§£å†³äº†ï¼Œæ—¶é—´å¤æ‚åº¦ `O(N^2)`ã€‚æ€»ç»“ä¸€ä¸‹å¦‚ä½•æ‰¾åˆ°åŠ¨æ€è§„åˆ’çš„çŠ¶æ€è½¬ç§»å…³ç³»ï¼š

1ã€æ˜ç¡® `dp` æ•°ç»„çš„å®šä¹‰ã€‚è¿™ä¸€æ­¥å¯¹äºä»»ä½•åŠ¨æ€è§„åˆ’é—®é¢˜éƒ½å¾ˆé‡è¦ï¼Œå¦‚æœä¸å¾—å½“æˆ–è€…ä¸å¤Ÿæ¸…æ™°ï¼Œä¼šé˜»ç¢ä¹‹åçš„æ­¥éª¤ã€‚

2ã€æ ¹æ® `dp` æ•°ç»„çš„å®šä¹‰ï¼Œè¿ç”¨æ•°å­¦å½’çº³æ³•çš„æ€æƒ³ï¼Œå‡è®¾ `dp[0...i-1]` éƒ½å·²çŸ¥ï¼Œæƒ³åŠæ³•æ±‚å‡º `dp[i]`ï¼Œä¸€æ—¦è¿™ä¸€æ­¥å®Œæˆï¼Œæ•´ä¸ªé¢˜ç›®åŸºæœ¬å°±è§£å†³äº†ã€‚

ä½†å¦‚æœæ— æ³•å®Œæˆè¿™ä¸€æ­¥ï¼Œå¾ˆå¯èƒ½å°±æ˜¯ `dp` æ•°ç»„çš„å®šä¹‰ä¸å¤Ÿæ°å½“ï¼Œéœ€è¦é‡æ–°å®šä¹‰ `dp` æ•°ç»„çš„å«ä¹‰ï¼›æˆ–è€…å¯èƒ½æ˜¯ `dp` æ•°ç»„å­˜å‚¨çš„ä¿¡æ¯è¿˜ä¸å¤Ÿï¼Œä¸è¶³ä»¥æ¨å‡ºä¸‹ä¸€æ­¥çš„ç­”æ¡ˆï¼Œéœ€è¦æŠŠ `dp` æ•°ç»„æ‰©å¤§æˆäºŒç»´æ•°ç»„ç”šè‡³ä¸‰ç»´æ•°ç»„ã€‚

ç›®å‰çš„è§£æ³•æ˜¯æ ‡å‡†çš„åŠ¨æ€è§„åˆ’ï¼Œä½†å¯¹æœ€é•¿é€’å¢å­åºåˆ—é—®é¢˜æ¥è¯´ï¼Œè¿™ä¸ªè§£æ³•ä¸æ˜¯æœ€ä¼˜çš„ï¼Œå¯èƒ½æ— æ³•é€šè¿‡æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹äº†ï¼Œä¸‹é¢è®²è®²æ›´é«˜æ•ˆçš„è§£æ³•ã€‚

### äºŒåˆ†æŸ¥æ‰¾è§£æ³•

æ­£å¸¸äººåŸºæœ¬æƒ³ä¸åˆ°è¿™ç§è§£æ³•ï¼ˆä¹Ÿè®¸ç©è¿‡æŸäº›çº¸ç‰Œæ¸¸æˆçš„äººå¯ä»¥æƒ³å‡ºæ¥ï¼‰ã€‚æ‰€ä»¥äº†è§£ä¸€ä¸‹å°±å¥½ã€‚

æ ¹æ®é¢˜ç›®çš„æ„æ€ï¼Œæˆ‘éƒ½å¾ˆéš¾æƒ³è±¡è¿™ä¸ªé—®é¢˜ç«Ÿç„¶èƒ½å’ŒäºŒåˆ†æŸ¥æ‰¾æ‰¯ä¸Šå…³ç³»ã€‚å…¶å®æœ€é•¿é€’å¢å­åºåˆ—å’Œä¸€ç§å«åš patience game çš„çº¸ç‰Œæ¸¸æˆæœ‰å…³ï¼Œç”šè‡³æœ‰ä¸€ç§æ’åºæ–¹æ³•å°±å«åš patience sortingï¼ˆè€å¿ƒæ’åºï¼‰ã€‚

ä¸ºäº†ç®€å•èµ·è§ï¼Œåæ–‡è·³è¿‡æ‰€æœ‰æ•°å­¦è¯æ˜ï¼Œé€šè¿‡ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­æ¥ç†è§£ä¸€ä¸‹ç®—æ³•æ€è·¯ã€‚

é¦–å…ˆï¼Œç»™ä½ ä¸€æ’æ‰‘å…‹ç‰Œï¼Œæˆ‘ä»¬åƒéå†æ•°ç»„é‚£æ ·ä»å·¦åˆ°å³ä¸€å¼ ä¸€å¼ å¤„ç†è¿™äº›æ‰‘å…‹ç‰Œï¼Œæœ€ç»ˆè¦æŠŠè¿™äº›ç‰Œåˆ†æˆè‹¥å¹²å †ã€‚

![img](https://labuladong.online/algo/images/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/poker1.jpeg)

**å¤„ç†è¿™äº›æ‰‘å…‹ç‰Œè¦éµå¾ªä»¥ä¸‹è§„åˆ™**ï¼š

åªèƒ½æŠŠç‚¹æ•°å°çš„ç‰Œå‹åˆ°ç‚¹æ•°æ¯”å®ƒå¤§çš„ç‰Œä¸Šï¼›å¦‚æœå½“å‰ç‰Œç‚¹æ•°è¾ƒå¤§æ²¡æœ‰å¯ä»¥æ”¾ç½®çš„å †ï¼Œåˆ™æ–°å»ºä¸€ä¸ªå †ï¼ŒæŠŠè¿™å¼ ç‰Œæ”¾è¿›å»ï¼›å¦‚æœå½“å‰ç‰Œæœ‰å¤šä¸ªå †å¯ä¾›é€‰æ‹©ï¼Œåˆ™é€‰æ‹©æœ€å·¦è¾¹çš„é‚£ä¸€å †æ”¾ç½®ã€‚

æ¯”å¦‚è¯´ä¸Šè¿°çš„æ‰‘å…‹ç‰Œæœ€ç»ˆä¼šè¢«åˆ†æˆè¿™æ · 5 å †ï¼ˆæˆ‘ä»¬è®¤ä¸ºçº¸ç‰Œ A çš„ç‰Œé¢æ˜¯æœ€å¤§çš„ï¼Œçº¸ç‰Œ 2 çš„ç‰Œé¢æ˜¯æœ€å°çš„ï¼‰ã€‚

![img](https://labuladong.online/algo/images/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/poker2.jpeg)

ä¸ºä»€ä¹ˆé‡åˆ°å¤šä¸ªå¯é€‰æ‹©å †çš„æ—¶å€™è¦æ”¾åˆ°æœ€å·¦è¾¹çš„å †ä¸Šå‘¢ï¼Ÿå› ä¸ºè¿™æ ·å¯ä»¥ä¿è¯ç‰Œå †é¡¶çš„ç‰Œæœ‰åºï¼ˆ2, 4, 7, 8, Qï¼‰ï¼Œè¯æ˜ç•¥ã€‚

![img](https://labuladong.online/algo/images/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/poker3.jpeg)

æŒ‰ç…§ä¸Šè¿°è§„åˆ™æ‰§è¡Œï¼Œå¯ä»¥ç®—å‡ºæœ€é•¿é€’å¢å­åºåˆ—ï¼Œç‰Œçš„å †æ•°å°±æ˜¯æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦ï¼Œè¯æ˜ç•¥ã€‚

![img](https://labuladong.online/algo/images/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/poker4.jpeg)

æˆ‘ä»¬åªè¦æŠŠå¤„ç†æ‰‘å…‹ç‰Œçš„è¿‡ç¨‹ç¼–ç¨‹å†™å‡ºæ¥å³å¯ã€‚æ¯æ¬¡å¤„ç†ä¸€å¼ æ‰‘å…‹ç‰Œä¸æ˜¯è¦æ‰¾ä¸€ä¸ªåˆé€‚çš„ç‰Œå †é¡¶æ¥æ”¾å—ï¼Œç‰Œå †é¡¶çš„ç‰Œä¸æ˜¯**æœ‰åº**å—ï¼Œè¿™å°±èƒ½ç”¨åˆ°äºŒåˆ†æŸ¥æ‰¾äº†ï¼šç”¨äºŒåˆ†æŸ¥æ‰¾æ¥æœç´¢å½“å‰ç‰Œåº”æ”¾ç½®çš„ä½ç½®ã€‚

```cpp
class Solution {
public:
    int lengthOfLIS(vector<int>& nums) {
        vector<int> top(nums.size());
        // ç‰Œå †æ•°åˆå§‹åŒ–ä¸º 0
        int piles = 0;
        for (int i = 0; i < nums.size(); i++) {
            // è¦å¤„ç†çš„æ‰‘å…‹ç‰Œ
            int poker = nums[i];

            /***** æœç´¢å·¦ä¾§è¾¹ç•Œçš„äºŒåˆ†æŸ¥æ‰¾ *****/
            int left = 0, right = piles;
            while (left < right) {
                int mid = (left + right) / 2;
                if (top[mid] > poker) {
                    right = mid;
                } else if (top[mid] < poker) {
                    left = mid + 1;
                } else {
                    right = mid;
                }
            }
            /*********************************/
            
            // æ²¡æ‰¾åˆ°åˆé€‚çš„ç‰Œå †ï¼Œæ–°å»ºä¸€å †
            if (left == piles) piles++;
            // æŠŠè¿™å¼ ç‰Œæ”¾åˆ°ç‰Œå †é¡¶
            top[left] = poker;
        }
        // ç‰Œå †æ•°å°±æ˜¯ LIS é•¿åº¦
        return piles;
    }
};
```

### æ‹“å±•åˆ°äºŒç»´

> é¢˜ç›®

ç»™ä½ ä¸€ä¸ªäºŒç»´æ•´æ•°æ•°ç»„ `envelopes` ï¼Œå…¶ä¸­ `envelopes[i] = [wi, hi]` ï¼Œè¡¨ç¤ºç¬¬ `i` ä¸ªä¿¡å°çš„å®½åº¦å’Œé«˜åº¦ã€‚

å½“å¦ä¸€ä¸ªä¿¡å°çš„å®½åº¦å’Œé«˜åº¦éƒ½æ¯”è¿™ä¸ªä¿¡å°å¤§çš„æ—¶å€™ï¼Œè¿™ä¸ªä¿¡å°å°±å¯ä»¥æ”¾è¿›å¦ä¸€ä¸ªä¿¡å°é‡Œï¼Œå¦‚åŒä¿„ç½—æ–¯å¥—å¨ƒä¸€æ ·ã€‚

è¯·è®¡ç®— **æœ€å¤šèƒ½æœ‰å¤šå°‘ä¸ª** ä¿¡å°èƒ½ç»„æˆä¸€ç»„â€œä¿„ç½—æ–¯å¥—å¨ƒâ€ä¿¡å°ï¼ˆå³å¯ä»¥æŠŠä¸€ä¸ªä¿¡å°æ”¾åˆ°å¦ä¸€ä¸ªä¿¡å°é‡Œé¢ï¼‰ã€‚

**æ³¨æ„**ï¼šä¸å…è®¸æ—‹è½¬ä¿¡å°ã€‚

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼šenvelopes = [[5,4],[6,4],[6,7],[2,3]]
è¾“å‡ºï¼š3
è§£é‡Šï¼šæœ€å¤šä¿¡å°çš„ä¸ªæ•°ä¸º 3, ç»„åˆä¸º: [2,3] => [5,4] => [6,7]ã€‚
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šenvelopes = [[1,1],[1,1],[1,1]]
è¾“å‡ºï¼š1
```

**æç¤ºï¼š**

- `1 <= envelopes.length <= 105`
- `envelopes[i].length == 2`
- `1 <= wi, hi <= 105`

> æ€è·¯

**è¿™é“é¢˜ç›®å…¶å®æ˜¯æœ€é•¿é€’å¢å­åºåˆ—çš„ä¸€ä¸ªå˜ç§ï¼Œå› ä¸ºæ¯æ¬¡åˆæ³•çš„åµŒå¥—æ˜¯å¤§çš„å¥—å°çš„ï¼Œç›¸å½“äºåœ¨äºŒç»´å¹³é¢ä¸­æ‰¾ä¸€ä¸ªæœ€é•¿é€’å¢çš„å­åºåˆ—ï¼Œå…¶é•¿åº¦å°±æ˜¯æœ€å¤šèƒ½åµŒå¥—çš„ä¿¡å°ä¸ªæ•°**ã€‚

å‰é¢è¯´çš„æ ‡å‡† LIS ç®—æ³•åªèƒ½åœ¨ä¸€ç»´æ•°ç»„ä¸­å¯»æ‰¾æœ€é•¿å­åºåˆ—ï¼Œè€Œæˆ‘ä»¬çš„ä¿¡å°æ˜¯ç”± `(w, h)` è¿™æ ·çš„äºŒç»´æ•°å¯¹å½¢å¼è¡¨ç¤ºçš„ï¼Œå¦‚ä½•æŠŠ LIS ç®—æ³•è¿ç”¨è¿‡æ¥å‘¢ï¼Ÿ

![img](https://labuladong.online/algo/images/%E4%BF%A1%E5%B0%81%E5%B5%8C%E5%A5%97/0.jpg)

è¯»è€…ä¹Ÿè®¸ä¼šæƒ³ï¼Œé€šè¿‡ `w Ã— h` è®¡ç®—é¢ç§¯ï¼Œç„¶åå¯¹é¢ç§¯è¿›è¡Œæ ‡å‡†çš„ LIS ç®—æ³•ã€‚ä½†æ˜¯ç¨åŠ æ€è€ƒå°±ä¼šå‘ç°è¿™æ ·ä¸è¡Œï¼Œæ¯”å¦‚ `1 Ã— 10` å¤§äº `3 Ã— 3`ï¼Œä½†æ˜¯æ˜¾ç„¶è¿™æ ·çš„ä¸¤ä¸ªä¿¡å°æ˜¯æ— æ³•äº’ç›¸åµŒå¥—çš„ã€‚

è¿™é“é¢˜çš„è§£æ³•æ¯”è¾ƒå·§å¦™ï¼š

**å…ˆå¯¹å®½åº¦ `w` è¿›è¡Œå‡åºæ’åºï¼Œå¦‚æœé‡åˆ° `w` ç›¸åŒçš„æƒ…å†µï¼Œåˆ™æŒ‰ç…§é«˜åº¦ `h` é™åºæ’åºï¼›ä¹‹åæŠŠæ‰€æœ‰çš„ `h` ä½œä¸ºä¸€ä¸ªæ•°ç»„ï¼Œåœ¨è¿™ä¸ªæ•°ç»„ä¸Šè®¡ç®— LIS çš„é•¿åº¦å°±æ˜¯ç­”æ¡ˆ**ã€‚

ç”»ä¸ªå›¾ç†è§£ä¸€ä¸‹ï¼Œå…ˆå¯¹è¿™äº›æ•°å¯¹è¿›è¡Œæ’åºï¼š

![img](https://labuladong.online/algo/images/%E4%BF%A1%E5%B0%81%E5%B5%8C%E5%A5%97/1.jpg)

ç„¶ååœ¨ `h` ä¸Šå¯»æ‰¾æœ€é•¿é€’å¢å­åºåˆ—ï¼Œè¿™ä¸ªå­åºåˆ—å°±æ˜¯æœ€ä¼˜çš„åµŒå¥—æ–¹æ¡ˆï¼š

![img](https://labuladong.online/algo/images/%E4%BF%A1%E5%B0%81%E5%B5%8C%E5%A5%97/2.jpg)

**é‚£ä¹ˆä¸ºä»€ä¹ˆè¿™æ ·å°±å¯ä»¥æ‰¾åˆ°å¯ä»¥äº’ç›¸åµŒå¥—çš„ä¿¡å°åºåˆ—å‘¢**ï¼Ÿç¨å¾®æ€è€ƒä¸€ä¸‹å°±æ˜ç™½äº†ï¼š

é¦–å…ˆï¼Œå¯¹å®½åº¦ `w` ä»å°åˆ°å¤§æ’åºï¼Œç¡®ä¿äº† `w` è¿™ä¸ªç»´åº¦å¯ä»¥äº’ç›¸åµŒå¥—ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¸“æ³¨é«˜åº¦ `h` è¿™ä¸ªç»´åº¦èƒ½å¤Ÿäº’ç›¸åµŒå¥—å³å¯ã€‚

å…¶æ¬¡ï¼Œä¸¤ä¸ª `w` ç›¸åŒçš„ä¿¡å°ä¸èƒ½ç›¸äº’åŒ…å«ï¼Œæ‰€ä»¥å¯¹äºå®½åº¦ `w` ç›¸åŒçš„ä¿¡å°ï¼Œå¯¹é«˜åº¦ `h` è¿›è¡Œé™åºæ’åºï¼Œä¿è¯äºŒç»´ LIS ä¸­ä¸å­˜åœ¨å¤šä¸ª `w` ç›¸åŒçš„ä¿¡å°ï¼ˆå› ä¸ºé¢˜ç›®è¯´äº†é•¿å®½ç›¸åŒä¹Ÿæ— æ³•åµŒå¥—ï¼‰ã€‚

```cpp
class Solution {
public:
    // envelopes = { { w, h }, { w, h }...}
    int maxEnvelopes(vector<vector<int>>& envelopes) {
        int n = envelopes.size();
        // æŒ‰å®½åº¦å‡åºæ’åˆ—ï¼Œå¦‚æœå®½åº¦ä¸€æ ·ï¼Œåˆ™æŒ‰é«˜åº¦é™åºæ’åˆ—
        sort(envelopes.begin(), envelopes.end(), [](vector<int>& a, vector<int>& b) {
            return a[0] == b[0] ? b[1] > a[1] : a[0] < b[0];
        });
        // å¯¹é«˜åº¦æ•°ç»„å¯»æ‰¾ LIS
        vector<int> height(n, 0);
        for (int i = 0; i < n; ++i)
            height[i] = envelopes[i][1];

        return lengthOfLIS(height);
    }

    int lengthOfLIS(vector<int>& nums) {
        // è§å‰æ–‡
    }
};
```

## æœ€ä¼˜å­ç»“æ„åŸç†å’Œdpæ•°ç»„éå†æ–¹å‘

### æœ€ä¼˜å­ç»“æ„è¯¦è§£

ã€Œæœ€ä¼˜å­ç»“æ„ã€æ˜¯æŸäº›é—®é¢˜çš„ä¸€ç§ç‰¹å®šæ€§è´¨ï¼Œå¹¶ä¸æ˜¯åŠ¨æ€è§„åˆ’é—®é¢˜ä¸“æœ‰çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¾ˆå¤šé—®é¢˜å…¶å®éƒ½å…·æœ‰æœ€ä¼˜å­ç»“æ„ï¼Œåªæ˜¯å…¶ä¸­å¤§éƒ¨åˆ†ä¸å…·æœ‰é‡å å­é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸æŠŠå®ƒä»¬å½’ä¸ºåŠ¨æ€è§„åˆ’ç³»åˆ—é—®é¢˜è€Œå·²ã€‚

æˆ‘å…ˆä¸¾ä¸ªå¾ˆå®¹æ˜“ç†è§£çš„ä¾‹å­ï¼šå‡è®¾ä½ ä»¬å­¦æ ¡æœ‰ 10 ä¸ªç­ï¼Œä½ å·²ç»è®¡ç®—å‡ºäº†æ¯ä¸ªç­çš„æœ€é«˜è€ƒè¯•æˆç»©ã€‚é‚£ä¹ˆç°åœ¨æˆ‘è¦æ±‚ä½ è®¡ç®—å…¨æ ¡æœ€é«˜çš„æˆç»©ï¼Œä½ ä¼šä¸ä¼šç®—ï¼Ÿå½“ç„¶ä¼šï¼Œè€Œä¸”ä½ ä¸ç”¨é‡æ–°éå†å…¨æ ¡å­¦ç”Ÿçš„åˆ†æ•°è¿›è¡Œæ¯”è¾ƒï¼Œè€Œæ˜¯åªè¦åœ¨è¿™ 10 ä¸ªæœ€é«˜æˆç»©ä¸­å–æœ€å¤§çš„å°±æ˜¯å…¨æ ¡çš„æœ€é«˜æˆç»©ã€‚

æˆ‘ç»™ä½ æå‡ºçš„è¿™ä¸ªé—®é¢˜å°±**ç¬¦åˆæœ€ä¼˜å­ç»“æ„**ï¼šå¯ä»¥ä»å­é—®é¢˜çš„æœ€ä¼˜ç»“æœæ¨å‡ºæ›´å¤§è§„æ¨¡é—®é¢˜çš„æœ€ä¼˜ç»“æœã€‚è®©ä½ ç®—**æ¯ä¸ªç­**çš„æœ€ä¼˜æˆç»©å°±æ˜¯å­é—®é¢˜ï¼Œä½ çŸ¥é“æ‰€æœ‰å­é—®é¢˜çš„ç­”æ¡ˆåï¼Œå°±å¯ä»¥å€Ÿæ­¤æ¨å‡º**å…¨æ ¡**å­¦ç”Ÿçš„æœ€ä¼˜æˆç»©è¿™ä¸ªè§„æ¨¡æ›´å¤§çš„é—®é¢˜çš„ç­”æ¡ˆã€‚

ä½ çœ‹ï¼Œè¿™ä¹ˆç®€å•çš„é—®é¢˜éƒ½æœ‰æœ€ä¼˜å­ç»“æ„æ€§è´¨ï¼Œåªæ˜¯å› ä¸ºæ˜¾ç„¶æ²¡æœ‰é‡å å­é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ç®€å•åœ°æ±‚æœ€å€¼è‚¯å®šç”¨ä¸å‡ºåŠ¨æ€è§„åˆ’ã€‚

å†ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾ä½ ä»¬å­¦æ ¡æœ‰ 10 ä¸ªç­ï¼Œä½ å·²çŸ¥æ¯ä¸ªç­çš„æœ€å¤§åˆ†æ•°å·®ï¼ˆæœ€é«˜åˆ†å’Œæœ€ä½åˆ†çš„å·®å€¼ï¼‰ã€‚é‚£ä¹ˆç°åœ¨æˆ‘è®©ä½ è®¡ç®—å…¨æ ¡å­¦ç”Ÿä¸­çš„æœ€å¤§åˆ†æ•°å·®ï¼Œä½ ä¼šä¸ä¼šç®—ï¼Ÿå¯ä»¥æƒ³åŠæ³•ç®—ï¼Œä½†æ˜¯è‚¯å®šä¸èƒ½é€šè¿‡å·²çŸ¥çš„è¿™ 10 ä¸ªç­çš„æœ€å¤§åˆ†æ•°å·®æ¨åˆ°å‡ºæ¥ã€‚å› ä¸ºè¿™ 10 ä¸ªç­çš„æœ€å¤§åˆ†æ•°å·®ä¸ä¸€å®šå°±åŒ…å«å…¨æ ¡å­¦ç”Ÿçš„æœ€å¤§åˆ†æ•°å·®ï¼Œæ¯”å¦‚å…¨æ ¡çš„æœ€å¤§åˆ†æ•°å·®å¯èƒ½æ˜¯ 3 ç­çš„æœ€é«˜åˆ†å’Œ 6 ç­çš„æœ€ä½åˆ†ä¹‹å·®ã€‚

è¿™æ¬¡æˆ‘ç»™ä½ æå‡ºçš„é—®é¢˜å°±**ä¸ç¬¦åˆæœ€ä¼˜å­ç»“æ„**ï¼Œå› ä¸ºä½ æ²¡åŠé€šè¿‡æ¯ä¸ªç­çš„æœ€ä¼˜å€¼æ¨å‡ºå…¨æ ¡çš„æœ€ä¼˜å€¼ï¼Œæ²¡åŠæ³•é€šè¿‡å­é—®é¢˜çš„æœ€ä¼˜å€¼æ¨å‡ºè§„æ¨¡æ›´å¤§çš„é—®é¢˜çš„æœ€ä¼˜å€¼ã€‚

**æƒ³æ»¡è¶³æœ€ä¼˜å­ç»“ï¼Œå­é—®é¢˜ä¹‹é—´å¿…é¡»äº’ç›¸ç‹¬ç«‹ã€‚**å…¨æ ¡çš„æœ€å¤§åˆ†æ•°å·®å¯èƒ½å‡ºç°åœ¨ä¸¤ä¸ªç­ä¹‹é—´ï¼Œæ˜¾ç„¶å­é—®é¢˜ä¸ç‹¬ç«‹ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜æœ¬èº«ä¸ç¬¦åˆæœ€ä¼˜å­ç»“æ„ã€‚

**é‚£ä¹ˆé‡åˆ°è¿™ç§æœ€ä¼˜å­ç»“æ„å¤±æ•ˆæƒ…å†µï¼Œæ€ä¹ˆåŠï¼Ÿç­–ç•¥æ˜¯ï¼šæ”¹é€ é—®é¢˜**ã€‚å¯¹äºæœ€å¤§åˆ†æ•°å·®è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸æ˜¯æ²¡åŠæ³•åˆ©ç”¨å·²çŸ¥çš„æ¯ä¸ªç­çš„åˆ†æ•°å·®å—ï¼Œé‚£æˆ‘åªèƒ½è¿™æ ·å†™ä¸€æ®µæš´åŠ›ä»£ç ï¼š

```cpp
int result = 0;
for (Student a : school) {
    for (Student b : school) {
        if (a is b) continue;
        result = max(result, |a.score - b.score|);
    }
}
return result;
```

æ”¹é€ é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æŠŠé—®é¢˜ç­‰ä»·è½¬åŒ–ï¼šæœ€å¤§åˆ†æ•°å·®ï¼Œä¸å°±ç­‰ä»·äºæœ€é«˜åˆ†æ•°å’Œæœ€ä½åˆ†æ•°çš„å·®ä¹ˆï¼Œé‚£ä¸å°±æ˜¯è¦æ±‚æœ€é«˜å’Œæœ€ä½åˆ†æ•°ä¹ˆï¼Œä¸å°±æ˜¯æˆ‘ä»¬è®¨è®ºçš„ç¬¬ä¸€ä¸ªé—®é¢˜ä¹ˆï¼Œä¸å°±å…·æœ‰æœ€ä¼˜å­ç»“æ„äº†ä¹ˆï¼Ÿé‚£ç°åœ¨æ”¹å˜æ€è·¯ï¼Œå€ŸåŠ©æœ€ä¼˜å­ç»“æ„è§£å†³æœ€å€¼é—®é¢˜ï¼Œå†å›è¿‡å¤´è§£å†³æœ€å¤§åˆ†æ•°å·®é—®é¢˜ï¼Œæ˜¯ä¸æ˜¯å°±é«˜æ•ˆå¤šäº†ï¼Ÿ

å½“ç„¶ï¼Œä¸Šé¢è¿™ä¸ªä¾‹å­å¤ªç®€å•äº†ï¼Œä¸è¿‡è¯·è¯»è€…å›é¡¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬åšåŠ¨æ€è§„åˆ’é—®é¢˜ï¼Œæ˜¯ä¸æ˜¯ä¸€ç›´åœ¨æ±‚å„ç§æœ€å€¼ï¼Œæœ¬è´¨è·Ÿæˆ‘ä»¬ä¸¾çš„ä¾‹å­æ²¡å•¥åŒºåˆ«ï¼Œæ— ééœ€è¦å¤„ç†ä¸€ä¸‹é‡å å­é—®é¢˜ã€‚

å†ä¸¾ä¸ªå¸¸è§ä½†ä¹Ÿååˆ†ç®€å•çš„ä¾‹å­ï¼Œæ±‚ä¸€æ£µäºŒå‰æ ‘çš„æœ€å¤§å€¼ï¼Œä¸éš¾å§ï¼ˆç®€å•èµ·è§ï¼Œå‡è®¾èŠ‚ç‚¹ä¸­çš„å€¼éƒ½æ˜¯éè´Ÿæ•°ï¼‰ï¼š

```cpp
int maxVal(TreeNode* root) {
    if (root == NULL)
        return -1;
    int left = maxVal(root->left);
    int right = maxVal(root->right);
    return max(root->val, max(left, right));
}
```

ä½ çœ‹è¿™ä¸ªé—®é¢˜ä¹Ÿç¬¦åˆæœ€ä¼˜å­ç»“æ„ï¼Œä»¥ `root` ä¸ºæ ¹çš„æ ‘çš„æœ€å¤§å€¼ï¼Œå¯ä»¥é€šè¿‡ä¸¤è¾¹å­æ ‘ï¼ˆå­é—®é¢˜ï¼‰çš„æœ€å¤§å€¼æ¨å¯¼å‡ºæ¥ï¼Œç»“åˆåˆšæ‰å­¦æ ¡å’Œç­çº§çš„ä¾‹å­ï¼Œå¾ˆå®¹æ˜“ç†è§£å§ã€‚

å½“ç„¶è¿™ä¹Ÿä¸æ˜¯åŠ¨æ€è§„åˆ’é—®é¢˜ï¼Œæ—¨åœ¨è¯´æ˜ï¼Œæœ€ä¼˜å­ç»“æ„å¹¶ä¸æ˜¯åŠ¨æ€è§„åˆ’ç‹¬æœ‰çš„ä¸€ç§æ€§è´¨ï¼Œèƒ½æ±‚æœ€å€¼çš„é—®é¢˜å¤§éƒ¨åˆ†éƒ½å…·æœ‰è¿™ä¸ªæ€§è´¨ï¼›**ä½†åè¿‡æ¥ï¼Œæœ€ä¼˜å­ç»“æ„æ€§è´¨ä½œä¸ºåŠ¨æ€è§„åˆ’é—®é¢˜çš„å¿…è¦æ¡ä»¶ï¼Œä¸€å®šæ˜¯è®©ä½ æ±‚æœ€å€¼çš„**ï¼Œä»¥åç¢°åˆ°é‚£ç§æ¶å¿ƒäººçš„æœ€å€¼é¢˜ï¼Œæ€è·¯å¾€åŠ¨æ€è§„åˆ’æƒ³å°±å¯¹äº†ï¼Œè¿™å°±æ˜¯å¥—è·¯ã€‚

åŠ¨æ€è§„åˆ’ä¸å°±æ˜¯ä»æœ€ç®€å•çš„ base case å¾€åæ¨å¯¼å—ï¼Œå¯ä»¥æƒ³è±¡æˆä¸€ä¸ªé“¾å¼ååº”ï¼Œä»¥å°åšå¤§ã€‚ä½†åªæœ‰ç¬¦åˆæœ€ä¼˜å­ç»“æ„çš„é—®é¢˜ï¼Œæ‰æœ‰å‘ç”Ÿè¿™ç§é“¾å¼ååº”çš„æ€§è´¨ã€‚

æ‰¾æœ€ä¼˜å­ç»“æ„çš„è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯è¯æ˜çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ­£ç¡®æ€§çš„è¿‡ç¨‹ï¼Œæ–¹ç¨‹ç¬¦åˆæœ€ä¼˜å­ç»“æ„å°±å¯ä»¥å†™æš´åŠ›è§£äº†ï¼Œå†™å‡ºæš´åŠ›è§£å°±å¯ä»¥çœ‹å‡ºæœ‰æ²¡æœ‰é‡å å­é—®é¢˜äº†ï¼Œæœ‰åˆ™ä¼˜åŒ–ï¼Œæ— åˆ™ OKã€‚è¿™ä¹Ÿæ˜¯å¥—è·¯ï¼Œç»å¸¸åˆ·é¢˜çš„è¯»è€…åº”è¯¥èƒ½ä½“ä¼šã€‚

### å¦‚ä½•ä¸€çœ¼çœ‹å‡ºé‡å å­é—®é¢˜

**æ— æ³•åˆ¤æ–­è¿™ä¸ªè§£æ³•æ˜¯å¦å­˜åœ¨é‡å å­é—®é¢˜**ï¼Œå°±æ— æ³•ç¡®å®šæ˜¯å¦å¯ä»¥è¿ç”¨å¤‡å¿˜å½•ç­‰æ–¹æ³•å»ä¼˜åŒ–ç®—æ³•æ•ˆç‡ã€‚

**é¦–å…ˆï¼Œæœ€ç®€å•ç²—æš´çš„æ–¹å¼å°±æ˜¯ç”»å›¾ï¼ŒæŠŠé€’å½’æ ‘ç”»å‡ºæ¥ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰é‡å¤çš„èŠ‚ç‚¹**ã€‚

![img](https://labuladong.online/algo/images/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E8%AF%A6%E8%A7%A3%E8%BF%9B%E9%98%B6/1.jpg)

è¿™æ£µé€’å½’æ ‘å¾ˆæ˜æ˜¾å­˜åœ¨é‡å¤çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å¤‡å¿˜å½•é¿å…å†—ä½™è®¡ç®—ã€‚

ä½†æ¯•ç«Ÿæ–æ³¢é‚£å¥‘æ•°åˆ—é—®é¢˜å¤ªç®€å•äº†ï¼Œå®é™…çš„åŠ¨æ€è§„åˆ’é—®é¢˜æ¯”è¾ƒå¤æ‚ï¼Œæ¯”å¦‚äºŒç»´ç”šè‡³ä¸‰ç»´çš„åŠ¨æ€è§„åˆ’ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”»é€’å½’æ ‘ï¼Œä½†ä¸å…æœ‰äº›å¤æ‚ã€‚

æ¯”å¦‚åœ¨ [æœ€å°è·¯å¾„å’Œé—®é¢˜](https://labuladong.online/algo/dynamic-programming/minimum-path-sum/) ä¸­ï¼Œæˆ‘ä»¬å†™å‡ºäº†è¿™æ ·ä¸€ä¸ªæš´åŠ›è§£æ³•ï¼š

```cpp
int dp(int grid[][], int i, int j) {
    if (i == 0 && j == 0) {
        return grid[0][0];
    }
    if (i < 0 || j < 0) {
        return INT_MAX;
    }

    return min(
            dp(grid, i - 1, j), 
            dp(grid, i, j - 1)
        ) + grid[i][j];
}
```

ä½ ä¸éœ€è¦è¯»è¿‡å‰æ–‡ï¼Œå…‰çœ‹è¿™ä¸ªå‡½æ•°ä»£ç å°±èƒ½çœ‹å‡ºæ¥ï¼Œè¯¥å‡½æ•°é€’å½’è¿‡ç¨‹ä¸­å‚æ•° `i, j` åœ¨ä¸æ–­å˜åŒ–ï¼Œå³ã€ŒçŠ¶æ€ã€æ˜¯ `(i, j)` çš„å€¼ï¼Œä½ æ˜¯å¦å¯ä»¥åˆ¤æ–­è¿™ä¸ªè§£æ³•æ˜¯å¦å­˜åœ¨é‡å å­é—®é¢˜å‘¢ï¼Ÿ

å‡è®¾è¾“å…¥çš„ `i = 8, j = 7`ï¼ŒäºŒç»´çŠ¶æ€çš„é€’å½’æ ‘å¦‚ä¸‹å›¾ï¼Œæ˜¾ç„¶å‡ºç°äº†é‡å å­é—®é¢˜ï¼š

![img](https://labuladong.online/algo/images/%E6%9C%80%E4%BC%98%E5%AD%90%E7%BB%93%E6%9E%84/2.jpeg)

**ä½†ç¨åŠ æ€è€ƒå°±å¯ä»¥çŸ¥é“ï¼Œå…¶å®æ ¹æœ¬æ²¡å¿…è¦ç”»å›¾ï¼Œå¯ä»¥é€šè¿‡é€’å½’æ¡†æ¶ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨é‡å å­é—®é¢˜**ã€‚

å…·ä½“æ“ä½œå°±æ˜¯ç›´æ¥åˆ æ‰ä»£ç ç»†èŠ‚ï¼ŒæŠ½è±¡å‡ºè¯¥è§£æ³•çš„é€’å½’æ¡†æ¶ï¼š

```cpp
int dp(int[][] grid, int i, int j) {
    dp(grid, i - 1, j), // #1
    dp(grid, i, j - 1)  // #2
}
```

å¯ä»¥çœ‹åˆ° `i, j` çš„å€¼åœ¨ä¸æ–­å‡å°ï¼Œé‚£ä¹ˆæˆ‘é—®ä½ ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæˆ‘æƒ³ä»çŠ¶æ€ `(i, j)` è½¬ç§»åˆ° `(i-1, j-1)`ï¼Œæœ‰å‡ ç§è·¯å¾„ï¼Ÿ

æ˜¾ç„¶æœ‰ä¸¤ç§è·¯å¾„ï¼Œå¯ä»¥æ˜¯ `(i, j) -> #1 -> #2` æˆ–è€… `(i, j) -> #2 -> #1`ï¼Œä¸æ­¢ä¸€ç§ï¼Œè¯´æ˜ `(i-1, j-1)` ä¼šè¢«å¤šæ¬¡è®¡ç®—ï¼Œæ‰€ä»¥ä¸€å®šå­˜åœ¨é‡å å­é—®é¢˜ã€‚

å†ä¸¾ä¸ªç¨å¾®å¤æ‚çš„ä¾‹å­ï¼Œåæ–‡ [æ­£åˆ™è¡¨è¾¾å¼é—®é¢˜](https://labuladong.online/algo/dynamic-programming/regular-expression-matching/) çš„æš´åŠ›è§£ä»£ç ï¼š

```cpp
bool dp(string s, int i, string p, int j) {
    int m = s.size(), n = p.size();
    // base case
    if (j == n) {
        return i == m;
    }
    if (i == m) {
        if ((n - j) % 2 == 1) {
            return false;
        }
        for (; j + 1 < n; j += 2) {
            if (p[j + 1] != '*') {
                return false;
            }
        }
        return true;
    }

    bool res = false;

    if (s[i] == p[j] || p[j] == '.') {
        if (j < n - 1 && p[j + 1] == '*') {
            res = dp(s, i, p, j + 2) || dp(s, i + 1, p, j);
        } else {
            res = dp(s, i + 1, p, j + 1);
        }
    } else {
        if (j < n - 1 && p[j + 1] == '*') {
            res = dp(s, i, p, j + 2);
        } else {
            res = false;
        }
    }
    
    return res;
}
```

ä»£ç æœ‰äº›å¤æ‚å¯¹å§ï¼Œå¦‚æœç”»å›¾çš„è¯æœ‰äº›éº»çƒ¦ï¼Œä½†æˆ‘ä»¬ä¸ç”»å›¾ï¼Œç›´æ¥å¿½ç•¥æ‰€æœ‰ç»†èŠ‚ä»£ç å’Œæ¡ä»¶åˆ†æ”¯ï¼ŒåªæŠ½è±¡å‡ºé€’å½’æ¡†æ¶ï¼š

```cpp
boolean dp(String s, int i, String p, int j) {
    dp(s, i, p, j + 2);     // #1
    dp(s, i + 1, p, j);     // #2
    dp(s, i + 1, p, j + 1); // #3
}
```

å’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œè¿™ä¸ªè§£æ³•çš„ã€ŒçŠ¶æ€ã€ä¹Ÿæ˜¯ `(i, j)` çš„å€¼ï¼Œé‚£ä¹ˆæˆ‘ç»§ç»­é—®ä½ é—®é¢˜ï¼šå¦‚æœæˆ‘æƒ³ä»çŠ¶æ€ `(i, j)` è½¬ç§»åˆ° `(i+2, j+2)`ï¼Œæœ‰å‡ ç§è·¯å¾„ï¼Ÿ

æ˜¾ç„¶ï¼Œè‡³å°‘æœ‰ä¸¤æ¡è·¯å¾„ï¼š`(i, j) -> #1 -> #2 -> #2` å’Œ `(i, j) -> #3 -> #3`ï¼Œè¿™å°±è¯´æ˜è¿™ä¸ªè§£æ³•å­˜åœ¨å·¨é‡é‡å å­é—®é¢˜ã€‚

æ‰€ä»¥ï¼Œä¸ç”¨ç”»å›¾å°±çŸ¥é“è¿™ä¸ªè§£æ³•ä¹Ÿå­˜åœ¨é‡å å­é—®é¢˜ï¼Œéœ€è¦ç”¨å¤‡å¿˜å½•æŠ€å·§å»ä¼˜åŒ–ã€‚

### dpæ•°ç»„çš„å¤§å°è®¾ç½®

æ¯”å¦‚è¯´åæ–‡ [ç¼–è¾‘è·ç¦»é—®é¢˜](https://labuladong.online/algo/dynamic-programming/edit-distance/)ï¼Œé¦–å…ˆè®²çš„æ˜¯è‡ªé¡¶å‘ä¸‹çš„é€’å½’è§£æ³•ï¼Œå®ç°äº†è¿™æ ·ä¸€ä¸ª `dp` å‡½æ•°ï¼š

```cpp
class Solution {
public:
    int minDistance(string s1, string s2) {
        int m = s1.length(), n = s2.length();
        // æŒ‰ç…§ dp å‡½æ•°çš„å®šä¹‰ï¼Œè®¡ç®— s1 å’Œ s2 çš„æœ€å°ç¼–è¾‘è·ç¦»
        return dp(s1, m - 1, s2, n - 1);
    }

    // å®šä¹‰ï¼šs1[0..i] å’Œ s2[0..j] çš„æœ€å°ç¼–è¾‘è·ç¦»æ˜¯ dp(s1, i, s2, j)
    int dp(string s1, int i, string s2, int j) {
        // å¤„ç† base case
        if (i == -1) {
            return j + 1;
        }
        if (j == -1) {
            return i + 1;
        }

        // è¿›è¡ŒçŠ¶æ€è½¬ç§»
        if (s1[i] == s2[j]) {
            return dp(s1, i - 1, s2, j - 1);
        } else {
            return min({
                dp(s1, i, s2, j - 1) + 1,
                dp(s1, i - 1, s2, j) + 1,
                dp(s1, i - 1, s2, j - 1) + 1
            });
        }
    }
    
private:
    // Helper function to find the minimum of three integers
    int min(std::initializer_list<int> ilist) {
        return *std::min_element(ilist.begin(), ilist.end());
    }
};
```

ç„¶åæ”¹é€ æˆäº†è‡ªåº•å‘ä¸Šçš„è¿­ä»£è§£æ³•ï¼š

```cpp
// æ³¨æ„ï¼šcpp ä»£ç ç”± chatGPTğŸ¤– æ ¹æ®æˆ‘çš„ java ä»£ç ç¿»è¯‘ï¼Œæ—¨åœ¨å¸®åŠ©ä¸åŒèƒŒæ™¯çš„è¯»è€…ç†è§£ç®—æ³•é€»è¾‘ã€‚
// æœ¬ä»£ç ä¸ä¿è¯æ­£ç¡®æ€§ï¼Œä»…ä¾›å‚è€ƒã€‚å¦‚æœ‰ç–‘æƒ‘ï¼Œå¯ä»¥å‚ç…§æˆ‘å†™çš„ java ä»£ç å¯¹æ¯”æŸ¥çœ‹ã€‚

class Solution {
public:
    int minDistance(string s1, string s2) {
        int m = s1.length(), n = s2.length();
        // å®šä¹‰ï¼šs1[0..i] å’Œ s2[0..j] çš„æœ€å°ç¼–è¾‘è·ç¦»æ˜¯ dp[i+1][j+1]
        vector<vector<int>> dp(m + 1, vector<int>(n + 1));
        // åˆå§‹åŒ– base case 
        for (int i = 1; i <= m; i++)
            dp[i][0] = i;
        for (int j = 1; j <= n; j++)
            dp[0][j] = j;

        // è‡ªåº•å‘ä¸Šæ±‚è§£
        for (int i = 1; i <= m; i++) {
            for (int j = 1; j <= n; j++) {
                // è¿›è¡ŒçŠ¶æ€è½¬ç§»
                if (s1[i-1] == s2[j-1]) {
                    dp[i][j] = dp[i - 1][j - 1];
                } else {
                    dp[i][j] = min(
                        dp[i - 1][j] + 1,
                        min(dp[i][j - 1] + 1,
                            dp[i - 1][j - 1] + 1)
                    );
                }
            }
        }
        // æŒ‰ç…§ dp æ•°ç»„çš„å®šä¹‰ï¼Œå­˜å‚¨ s1 å’Œ s2 çš„æœ€å°ç¼–è¾‘è·ç¦»
        return dp[m][n];
    }
};
```

è¿™ä¸¤ç§è§£æ³•æ€è·¯æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œä½†å°±æœ‰æé—®ï¼Œä¸ºä»€ä¹ˆè¿­ä»£è§£æ³•ä¸­çš„ `dp` æ•°ç»„åˆå§‹åŒ–å¤§å°è¦è®¾ç½®ä¸º `int[m+1][n+1]`ï¼Ÿä¸ºä»€ä¹ˆ `s1[0..i]` å’Œ `s2[0..j]` çš„æœ€å°ç¼–è¾‘è·ç¦»è¦å­˜å‚¨åœ¨ `dp[i+1][j+1]` ä¸­ï¼Œæœ‰ä¸€ä½ç´¢å¼•åç§»ï¼Ÿ

èƒ½ä¸èƒ½æ¨¡ä»¿ `dp` å‡½æ•°çš„å®šä¹‰ï¼ŒæŠŠ `dp` æ•°ç»„åˆå§‹åŒ–ä¸º `int[m][n]`ï¼Œç„¶åè®© `s1[0..i]` å’Œ `s2[0..j]` çš„æœ€å°ç¼–è¾‘è·ç¦»è¦å­˜å‚¨åœ¨ `dp[i][j]` ä¸­ï¼Ÿ

**ç†è®ºä¸Šï¼Œä½ æ€ä¹ˆå®šä¹‰éƒ½å¯ä»¥ï¼Œåªè¦æ ¹æ®å®šä¹‰å¤„ç†å¥½ base case å°±å¯ä»¥**ã€‚

ä½ çœ‹ `dp` å‡½æ•°çš„å®šä¹‰ï¼Œ`dp(s1, i, s2, j)` è®¡ç®— `s1[0..i]` å’Œ `s2[0..j]` çš„ç¼–è¾‘è·ç¦»ï¼Œé‚£ä¹ˆ `i, j` ç­‰äº -1 æ—¶ä»£è¡¨ç©ºä¸²çš„ base caseï¼Œæ‰€ä»¥å‡½æ•°å¼€å¤´å¤„ç†äº†è¿™ä¸¤ç§ç‰¹æ®Šæƒ…å†µã€‚

å†çœ‹ `dp` æ•°ç»„ï¼Œä½ å½“ç„¶ä¹Ÿå¯ä»¥å®šä¹‰ `dp[i][j]` å­˜å‚¨ `s1[0..i]` å’Œ `s2[0..j]` çš„ç¼–è¾‘è·ç¦»ï¼Œä½†é—®é¢˜æ˜¯ base case æ€ä¹ˆæï¼Ÿç´¢å¼•æ€ä¹ˆèƒ½æ˜¯ -1 å‘¢ï¼Ÿ

æ‰€ä»¥æˆ‘ä»¬æŠŠ `dp` æ•°ç»„åˆå§‹åŒ–ä¸º `int[m+1][n+1]`ï¼Œè®©ç´¢å¼•æ•´ä½“åç§»ä¸€ä½ï¼ŒæŠŠç´¢å¼• 0 ç•™å‡ºæ¥ä½œä¸º base case è¡¨ç¤ºç©ºä¸²ï¼Œç„¶åå®šä¹‰ `dp[i+1][j+1]` å­˜å‚¨ `s1[0..i]` å’Œ `s2[0..j]` çš„ç¼–è¾‘è·ç¦»ã€‚

### dpæ•°ç»„çš„éå†æ–¹å‘

æˆ‘ä»¬æ‹¿äºŒç»´ `dp` æ•°ç»„æ¥ä¸¾ä¾‹ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬æ˜¯æ­£å‘éå†ï¼š

```java
int[][] dp = new int[m][n];
for (int i = 0; i < m; i++)
    for (int j = 0; j < n; j++)
        // è®¡ç®— dp[i][j]
```

æœ‰æ—¶å€™æˆ‘ä»¬åå‘éå†ï¼š

```java
for (int i = m - 1; i >= 0; i--)
    for (int j = n - 1; j >= 0; j--)
        // è®¡ç®— dp[i][j]
```

æœ‰æ—¶å€™å¯èƒ½ä¼šæ–œå‘éå†ï¼š

```java
// æ–œç€éå†æ•°ç»„
for (int l = 2; l <= n; l++) {
    for (int i = 0; i <= n - l; i++) {
        int j = l + i - 1;
        // è®¡ç®— dp[i][j]
    }
}
```

ç”šè‡³æ›´è®©äººè¿·æƒ‘çš„æ˜¯ï¼Œæœ‰æ—¶å€™å‘ç°æ­£å‘åå‘éå†éƒ½å¯ä»¥å¾—åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ [å›¢ç­è‚¡ç¥¨é—®é¢˜](https://labuladong.online/algo/dynamic-programming/stock-problem-summary/) ä¸­æœ‰çš„åœ°æ–¹å°±æ­£åçš†å¯ã€‚

å¦‚æœä»”ç»†è§‚å¯Ÿçš„è¯å¯ä»¥å‘ç°å…¶ä¸­çš„åŸå› ï¼Œä½ åªè¦æŠŠä½ä¸¤ç‚¹å°±è¡Œäº†ï¼š

**1ã€éå†çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€éœ€çš„çŠ¶æ€å¿…é¡»æ˜¯å·²ç»è®¡ç®—å‡ºæ¥çš„**ã€‚

**2ã€éå†ç»“æŸåï¼Œå­˜å‚¨ç»“æœçš„é‚£ä¸ªä½ç½®å¿…é¡»å·²ç»è¢«è®¡ç®—å‡ºæ¥**ã€‚

ä¸‹é¢æ¥å…·ä½“è§£é‡Šä¸Šé¢ä¸¤ä¸ªåŸåˆ™æ˜¯ä»€ä¹ˆæ„æ€ã€‚

æ¯”å¦‚ç¼–è¾‘è·ç¦»è¿™ä¸ªç»å…¸çš„é—®é¢˜ï¼Œè¯¦è§£è§åæ–‡ [ç¼–è¾‘è·ç¦»è¯¦è§£](https://labuladong.online/algo/dynamic-programming/edit-distance/)ï¼Œæˆ‘ä»¬é€šè¿‡å¯¹ `dp` æ•°ç»„çš„å®šä¹‰ï¼Œç¡®å®šäº† base case æ˜¯ `dp[..][0]` å’Œ `dp[0][..]`ï¼Œæœ€ç»ˆç­”æ¡ˆæ˜¯ `dp[m][n]`ï¼›è€Œä¸”æˆ‘ä»¬é€šè¿‡çŠ¶æ€è½¬ç§»æ–¹ç¨‹çŸ¥é“ `dp[i][j]` éœ€è¦ä» `dp[i-1][j]`, `dp[i][j-1]`, `dp[i-1][j-1]` è½¬ç§»è€Œæ¥ï¼Œå¦‚ä¸‹å›¾ï¼š

![img](https://labuladong.online/algo/images/%E6%9C%80%E4%BC%98%E5%AD%90%E7%BB%93%E6%9E%84/1.jpg)

é‚£ä¹ˆï¼Œå‚è€ƒåˆšæ‰è¯´çš„ä¸¤æ¡åŸåˆ™ï¼Œä½ è¯¥æ€ä¹ˆéå† `dp` æ•°ç»„ï¼Ÿè‚¯å®šæ˜¯æ­£å‘éå†ï¼š

```cpp
for (int i = 1; i < m; i++)
    for (int j = 1; j < n; j++)
        // é€šè¿‡ dp[i-1][j], dp[i][j - 1], dp[i-1][j-1]
        // è®¡ç®— dp[i][j]
```

å› ä¸ºï¼Œè¿™æ ·æ¯ä¸€æ­¥è¿­ä»£çš„å·¦è¾¹ã€ä¸Šè¾¹ã€å·¦ä¸Šè¾¹çš„ä½ç½®éƒ½æ˜¯ base case æˆ–è€…ä¹‹å‰è®¡ç®—è¿‡çš„ï¼Œè€Œä¸”æœ€ç»ˆç»“æŸåœ¨æˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆ `dp[m][n]`ã€‚

å†ä¸¾ä¸€ä¾‹ï¼Œå›æ–‡å­åºåˆ—é—®é¢˜ï¼Œè¯¦è§åæ–‡ [å­åºåˆ—é—®é¢˜æ¨¡æ¿](https://labuladong.online/algo/dynamic-programming/subsequence-problem/)ï¼Œæˆ‘ä»¬é€šè¿‡è¿‡å¯¹ `dp` æ•°ç»„çš„å®šä¹‰ï¼Œç¡®å®šäº† base case å¤„åœ¨ä¸­é—´çš„å¯¹è§’çº¿ï¼Œ`dp[i][j]` éœ€è¦ä» `dp[i+1][j]`, `dp[i][j-1]`, `dp[i+1][j-1]` è½¬ç§»è€Œæ¥ï¼Œæƒ³è¦æ±‚çš„æœ€ç»ˆç­”æ¡ˆæ˜¯ `dp[0][n-1]`ï¼Œå¦‚ä¸‹å›¾ï¼š

![img](https://labuladong.online/algo/images/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E5%BA%8F%E5%88%97/4.jpg)

è¿™ç§æƒ…å†µæ ¹æ®åˆšæ‰çš„ä¸¤ä¸ªåŸåˆ™ï¼Œå°±å¯ä»¥æœ‰ä¸¤ç§æ­£ç¡®çš„éå†æ–¹å¼ï¼š

![img](https://labuladong.online/algo/images/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E5%BA%8F%E5%88%97/5.jpg)

è¦ä¹ˆä»å·¦è‡³å³æ–œç€éå†ï¼Œè¦ä¹ˆä»ä¸‹å‘ä¸Šä»å·¦åˆ°å³éå†ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ¯æ¬¡ `dp[i][j]` çš„å·¦è¾¹ã€ä¸‹è¾¹ã€å·¦ä¸‹è¾¹å·²ç»è®¡ç®—å®Œæ¯•ï¼Œå¾—åˆ°æ­£ç¡®ç»“æœã€‚

ç°åœ¨ï¼Œä½ åº”è¯¥ç†è§£äº†è¿™ä¸¤ä¸ªåŸåˆ™ï¼Œä¸»è¦å°±æ˜¯çœ‹ base case å’Œæœ€ç»ˆç»“æœçš„å­˜å‚¨ä½ç½®ï¼Œä¿è¯éå†è¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ•°æ®éƒ½æ˜¯è®¡ç®—å®Œæ¯•çš„å°±è¡Œï¼Œæœ‰æ—¶å€™ç¡®å®å­˜åœ¨å¤šç§æ–¹æ³•å¯ä»¥å¾—åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œå¯æ ¹æ®ä¸ªäººå£å‘³è‡ªè¡Œé€‰æ‹©ã€‚

## base caseå’Œå¤‡å¿˜å½•çš„åˆå§‹å€¼è®¾å®š

> é¢˜ç›®

è¾“å…¥ä¸ºä¸€ä¸ª `n * n` çš„äºŒç»´æ•°ç»„ `matrix`ï¼Œè¯·ä½ è®¡ç®—ä»ç¬¬ä¸€è¡Œè½åˆ°æœ€åä¸€è¡Œï¼Œç»è¿‡çš„è·¯å¾„å’Œæœ€å°ä¸ºå¤šå°‘ã€‚

```cpp
int minFallingPathSum(vector<vector<int>>& matrix);
```

å°±æ˜¯è¯´ä½ å¯ä»¥ç«™åœ¨ `matrix` çš„ç¬¬ä¸€è¡Œçš„ä»»æ„ä¸€ä¸ªå…ƒç´ ï¼Œéœ€è¦ä¸‹é™åˆ°æœ€åä¸€è¡Œã€‚

æ¯æ¬¡ä¸‹é™ï¼Œå¯ä»¥å‘ä¸‹ã€å‘å·¦ä¸‹ã€å‘å³ä¸‹ä¸‰ä¸ªæ–¹å‘ç§»åŠ¨ä¸€æ ¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ä» `matrix[i][j]` é™åˆ° `matrix[i+1][j]` æˆ– `matrix[i+1][j-1]` æˆ– `matrix[i+1][j+1]` ä¸‰ä¸ªä½ç½®ã€‚

è¯·ä½ è®¡ç®—ä¸‹é™çš„ã€Œæœ€å°è·¯å¾„å’Œã€ï¼Œæ¯”å¦‚è¯´é¢˜ç›®ç»™äº†ä¸€ä¸ªä¾‹å­ï¼š

```
è¾“å…¥ï¼šmatrix = [[2,1,3],[6,5,4],[7,8,9]]
è¾“å‡ºï¼š13
```

æœ€å°çš„è·¯å¾„å’Œä¸º 13ï¼Œå…·ä½“æ˜¯å¦‚ä¸‹å‡ ç§è·¯å¾„ï¼š

![img](https://labuladong.online/algo/images/%E5%A4%87%E5%BF%98%E5%BD%95%E5%9F%BA%E7%A1%80/failing1-grid.jpg)

> æ€è·¯

é¦–å…ˆæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª `dp` å‡½æ•°ï¼š

```cpp
int dp(int** matrix, int i, int j);
```

è¿™ä¸ª `dp` å‡½æ•°çš„å«ä¹‰å¦‚ä¸‹ï¼š

**ä»ç¬¬ä¸€è¡Œï¼ˆ`matrix[0][..]`ï¼‰å‘ä¸‹è½ï¼Œè½åˆ°ä½ç½® `matrix[i][j]` çš„æœ€å°è·¯å¾„å’Œä¸º `dp(matrix, i, j)`**ã€‚

æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸»å‡½æ•°çš„é€»è¾‘å†™å‡ºæ¥ï¼š

```cpp
int minFallingPathSum(vector<vector<int>>& matrix) {
    int n = matrix.size();
    int res = INT_MAX;

    // ç»ˆç‚¹å¯èƒ½åœ¨æœ€åä¸€è¡Œçš„ä»»æ„ä¸€åˆ—
    for (int j = 0; j < n; j++) {
        res = min(res, dp(matrix, n - 1, j));
    }

    return res;
}
```

å› ä¸ºæˆ‘ä»¬å¯èƒ½è½åˆ°æœ€åä¸€è¡Œçš„ä»»æ„ä¸€åˆ—ï¼Œæ‰€ä»¥è¦ç©·ä¸¾ä¸€ä¸‹ï¼Œçœ‹çœ‹è½åˆ°å“ªä¸€åˆ—æ‰èƒ½å¾—åˆ°æœ€å°çš„è·¯å¾„å’Œã€‚

æ¥ä¸‹æ¥çœ‹çœ‹ `dp` å‡½æ•°å¦‚ä½•å®ç°ã€‚

å¯¹äº `matrix[i][j]`ï¼Œåªæœ‰å¯èƒ½ä» `matrix[i-1][j], matrix[i-1][j-1], matrix[i-1][j+1]` è¿™ä¸‰ä¸ªä½ç½®è½¬ç§»è¿‡æ¥ã€‚

![img](https://labuladong.online/algo/images/%E5%A4%87%E5%BF%98%E5%BD%95%E5%9F%BA%E7%A1%80/1.jpeg)

**é‚£ä¹ˆï¼Œåªè¦çŸ¥é“åˆ°è¾¾ `(i-1, j), (i-1, j-1), (i-1, j+1)` è¿™ä¸‰ä¸ªä½ç½®çš„æœ€å°è·¯å¾„å’Œï¼ŒåŠ ä¸Š `matrix[i][j]` çš„å€¼ï¼Œå°±èƒ½å¤Ÿè®¡ç®—å‡ºæ¥åˆ°è¾¾ä½ç½® `(i, j)` çš„æœ€å°è·¯å¾„å’Œ**ï¼š

```cpp
int dp(vector<vector<int>>& matrix, int i, int j) {
    // éæ³•ç´¢å¼•æ£€æŸ¥
    if (i < 0 || j < 0 ||
        i >= matrix.size() ||
        j >= matrix[0].size()) {
        // è¿”å›ä¸€ä¸ªç‰¹æ®Šå€¼
        return 99999;
    }
    // base case
    if (i == 0) {
        return matrix[i][j];
    }
    // çŠ¶æ€è½¬ç§»
    return matrix[i][j] + min({
            dp(matrix, i - 1, j), 
            dp(matrix, i - 1, j - 1),
            dp(matrix, i - 1, j + 1)
        });
}

int min(int a, int b, int c) {
    return min(a, min(b, c));
}
```

å½“ç„¶ï¼Œä¸Šè¿°ä»£ç æ˜¯æš´åŠ›ç©·ä¸¾è§£æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¤‡å¿˜å½•çš„æ–¹æ³•æ¶ˆé™¤é‡å å­é—®é¢˜ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

```cpp
class Solution {
public:
    int minFallingPathSum(vector<vector<int>>& matrix) {
        int n = matrix.size();
        int res = INT_MAX;
        // å¤‡å¿˜å½•é‡Œçš„å€¼åˆå§‹åŒ–ä¸º 66666
        memo = vector<vector<int>>(n, vector<int>(n, 66666));
        // ç»ˆç‚¹å¯èƒ½åœ¨ matrix[n-1] çš„ä»»æ„ä¸€åˆ—
        for (int j = 0; j < n; j++) {
            res = min(res, dp(matrix, n - 1, j));
        }
        return res;
    }

private:
    // å¤‡å¿˜å½•
    vector<vector<int>> memo;

    int dp(vector<vector<int>>& matrix, int i, int j) {
        // 1ã€ç´¢å¼•åˆæ³•æ€§æ£€æŸ¥
        if (i < 0 || j < 0 || i >= matrix.size() || j >= matrix[0].size()) {
            return 99999;
        }
        // 2ã€base case
        if (i == 0) {
            return matrix[0][j];
        }
        // 3ã€æŸ¥æ‰¾å¤‡å¿˜å½•ï¼Œé˜²æ­¢é‡å¤è®¡ç®—
        if (memo[i][j] != 66666) {
            return memo[i][j];
        }
        // è¿›è¡ŒçŠ¶æ€è½¬ç§»
        memo[i][j] = matrix[i][j] + min({dp(matrix, i - 1, j), dp(matrix, i - 1, j - 1), dp(matrix, i - 1, j + 1)});
        return memo[i][j];
    }

    int min(initializer_list<int> values) {
        return *min_element(values.begin(), values.end());
    }
};
```

**æœ¬æ–‡å¯¹äºè¿™ä¸ª `dp` å‡½æ•°ä»”ç»†æ¢è®¨ä¸‰ä¸ªé—®é¢˜**ï¼š

1ã€å¯¹äºç´¢å¼•çš„åˆæ³•æ€§æ£€æµ‹ï¼Œè¿”å›å€¼ä¸ºä»€ä¹ˆæ˜¯ 99999ï¼Ÿå…¶ä»–çš„å€¼è¡Œä¸è¡Œï¼Ÿ

2ã€base case ä¸ºä»€ä¹ˆæ˜¯ `i == 0`ï¼Ÿ

3ã€å¤‡å¿˜å½• `memo` çš„åˆå§‹å€¼ä¸ºä»€ä¹ˆæ˜¯ 66666ï¼Ÿå…¶ä»–å€¼è¡Œä¸è¡Œï¼Ÿ

**é¦–å…ˆï¼Œè¯´è¯´ base case ä¸ºä»€ä¹ˆæ˜¯ `i == 0`ï¼Œè¿”å›å€¼ä¸ºä»€ä¹ˆæ˜¯ `matrix[0][j]`ï¼Œè¿™æ˜¯æ ¹æ® `dp` å‡½æ•°çš„å®šä¹‰æ‰€å†³å®šçš„**ã€‚

å›é¡¾æˆ‘ä»¬çš„ `dp` å‡½æ•°å®šä¹‰ï¼š

ä»ç¬¬ä¸€è¡Œï¼ˆ`matrix[0][..]`ï¼‰å‘ä¸‹è½ï¼Œè½åˆ°ä½ç½® `matrix[i][j]` çš„æœ€å°è·¯å¾„å’Œä¸º `dp(matrix, i, j)`ã€‚

æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼Œæˆ‘ä»¬å°±æ˜¯ä» `matrix[0][j]` å¼€å§‹ä¸‹è½ã€‚é‚£å¦‚æœæˆ‘ä»¬æƒ³è½åˆ°çš„ç›®çš„åœ°å°±æ˜¯ `i == 0`ï¼Œæ‰€éœ€çš„è·¯å¾„å’Œå½“ç„¶å°±æ˜¯ `matrix[0][j]` å‘—ã€‚

**å†è¯´è¯´å¤‡å¿˜å½• `memo` çš„åˆå§‹å€¼ä¸ºä»€ä¹ˆæ˜¯ 66666ï¼Œè¿™æ˜¯ç”±é¢˜ç›®ç»™å‡ºçš„æ•°æ®èŒƒå›´å†³å®šçš„**ã€‚

å¤‡å¿˜å½• `memo` æ•°ç»„çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

å°±æ˜¯é˜²æ­¢é‡å¤è®¡ç®—ï¼Œå°† `dp(matrix, i, j)` çš„è®¡ç®—ç»“æœå­˜è¿› `memo[i][j]`ï¼Œé‡åˆ°é‡å¤è®¡ç®—å¯ä»¥ç›´æ¥è¿”å›ã€‚

é‚£ä¹ˆï¼Œæˆ‘ä»¬å¿…é¡»è¦çŸ¥é“ `memo[i][j]` åˆ°åº•å­˜å‚¨è®¡ç®—ç»“æœæ²¡æœ‰ï¼Œå¯¹å§ï¼Ÿå¦‚æœå­˜ç»“æœäº†ï¼Œå°±ç›´æ¥è¿”å›ï¼›æ²¡å­˜ï¼Œå°±å»é€’å½’è®¡ç®—ã€‚

æ‰€ä»¥ï¼Œ`memo` çš„åˆå§‹å€¼ä¸€å®šå¾—æ˜¯ç‰¹æ®Šå€¼ï¼Œå’Œåˆæ³•çš„ç­”æ¡ˆæœ‰æ‰€åŒºåˆ†ã€‚

æˆ‘ä»¬å›è¿‡å¤´çœ‹çœ‹é¢˜ç›®ç»™å‡ºçš„æ•°æ®èŒƒå›´ï¼š

> `matrix` æ˜¯ `n x n` çš„äºŒç»´æ•°ç»„ï¼Œå…¶ä¸­ `1 <= n <= 100`ï¼›å¯¹äºäºŒç»´æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œæœ‰ `-100 <= matrix[i][j] <= 100`ã€‚

å‡è®¾ `matrix` çš„å¤§å°æ˜¯ 100 x 100ï¼Œæ‰€æœ‰å…ƒç´ éƒ½æ˜¯ 100ï¼Œé‚£ä¹ˆä»ç¬¬ä¸€è¡Œå¾€ä¸‹è½ï¼Œå¾—åˆ°çš„è·¯å¾„å’Œå°±æ˜¯ 100 x 100 = 10000ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§çš„åˆæ³•ç­”æ¡ˆã€‚

ç±»ä¼¼çš„ï¼Œä¾ç„¶å‡è®¾ `matrix` çš„å¤§å°æ˜¯ 100 x 100ï¼Œæ‰€æœ‰å…ƒç´ æ˜¯ -100ï¼Œé‚£ä¹ˆä»ç¬¬ä¸€è¡Œå¾€ä¸‹è½ï¼Œå°±å¾—åˆ°äº†æœ€å°çš„åˆæ³•ç­”æ¡ˆ -100 x 100 = -10000ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªé—®é¢˜çš„åˆæ³•ç»“æœä¼šè½åœ¨åŒºé—´ `[-10000, 10000]` ä¸­ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬ `memo` çš„åˆå§‹å€¼å°±è¦é¿å¼€åŒºé—´ `[-10000, 10000]`ï¼Œæ¢å¥è¯è¯´ï¼Œ`memo` çš„åˆå§‹å€¼åªè¦åœ¨åŒºé—´ `(-inf, -10001] U [10001, +inf)` ä¸­å°±å¯ä»¥ã€‚

**æœ€åï¼Œè¯´è¯´å¯¹äºä¸åˆæ³•çš„ç´¢å¼•ï¼Œè¿”å›å€¼åº”è¯¥å¦‚ä½•ç¡®å®šï¼Œè¿™éœ€è¦æ ¹æ®æˆ‘ä»¬çŠ¶æ€è½¬ç§»æ–¹ç¨‹çš„é€»è¾‘ç¡®å®š**ã€‚

å¯¹äºè¿™é“é¢˜ï¼ŒçŠ¶æ€è½¬ç§»çš„åŸºæœ¬é€»è¾‘å¦‚ä¸‹ï¼š

```cpp
int dp(int[][] matrix, int i, int j) {

    return matrix[i][j] + min(
            dp(matrix, i - 1, j), 
            dp(matrix, i - 1, j - 1),
            dp(matrix, i - 1, j + 1)
        );
}
```

æ˜¾ç„¶ï¼Œ`i - 1, j - 1, j + 1` è¿™å‡ ä¸ªè¿ç®—å¯èƒ½ä¼šé€ æˆç´¢å¼•è¶Šç•Œï¼Œå¯¹äºç´¢å¼•è¶Šç•Œçš„ `dp` å‡½æ•°ï¼Œåº”è¯¥è¿”å›ä¸€ä¸ªä¸å¯èƒ½è¢«å–åˆ°çš„å€¼ã€‚

å› ä¸ºæˆ‘ä»¬è°ƒç”¨çš„æ˜¯ `min` å‡½æ•°ï¼Œæœ€ç»ˆè¿”å›çš„å€¼æ˜¯æœ€å°å€¼ï¼Œæ‰€ä»¥å¯¹äºä¸åˆæ³•çš„ç´¢å¼•ï¼Œåªè¦ `dp` å‡½æ•°è¿”å›ä¸€ä¸ªæ°¸è¿œä¸ä¼šè¢«å–åˆ°çš„æœ€å¤§å€¼å³å¯ã€‚

åˆšæ‰è¯´äº†ï¼Œåˆæ³•ç­”æ¡ˆçš„åŒºé—´æ˜¯ `[-10000, 10000]`ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„è¿”å›å€¼åªè¦å¤§äº 10000 å°±ç›¸å½“äºä¸€ä¸ªæ°¸ä¸ä¼šå–åˆ°çš„æœ€å¤§å€¼ã€‚

æ¢å¥è¯è¯´ï¼Œåªè¦è¿”å›åŒºé—´ `[10001, +inf)` ä¸­çš„ä¸€ä¸ªå€¼ï¼Œå°±èƒ½ä¿è¯ä¸ä¼šè¢«å–åˆ°ã€‚

è‡³æ­¤ï¼Œæˆ‘ä»¬å°±æŠŠåŠ¨æ€è§„åˆ’ç›¸å…³çš„ä¸‰ä¸ªç»†èŠ‚é—®é¢˜ä¸¾ä¾‹è¯´æ˜äº†ã€‚

**æ‹“å±•å»¶ä¼¸ä¸€ä¸‹ï¼Œå»ºè®®å¤§å®¶åšé¢˜æ—¶ï¼Œé™¤äº†é¢˜æ„æœ¬èº«ï¼Œä¸€å®šä¸è¦å¿½è§†é¢˜ç›®ç»™å®šçš„å…¶ä»–ä¿¡æ¯**ã€‚

æœ¬æ–‡ä¸¾çš„ä¾‹å­ï¼Œæµ‹è¯•ç”¨ä¾‹æ•°æ®èŒƒå›´å¯ä»¥ç¡®å®šã€Œä»€ä¹ˆæ˜¯ç‰¹æ®Šå€¼ã€ï¼Œä»è€Œå¸®åŠ©æˆ‘ä»¬å°†æ€è·¯è½¬åŒ–æˆä»£ç ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œæ•°æ®èŒƒå›´è¿˜å¯ä»¥å¸®æˆ‘ä»¬ä¼°ç®—ç®—æ³•çš„æ—¶é—´/ç©ºé—´å¤æ‚åº¦ã€‚

æ¯”å¦‚è¯´ï¼Œæœ‰çš„ç®—æ³•é¢˜ï¼Œä½ åªæƒ³åˆ°ä¸€ä¸ªæš´åŠ›æ±‚è§£æ€è·¯ï¼Œæ—¶é—´å¤æ‚åº¦æ¯”è¾ƒé«˜ã€‚å¦‚æœå‘ç°é¢˜ç›®ç»™å®šçš„æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆè‚¯å®šå¯ä»¥è¯´æ˜è¿™ä¸ªæ±‚è§£æ€è·¯æœ‰é—®é¢˜æˆ–è€…å­˜åœ¨ä¼˜åŒ–çš„ç©ºé—´ã€‚

é™¤äº†æ•°æ®èŒƒå›´ï¼Œæœ‰æ—¶å€™é¢˜ç›®è¿˜ä¼šé™åˆ¶æˆ‘ä»¬ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼Œè¿™ç§ä¿¡æ¯å…¶å®ä¹Ÿæš—ç¤ºç€ä¸€äº›ä¸œè¥¿ã€‚

æ¯”å¦‚è¦æ±‚æˆ‘ä»¬çš„ç®—æ³•å¤æ‚åº¦æ˜¯ `O(NlogN)`ï¼Œä½ æƒ³æƒ³æ€ä¹ˆæ‰èƒ½æå‡ºä¸€ä¸ªå¯¹æ•°çº§åˆ«çš„å¤æ‚åº¦å‘¢ï¼Ÿ

è‚¯å®šå¾—ç”¨åˆ° [äºŒåˆ†æœç´¢](https://labuladong.online/algo/essential-technique/binary-search-framework/) æˆ–è€…äºŒå‰æ ‘ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ `TreeMap`ï¼Œ`PriorityQueue` ä¹‹ç±»çš„å¯¹å§ã€‚

å†æ¯”å¦‚ï¼Œæœ‰æ—¶å€™é¢˜ç›®è¦æ±‚ä½ çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦æ˜¯ `O(MN)`ï¼Œè¿™å¯ä»¥è”æƒ³åˆ°ä»€ä¹ˆï¼Ÿ

å¯ä»¥å¤§èƒ†çŒœæµ‹ï¼Œå¸¸è§„è§£æ³•æ˜¯ç”¨ [å›æº¯ç®—æ³•](https://labuladong.online/algo/essential-technique/backtrack-framework/) æš´åŠ›ç©·ä¸¾ï¼Œä½†æ˜¯æ›´å¥½çš„è§£æ³•æ˜¯åŠ¨æ€è§„åˆ’ï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªäºŒç»´åŠ¨æ€è§„åˆ’ï¼Œéœ€è¦ä¸€ä¸ª `M * N` çš„äºŒç»´ `dp` æ•°ç»„ï¼Œæ‰€ä»¥äº§ç”Ÿäº†è¿™æ ·ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ã€‚

å¦‚æœä½ æ—©å°±èƒ¸æœ‰æˆç«¹äº†ï¼Œé‚£å°±å½“æˆ‘æ²¡è¯´ï¼Œæ¯•ç«ŸçŒœæµ‹ä¹Ÿä¸ä¸€å®šå‡†ç¡®ï¼›ä½†å¦‚æœä½ æœ¬æ¥å°±æ²¡å•¥è§£é¢˜æ€è·¯ï¼Œé‚£æœ‰äº†è¿™äº›æ¨æµ‹ä¹‹åï¼Œæœ€èµ·ç å¯ä»¥ç»™ä½ çš„æ€è·¯ä¸€äº›æ–¹å‘å§ï¼Ÿ

æ€»ä¹‹ï¼Œå¤šåŠ¨è„‘ç­‹ï¼Œä¸æ”¾è¿‡ä»»ä½•è››ä¸é©¬è¿¹ï¼Œä½ ä¸æˆä¸ºåˆ·é¢˜å°èƒ½æ‰‹æ‰æ€ªã€‚

# å­åºåˆ—ç±»å‹é—®é¢˜

## ç»å…¸åŠ¨æ€è§„åˆ’ï¼šç¼–è¾‘è·ç¦»

> é¢˜ç›®

ç»™ä½ ä¸¤ä¸ªå•è¯ `word1` å’Œ `word2`ï¼Œ *è¯·è¿”å›å°† `word1` è½¬æ¢æˆ `word2` æ‰€ä½¿ç”¨çš„æœ€å°‘æ“ä½œæ•°* ã€‚

ä½ å¯ä»¥å¯¹ä¸€ä¸ªå•è¯è¿›è¡Œå¦‚ä¸‹ä¸‰ç§æ“ä½œï¼š

- æ’å…¥ä¸€ä¸ªå­—ç¬¦
- åˆ é™¤ä¸€ä¸ªå­—ç¬¦
- æ›¿æ¢ä¸€ä¸ªå­—ç¬¦

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼šword1 = "horse", word2 = "ros"
è¾“å‡ºï¼š3
è§£é‡Šï¼š
horse -> rorse (å°† 'h' æ›¿æ¢ä¸º 'r')
rorse -> rose (åˆ é™¤ 'r')
rose -> ros (åˆ é™¤ 'e')
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šword1 = "intention", word2 = "execution"
è¾“å‡ºï¼š5
è§£é‡Šï¼š
intention -> inention (åˆ é™¤ 't')
inention -> enention (å°† 'i' æ›¿æ¢ä¸º 'e')
enention -> exention (å°† 'n' æ›¿æ¢ä¸º 'x')
exention -> exection (å°† 'n' æ›¿æ¢ä¸º 'c')
exection -> execution (æ’å…¥ 'u')
```

**æç¤ºï¼š**

- `0 <= word1.length, word2.length <= 500`
- `word1` å’Œ `word2` ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ

### æ€è·¯

ç¼–è¾‘è·ç¦»é—®é¢˜å°±æ˜¯ç»™æˆ‘ä»¬ä¸¤ä¸ªå­—ç¬¦ä¸² `s1` å’Œ `s2`ï¼Œåªèƒ½ç”¨ä¸‰ç§æ“ä½œï¼Œè®©æˆ‘ä»¬æŠŠ `s1` å˜æˆ `s2`ï¼Œæ±‚æœ€å°‘çš„æ“ä½œæ•°ã€‚éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œä¸ç®¡æ˜¯æŠŠ `s1` å˜æˆ `s2` è¿˜æ˜¯åè¿‡æ¥ï¼Œç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥åæ–‡å°±ä»¥ `s1` å˜æˆ `s2` ä¸¾ä¾‹ã€‚

åæ–‡ [æœ€é•¿å…¬å…±å­åºåˆ—](https://labuladong.online/algo/dynamic-programming/longest-common-subsequence/) è¯´è¿‡ï¼Œ**è§£å†³ä¸¤ä¸ªå­—ç¬¦ä¸²çš„åŠ¨æ€è§„åˆ’é—®é¢˜ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨ä¸¤ä¸ªæŒ‡é’ˆ `i, j` åˆ†åˆ«æŒ‡å‘ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€åï¼Œç„¶åä¸€æ­¥æ­¥å¾€å‰ç§»åŠ¨ï¼Œç¼©å°é—®é¢˜çš„è§„æ¨¡**ã€‚

è®¾ä¸¤ä¸ªå­—ç¬¦ä¸²åˆ†åˆ«ä¸º `"rad"` å’Œ `"apple"`ï¼Œä¸ºäº†æŠŠ `s1` å˜æˆ `s2`ï¼Œç®—æ³•ä¼šè¿™æ ·è¿›è¡Œï¼š

![img](https://labuladong.online/algo/images/editDistance/edit.gif)

![img](https://labuladong.online/algo/images/editDistance/1.jpg)

è¯·è®°ä½è¿™ä¸ª GIF è¿‡ç¨‹ï¼Œè¿™æ ·å°±èƒ½ç®—å‡ºç¼–è¾‘è·ç¦»ã€‚å…³é”®åœ¨äºå¦‚ä½•åšå‡ºæ­£ç¡®çš„æ“ä½œï¼Œç¨åä¼šè®²ã€‚

æ ¹æ®ä¸Šé¢çš„ GIFï¼Œå¯ä»¥å‘ç°æ“ä½œä¸åªæœ‰ä¸‰ä¸ªï¼Œå…¶å®è¿˜æœ‰ç¬¬å››ä¸ªæ“ä½œï¼Œå°±æ˜¯ä»€ä¹ˆéƒ½ä¸è¦åšï¼ˆskipï¼‰ã€‚æ¯”å¦‚è¿™ä¸ªæƒ…å†µï¼š

![img](https://labuladong.online/algo/images/editDistance/2.jpg)

å› ä¸ºè¿™ä¸¤ä¸ªå­—ç¬¦æœ¬æ¥å°±ç›¸åŒï¼Œä¸ºäº†ä½¿ç¼–è¾‘è·ç¦»æœ€å°ï¼Œæ˜¾ç„¶ä¸åº”è¯¥å¯¹å®ƒä»¬æœ‰ä»»ä½•æ“ä½œï¼Œç›´æ¥å¾€å‰ç§»åŠ¨ `i, j` å³å¯ã€‚

è¿˜æœ‰ä¸€ä¸ªå¾ˆå®¹æ˜“å¤„ç†çš„æƒ…å†µï¼Œå°±æ˜¯ `j` èµ°å®Œ `s2` æ—¶ï¼Œå¦‚æœ `i` è¿˜æ²¡èµ°å®Œ `s1`ï¼Œé‚£ä¹ˆåªèƒ½ç”¨åˆ é™¤æ“ä½œæŠŠ `s1` ç¼©çŸ­ä¸º `s2`ã€‚æ¯”å¦‚è¿™ä¸ªæƒ…å†µï¼š

![img](https://labuladong.online/algo/images/editDistance/3.jpg)

ç±»ä¼¼çš„ï¼Œå¦‚æœ `i` èµ°å®Œ `s1` æ—¶ `j` è¿˜æ²¡èµ°å®Œäº† `s2`ï¼Œé‚£å°±åªèƒ½ç”¨æ’å…¥æ“ä½œæŠŠ `s2` å‰©ä¸‹çš„å­—ç¬¦å…¨éƒ¨æ’å…¥ `s1`ã€‚ç­‰ä¼šä¼šçœ‹åˆ°ï¼Œè¿™ä¸¤ç§æƒ…å†µå°±æ˜¯ç®—æ³•çš„ **base case**ã€‚

### ä»£ç 

å…ˆæ¢³ç†ä¸€ä¸‹ä¹‹å‰çš„æ€è·¯ï¼š

base case æ˜¯ `i` èµ°å®Œ `s1` æˆ– `j` èµ°å®Œ `s2`ï¼Œå¯ä»¥ç›´æ¥è¿”å›å¦ä¸€ä¸ªå­—ç¬¦ä¸²å‰©ä¸‹çš„é•¿åº¦ã€‚

å¯¹äºæ¯å¯¹å„¿å­—ç¬¦ `s1[i]` å’Œ `s2[j]`ï¼Œå¯ä»¥æœ‰å››ç§æ“ä½œï¼š

```
if s1[i] == s2[j]:
    å•¥éƒ½åˆ«åšï¼ˆskipï¼‰
    i, j åŒæ—¶å‘å‰ç§»åŠ¨
else:
    ä¸‰é€‰ä¸€ï¼š
        æ’å…¥ï¼ˆinsertï¼‰
        åˆ é™¤ï¼ˆdeleteï¼‰
        æ›¿æ¢ï¼ˆreplaceï¼‰
```

æœ‰è¿™ä¸ªæ¡†æ¶ï¼Œé—®é¢˜å°±å·²ç»è§£å†³äº†ã€‚è¯»è€…ä¹Ÿè®¸ä¼šé—®ï¼Œè¿™ä¸ªã€Œä¸‰é€‰ä¸€ã€åˆ°åº•è¯¥æ€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå…¨è¯•ä¸€éï¼Œå“ªä¸ªæ“ä½œæœ€åå¾—åˆ°çš„ç¼–è¾‘è·ç¦»æœ€å°ï¼Œå°±é€‰è°ã€‚è¿™é‡Œéœ€è¦é€’å½’æŠ€å·§ï¼Œå…ˆçœ‹ä¸‹æš´åŠ›è§£æ³•ä»£ç ï¼š

```cpp
class Solution {
public:
    int minDistance(string s1, string s2) {
        int m = s1.size(), n = s2.size();
        // iï¼Œj åˆå§‹åŒ–æŒ‡å‘æœ€åä¸€ä¸ªç´¢å¼•
        return dp(s1, m - 1, s2, n - 1);
    }

private:
    // å®šä¹‰ï¼šè¿”å› s1[0..i] å’Œ s2[0..j] çš„æœ€å°ç¼–è¾‘è·ç¦»
    int dp(string &s1, int i, string &s2, int j) {
        // base case
        if (i == -1) return j + 1;
        if (j == -1) return i + 1;

        if (s1[i] == s2[j]) {
            return dp(s1, i - 1, s2, j - 1); // å•¥éƒ½ä¸åš
        }
        return min({
            dp(s1, i, s2, j - 1) + 1,    // æ’å…¥
            dp(s1, i - 1, s2, j) + 1,    // åˆ é™¤
            dp(s1, i - 1, s2, j - 1) + 1 // æ›¿æ¢
        });
    }
};
```

ä¸‹é¢æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹è¿™æ®µé€’å½’ä»£ç ï¼Œbase case åº”è¯¥ä¸ç”¨è§£é‡Šäº†ï¼Œä¸»è¦è§£é‡Šä¸€ä¸‹é€’å½’éƒ¨åˆ†ã€‚

å…ˆæ¥çœ‹è¿™æ®µä»£ç ï¼š

```python
if s1[i] == s2[j]:
    return dp(s1, i - 1, s2, j - 1); # å•¥éƒ½ä¸åš
# è§£é‡Šï¼š
# æœ¬æ¥å°±ç›¸ç­‰ï¼Œä¸éœ€è¦ä»»ä½•æ“ä½œ
# s1[0..i] å’Œ s2[0..j] çš„æœ€å°ç¼–è¾‘è·ç¦»ç­‰äº
# s1[0..i-1] å’Œ s2[0..j-1] çš„æœ€å°ç¼–è¾‘è·ç¦»
# ä¹Ÿå°±æ˜¯è¯´ dp(i, j) ç­‰äº dp(i-1, j-1)
```

å¦‚æœ `s1[i] != s2[j]`ï¼Œå°±è¦å¯¹ä¸‰ä¸ªæ“ä½œé€’å½’äº†ï¼Œç¨å¾®éœ€è¦ç‚¹æ€è€ƒï¼š

```python
dp(s1, i, s2, j - 1) + 1,    # æ’å…¥
# è§£é‡Šï¼š
# æˆ‘ç›´æ¥åœ¨ s1[i] æ’å…¥ä¸€ä¸ªå’Œ s2[j] ä¸€æ ·çš„å­—ç¬¦
# é‚£ä¹ˆ s2[j] å°±è¢«åŒ¹é…äº†ï¼Œå‰ç§» jï¼Œç»§ç»­è·Ÿ i å¯¹æ¯”
# åˆ«å¿˜äº†æ“ä½œæ•°åŠ ä¸€
```

![img](https://labuladong.online/algo/images/editDistance/insert.gif)

```python
dp(s1, i - 1, s2, j) + 1,    # åˆ é™¤
# è§£é‡Šï¼š
# æˆ‘ç›´æ¥æŠŠ s[i] è¿™ä¸ªå­—ç¬¦åˆ æ‰
# å‰ç§» iï¼Œç»§ç»­è·Ÿ j å¯¹æ¯”
# æ“ä½œæ•°åŠ ä¸€
```

![img](https://labuladong.online/algo/images/editDistance/delete.gif)

```python
dp(s1, i - 1, s2, j - 1) + 1 # æ›¿æ¢
# è§£é‡Šï¼š
# æˆ‘ç›´æ¥æŠŠ s1[i] æ›¿æ¢æˆ s2[j]ï¼Œè¿™æ ·å®ƒä¿©å°±åŒ¹é…äº†
# åŒæ—¶å‰ç§» iï¼Œj ç»§ç»­å¯¹æ¯”
# æ“ä½œæ•°åŠ ä¸€
```

![img](https://labuladong.online/algo/images/editDistance/replace.gif)

ç°åœ¨ï¼Œä½ åº”è¯¥å®Œå…¨ç†è§£è¿™æ®µçŸ­å°ç²¾æ‚çš„ä»£ç äº†ã€‚è¿˜æœ‰ç‚¹å°é—®é¢˜å°±æ˜¯ï¼Œè¿™ä¸ªè§£æ³•æ˜¯æš´åŠ›è§£æ³•ï¼Œå­˜åœ¨é‡å å­é—®é¢˜ï¼Œéœ€è¦ç”¨åŠ¨æ€è§„åˆ’æŠ€å·§æ¥ä¼˜åŒ–ã€‚

### åŠ¨æ€è§„åˆ’ä¼˜åŒ–

å¤‡å¿˜å½•å¾ˆå¥½åŠ ï¼ŒåŸæ¥çš„ä»£ç ç¨åŠ ä¿®æ”¹å³å¯ï¼š

```cpp
class Solution {
private:
    // å¤‡å¿˜å½•
    vector<vector<int>> memo;
    int dp(string s1, int i, string s2, int j) {
        if (i == -1) return j + 1;
        if (j == -1) return i + 1;
        // æŸ¥å¤‡å¿˜å½•ï¼Œé¿å…é‡å å­é—®é¢˜
        if (memo[i][j] != -1) {
            return memo[i][j];
        }
        // çŠ¶æ€è½¬ç§»ï¼Œç»“æœå­˜å…¥å¤‡å¿˜å½•
        if (s1[i] == s2[j]) {
            memo[i][j] = dp(s1, i - 1, s2, j - 1);
        } else {
            memo[i][j] = min(
                dp(s1, i, s2, j - 1) + 1,
                dp(s1, i - 1, s2, j) + 1,
                dp(s1, i - 1, s2, j - 1) + 1
            );
        }
        return memo[i][j];
    }
public:
    int minDistance(string word1, string word2) {
        int m = word1.size(), n = word2.size();
        // å¤‡å¿˜å½•åˆå§‹åŒ–ä¸ºç‰¹æ®Šå€¼ï¼Œä»£è¡¨è¿˜æœªè®¡ç®—
        memo = vector<vector<int>>(m, vector<int>(n, -1));
        return dp(word1, m - 1, word2, n - 1);
    }
    int min(int a, int b, int c) {
        return min(a, min(b, c));
    }
};
```

**ä¸»è¦è¯´ä¸‹ DP table çš„è§£æ³•**ï¼š

é¦–å…ˆæ˜ç¡® `dp` æ•°ç»„çš„å«ä¹‰ï¼Œ`dp` æ•°ç»„æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œé•¿è¿™æ ·ï¼š

![img](https://labuladong.online/algo/images/editDistance/dp.jpg)

æœ‰äº†ä¹‹å‰é€’å½’è§£æ³•çš„é“ºå«ï¼Œåº”è¯¥å¾ˆå®¹æ˜“ç†è§£ã€‚`dp[..][0]` å’Œ `dp[0][..]` å¯¹åº” base caseï¼Œ`dp[i][j]` çš„å«ä¹‰å’Œä¹‹å‰çš„ `dp` å‡½æ•°ç±»ä¼¼ï¼š

```cpp
int dp(String s1, int i, String s2, int j)
// è¿”å› s1[0..i] å’Œ s2[0..j] çš„æœ€å°ç¼–è¾‘è·ç¦»

dp[i-1][j-1]
// å­˜å‚¨ s1[0..i] å’Œ s2[0..j] çš„æœ€å°ç¼–è¾‘è·ç¦»
```

`dp` å‡½æ•°çš„ base case æ˜¯ `i, j` ç­‰äº -1ï¼Œè€Œæ•°ç»„ç´¢å¼•è‡³å°‘æ˜¯ 0ï¼Œæ‰€ä»¥ `dp` æ•°ç»„ä¼šåç§»ä¸€ä½ã€‚

æ—¢ç„¶ `dp` æ•°ç»„å’Œé€’å½’ `dp` å‡½æ•°å«ä¹‰ä¸€æ ·ï¼Œä¹Ÿå°±å¯ä»¥ç›´æ¥å¥—ç”¨ä¹‹å‰çš„æ€è·¯å†™ä»£ç ï¼Œ**å”¯ä¸€ä¸åŒçš„æ˜¯ï¼ŒDP table æ˜¯è‡ªåº•å‘ä¸Šæ±‚è§£ï¼Œé€’å½’è§£æ³•æ˜¯è‡ªé¡¶å‘ä¸‹æ±‚è§£**ï¼š

```cpp
class Solution {
public:
    int minDistance(string s1, string s2) {
        int m = s1.length(), n = s2.length();
        // å®šä¹‰ï¼šs1[0..i] å’Œ s2[0..j] çš„æœ€å°ç¼–è¾‘è·ç¦»æ˜¯ dp[i+1][j+1]
        vector<vector<int>> dp(m + 1, vector<int>(n + 1, 0));
        // base case 
        for (int i = 1; i <= m; i++)
            dp[i][0] = i;
        for (int j = 1; j <= n; j++)
            dp[0][j] = j;
        // è‡ªåº•å‘ä¸Šæ±‚è§£
        for (int i = 1; i <= m; i++) {
            for (int j = 1; j <= n; j++) {
                if (s1[i-1] == s2[j-1]) {
                    dp[i][j] = dp[i - 1][j - 1];
                } else {
                    dp[i][j] = min(
                        dp[i - 1][j] + 1,
                        dp[i][j - 1] + 1,
                        dp[i - 1][j - 1] + 1
                    );
                }
            }
        }
        // å‚¨å­˜ç€æ•´ä¸ª s1 å’Œ s2 çš„æœ€å°ç¼–è¾‘è·ç¦»
        return dp[m][n];
    }

    int min(int a, int b, int c) {
        return std::min(a, std::min(b, c));
    }
};
```

### æ‰©å±•å»¶ä¼¸

ä¸€èˆ¬æ¥è¯´ï¼Œå¤„ç†ä¸¤ä¸ªå­—ç¬¦ä¸²çš„åŠ¨æ€è§„åˆ’é—®é¢˜ï¼Œéƒ½æ˜¯æŒ‰æœ¬æ–‡çš„æ€è·¯å¤„ç†ï¼Œå»ºç«‹ DP tableã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸ºæ˜“äºæ‰¾å‡ºçŠ¶æ€è½¬ç§»çš„å…³ç³»ï¼Œæ¯”å¦‚ç¼–è¾‘è·ç¦»çš„ DP tableï¼š

![img](https://labuladong.online/algo/images/editDistance/4.jpg)

è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚ï¼Œæ—¢ç„¶æ¯ä¸ª `dp[i][j]` åªå’Œå®ƒé™„è¿‘çš„ä¸‰ä¸ªçŠ¶æ€æœ‰å…³ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯å¯ä»¥å‹ç¼©æˆ `O(min(M, N))` çš„ï¼ˆMï¼ŒN æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ï¼‰ã€‚ä¸éš¾ï¼Œä½†æ˜¯å¯è§£é‡Šæ€§å¤§å¤§é™ä½ï¼Œè¯»è€…å¯ä»¥è‡ªå·±å°è¯•ä¼˜åŒ–ä¸€ä¸‹ã€‚

ä½ å¯èƒ½è¿˜ä¼šé—®ï¼Œ**è¿™é‡Œåªæ±‚å‡ºäº†æœ€å°çš„ç¼–è¾‘è·ç¦»ï¼Œé‚£å…·ä½“çš„æ“ä½œæ˜¯ä»€ä¹ˆ**ï¼Ÿ

è¿™ä¸ªå…¶å®å¾ˆç®€å•ï¼Œä»£ç ç¨åŠ ä¿®æ”¹ï¼Œç»™ dp æ•°ç»„å¢åŠ é¢å¤–çš„ä¿¡æ¯å³å¯ï¼š

```cpp
class Node {
public:
    int val;
    int choice;
    // 0 ä»£è¡¨å•¥éƒ½ä¸åš
    // 1 ä»£è¡¨æ’å…¥
    // 2 ä»£è¡¨åˆ é™¤
    // 3 ä»£è¡¨æ›¿æ¢
};
Node** dp;
```

`val` å±æ€§å°±æ˜¯ä¹‹å‰çš„ dp æ•°ç»„çš„æ•°å€¼ï¼Œ`choice` å±æ€§ä»£è¡¨æ“ä½œã€‚åœ¨åšæœ€ä¼˜é€‰æ‹©æ—¶ï¼Œé¡ºä¾¿æŠŠæ“ä½œè®°å½•ä¸‹æ¥ï¼Œç„¶åå°±ä»ç»“æœåæ¨å…·ä½“æ“ä½œã€‚

æˆ‘ä»¬çš„æœ€ç»ˆç»“æœä¸æ˜¯ `dp[m][n]` å—ï¼Œè¿™é‡Œçš„ `val` å­˜ç€æœ€å°ç¼–è¾‘è·ç¦»ï¼Œ`choice` å­˜ç€æœ€åä¸€ä¸ªæ“ä½œï¼Œæ¯”å¦‚è¯´æ˜¯æ’å…¥æ“ä½œï¼Œé‚£ä¹ˆå°±å¯ä»¥å·¦ç§»ä¸€æ ¼ï¼š

![img](https://labuladong.online/algo/images/editDistance/5.jpg)

é‡å¤æ­¤è¿‡ç¨‹ï¼Œå¯ä»¥ä¸€æ­¥æ­¥å›åˆ°èµ·ç‚¹ `dp[0][0]`ï¼Œå½¢æˆä¸€æ¡è·¯å¾„ï¼ŒæŒ‰è¿™æ¡è·¯å¾„ä¸Šçš„æ“ä½œè¿›è¡Œç¼–è¾‘ï¼Œå°±æ˜¯æœ€ä½³æ–¹æ¡ˆã€‚

![img](https://labuladong.online/algo/images/editDistance/6.jpg)

åº”å¤§å®¶çš„è¦æ±‚ï¼Œæˆ‘æŠŠè¿™ä¸ªæ€è·¯ä¹Ÿå†™å‡ºæ¥ï¼Œä½ å¯ä»¥è‡ªå·±è¿è¡Œè¯•ä¸€ä¸‹ï¼š

```cpp
int minDistance(String s1, String s2) {
    int m = s1.length(), n = s2.length();
    Node[][] dp = new Node[m + 1][n + 1];
    // base case
    for (int i = 0; i <= m; i++) {
        // s1 è½¬åŒ–æˆ s2 åªéœ€è¦åˆ é™¤ä¸€ä¸ªå­—ç¬¦
        dp[i][0] = new Node(i, 2);
    }
    for (int j = 1; j <= n; j++) {
        // s1 è½¬åŒ–æˆ s2 åªéœ€è¦æ’å…¥ä¸€ä¸ªå­—ç¬¦
        dp[0][j] = new Node(j, 1);
    }
    // çŠ¶æ€è½¬ç§»æ–¹ç¨‹
    for (int i = 1; i <= m; i++) {
        for (int j = 1; j <= n; j++) {
            if (s1.charAt(i-1) == s2.charAt(j-1)){
                // å¦‚æœä¸¤ä¸ªå­—ç¬¦ç›¸åŒï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸éœ€è¦åš
                Node node = dp[i - 1][j - 1];
                dp[i][j] = new Node(node.val, 0);
            } else {
                // å¦åˆ™ï¼Œè®°å½•ä»£ä»·æœ€å°çš„æ“ä½œ
                dp[i][j] = minNode(
                    dp[i - 1][j],
                    dp[i][j - 1],
                    dp[i-1][j-1]
                );
                // å¹¶ä¸”å°†ç¼–è¾‘è·ç¦»åŠ ä¸€
                dp[i][j].val++;
            }
        }
    }
    // æ ¹æ® dp table åæ¨å…·ä½“æ“ä½œè¿‡ç¨‹å¹¶æ‰“å°
    printResult(dp, s1, s2);
    return dp[m][n].val;
}

// è®¡ç®— delete, insert, replace ä¸­ä»£ä»·æœ€å°çš„æ“ä½œ
Node minNode(Node a, Node b, Node c) {
    Node res = new Node(a.val, 2);
    
    if (res.val > b.val) {
        res.val = b.val;
        res.choice = 1;
    }
    if (res.val > c.val) {
        res.val = c.val;
        res.choice = 3;
    }
    return res;
}
```

æœ€åï¼Œ`printResult` å‡½æ•°åæ¨ç»“æœå¹¶æŠŠå…·ä½“çš„æ“ä½œæ‰“å°å‡ºæ¥ï¼š

```java
void printResult(Node[][] dp, String s1, String s2) {
    int rows = dp.length;
    int cols = dp[0].length;
    int i = rows - 1, j = cols - 1;
    System.out.println("Change s1=" + s1 + " to s2=" + s2 + ":\n");
    while (i != 0 && j != 0) {
        char c1 = s1.charAt(i - 1);
        char c2 = s2.charAt(j - 1);
        int choice = dp[i][j].choice;
        System.out.print("s1[" + (i - 1) + "]:");
        switch (choice) {
            case 0:
                // è·³è¿‡ï¼Œåˆ™ä¸¤ä¸ªæŒ‡é’ˆåŒæ—¶å‰è¿›
                System.out.println("skip '" + c1 + "'");
                i--; j--;
                break;
            case 1:
                // å°† s2[j] æ’å…¥ s1[i]ï¼Œåˆ™ s2 æŒ‡é’ˆå‰è¿›
                System.out.println("insert '" + c2 + "'");
                j--;
                break;
            case 2:
                // å°† s1[i] åˆ é™¤ï¼Œåˆ™ s1 æŒ‡é’ˆå‰è¿›
                System.out.println("delete '" + c1 + "'");
                i--;
                break;
            case 3:
                // å°† s1[i] æ›¿æ¢æˆ s2[j]ï¼Œåˆ™ä¸¤ä¸ªæŒ‡é’ˆåŒæ—¶å‰è¿›
                System.out.println(
                    "replace '" + c1 + "'" + " with '" + c2 + "'");
                i--; j--;
                break;
        }
    }
    // å¦‚æœ s1 è¿˜æ²¡æœ‰èµ°å®Œï¼Œåˆ™å‰©ä¸‹çš„éƒ½æ˜¯éœ€è¦åˆ é™¤çš„
    while (i > 0) {
        System.out.print("s1[" + (i - 1) + "]:");
        System.out.println("delete '" + s1.charAt(i - 1) + "'");
        i--;
    }
    // å¦‚æœ s2 è¿˜æ²¡æœ‰èµ°å®Œï¼Œåˆ™å‰©ä¸‹çš„éƒ½æ˜¯éœ€è¦æ’å…¥ s1 çš„
    while (j > 0) {
        System.out.print("s1[0]:");
        System.out.println("insert '" + s2.charAt(j - 1) + "'");
        j--;
    }
}
```

# èƒŒåŒ…ç±»å‹é—®é¢˜

## 0-1èƒŒåŒ…

ç»™ä½ ä¸€ä¸ªå¯è£…è½½é‡é‡ä¸º `W` çš„èƒŒåŒ…å’Œ `N` ä¸ªç‰©å“ï¼Œæ¯ä¸ªç‰©å“æœ‰é‡é‡å’Œä»·å€¼ä¸¤ä¸ªå±æ€§ã€‚å…¶ä¸­ç¬¬ `i` ä¸ªç‰©å“çš„é‡é‡ä¸º `wt[i]`ï¼Œä»·å€¼ä¸º `val[i]`ã€‚ç°åœ¨è®©ä½ ç”¨è¿™ä¸ªèƒŒåŒ…è£…ç‰©å“ï¼Œæ¯ä¸ªç‰©å“åªèƒ½ç”¨ä¸€æ¬¡ï¼Œåœ¨ä¸è¶…è¿‡è¢«åŒ…å®¹é‡çš„å‰æä¸‹ï¼Œæœ€å¤šèƒ½è£…çš„ä»·å€¼æ˜¯å¤šå°‘ï¼Ÿ

![img](https://labuladong.online/algo/images/knapsack/1.png)

ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¾“å…¥å¦‚ä¸‹ï¼š

```
N = 3, W = 4
wt = [2, 1, 3]
val = [4, 2, 3]
```

ç®—æ³•è¿”å› 6ï¼Œé€‰æ‹©å‰ä¸¤ä»¶ç‰©å“è£…è¿›èƒŒåŒ…ï¼Œæ€»é‡é‡ 3 å°äº `W`ï¼Œå¯ä»¥è·å¾—æœ€å¤§ä»·å€¼ 6ã€‚

é¢˜ç›®å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œä¸€ä¸ªå…¸å‹çš„åŠ¨æ€è§„åˆ’é—®é¢˜ã€‚è¿™ä¸ªé¢˜ç›®ä¸­çš„ç‰©å“ä¸å¯ä»¥åˆ†å‰²ï¼Œè¦ä¹ˆè£…è¿›åŒ…é‡Œï¼Œè¦ä¹ˆä¸è£…ï¼Œä¸èƒ½è¯´åˆ‡æˆä¸¤å—è£…ä¸€åŠã€‚è¿™å°±æ˜¯ 0-1 èƒŒåŒ…è¿™ä¸ªåè¯çš„æ¥å†ã€‚

### åŠ¨æ€è§„åˆ’æ ‡å‡†å¥—è·¯

**ç¬¬ä¸€æ­¥è¦æ˜ç¡®ä¸¤ç‚¹ï¼Œã€ŒçŠ¶æ€ã€å’Œã€Œé€‰æ‹©ã€**ã€‚

å…ˆè¯´çŠ¶æ€ï¼Œå¦‚ä½•æ‰èƒ½æè¿°ä¸€ä¸ªé—®é¢˜å±€é¢ï¼Ÿåªè¦ç»™å‡ ä¸ªç‰©å“å’Œä¸€ä¸ªèƒŒåŒ…çš„å®¹é‡é™åˆ¶ï¼Œå°±å½¢æˆäº†ä¸€ä¸ªèƒŒåŒ…é—®é¢˜å‘€ã€‚**æ‰€ä»¥çŠ¶æ€æœ‰ä¸¤ä¸ªï¼Œå°±æ˜¯ã€ŒèƒŒåŒ…çš„å®¹é‡ã€å’Œã€Œå¯é€‰æ‹©çš„ç‰©å“ã€**ã€‚

å†è¯´é€‰æ‹©ï¼Œä¹Ÿå¾ˆå®¹æ˜“æƒ³åˆ°å•Šï¼Œå¯¹äºæ¯ä»¶ç‰©å“ï¼Œä½ èƒ½é€‰æ‹©ä»€ä¹ˆï¼Ÿ**é€‰æ‹©å°±æ˜¯ã€Œè£…è¿›èƒŒåŒ…ã€æˆ–è€…ã€Œä¸è£…è¿›èƒŒåŒ…ã€å˜›**ã€‚

æ˜ç™½äº†çŠ¶æ€å’Œé€‰æ‹©ï¼ŒåŠ¨æ€è§„åˆ’é—®é¢˜åŸºæœ¬ä¸Šå°±è§£å†³äº†ï¼Œå¯¹äºè‡ªåº•å‘ä¸Šçš„æ€è€ƒæ–¹å¼ï¼Œä»£ç çš„ä¸€èˆ¬æ¡†æ¶æ˜¯è¿™æ ·ï¼š

```python
for çŠ¶æ€1 in çŠ¶æ€1çš„æ‰€æœ‰å–å€¼ï¼š
    for çŠ¶æ€2 in çŠ¶æ€2çš„æ‰€æœ‰å–å€¼ï¼š
        for ...
            dp[çŠ¶æ€1][çŠ¶æ€2][...] = æ‹©ä¼˜(é€‰æ‹©1ï¼Œé€‰æ‹©2...)
```

**ç¬¬äºŒæ­¥è¦æ˜ç¡® `dp` æ•°ç»„çš„å®šä¹‰**ã€‚

é¦–å…ˆçœ‹çœ‹åˆšæ‰æ‰¾åˆ°çš„ã€ŒçŠ¶æ€ã€ï¼Œæœ‰ä¸¤ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦ä¸€ä¸ªäºŒç»´ `dp` æ•°ç»„ã€‚

`dp[i][w]` çš„å®šä¹‰å¦‚ä¸‹ï¼šå¯¹äºå‰ `i` ä¸ªç‰©å“ï¼Œå½“å‰èƒŒåŒ…çš„å®¹é‡ä¸º `w`ï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥è£…çš„æœ€å¤§ä»·å€¼æ˜¯ `dp[i][w]`ã€‚

æ¯”å¦‚è¯´ï¼Œå¦‚æœ `dp[3][5] = 6`ï¼Œå…¶å«ä¹‰ä¸ºï¼šå¯¹äºç»™å®šçš„ä¸€ç³»åˆ—ç‰©å“ä¸­ï¼Œè‹¥åªå¯¹å‰ 3 ä¸ªç‰©å“è¿›è¡Œé€‰æ‹©ï¼Œå½“èƒŒåŒ…å®¹é‡ä¸º 5 æ—¶ï¼Œæœ€å¤šå¯ä»¥è£…ä¸‹çš„ä»·å€¼ä¸º 6ã€‚

æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼Œæˆ‘ä»¬æƒ³æ±‚çš„æœ€ç»ˆç­”æ¡ˆå°±æ˜¯ `dp[N][W]`ã€‚base case å°±æ˜¯ `dp[0][..] = dp[..][0] = 0`ï¼Œå› ä¸ºæ²¡æœ‰ç‰©å“æˆ–è€…èƒŒåŒ…æ²¡æœ‰ç©ºé—´çš„æ—¶å€™ï¼Œèƒ½è£…çš„æœ€å¤§ä»·å€¼å°±æ˜¯ 0ã€‚

ç»†åŒ–ä¸Šé¢çš„æ¡†æ¶ï¼š

```python
int[][] dp[N+1][W+1]
dp[0][..] = 0
dp[..][0] = 0

for i in [1..N]:
    for w in [1..W]:
        dp[i][w] = max(
            æŠŠç‰©å“ i è£…è¿›èƒŒåŒ…,
            ä¸æŠŠç‰©å“ i è£…è¿›èƒŒåŒ…
        )
return dp[N][W]
```

**ç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®ã€Œé€‰æ‹©ã€ï¼Œæ€è€ƒçŠ¶æ€è½¬ç§»çš„é€»è¾‘**ã€‚

ç®€å•è¯´å°±æ˜¯ï¼Œä¸Šé¢ä¼ªç ä¸­ã€ŒæŠŠç‰©å“ `i` è£…è¿›èƒŒåŒ…ã€å’Œã€Œä¸æŠŠç‰©å“ `i` è£…è¿›èƒŒåŒ…ã€æ€ä¹ˆç”¨ä»£ç ä½“ç°å‡ºæ¥å‘¢ï¼Ÿ

è¿™å°±è¦ç»“åˆå¯¹ `dp` æ•°ç»„çš„å®šä¹‰ï¼Œçœ‹çœ‹è¿™ä¸¤ç§é€‰æ‹©ä¼šå¯¹çŠ¶æ€äº§ç”Ÿä»€ä¹ˆå½±å“ï¼š

å…ˆé‡ç”³ä¸€ä¸‹åˆšæ‰æˆ‘ä»¬çš„ `dp` æ•°ç»„çš„å®šä¹‰ï¼š

`dp[i][w]` è¡¨ç¤ºï¼šå¯¹äºå‰ `i` ä¸ªç‰©å“ï¼ˆä» 1 å¼€å§‹è®¡æ•°ï¼‰ï¼Œå½“å‰èƒŒåŒ…çš„å®¹é‡ä¸º `w` æ—¶ï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥è£…ä¸‹çš„æœ€å¤§ä»·å€¼æ˜¯ `dp[i][w]`ã€‚

**å¦‚æœä½ æ²¡æœ‰æŠŠè¿™ç¬¬ `i` ä¸ªç‰©å“è£…å…¥èƒŒåŒ…**ï¼Œé‚£ä¹ˆå¾ˆæ˜¾ç„¶ï¼Œæœ€å¤§ä»·å€¼ `dp[i][w]` åº”è¯¥ç­‰äº `dp[i-1][w]`ï¼Œç»§æ‰¿ä¹‹å‰çš„ç»“æœã€‚

**å¦‚æœä½ æŠŠè¿™ç¬¬ `i` ä¸ªç‰©å“è£…å…¥äº†èƒŒåŒ…**ï¼Œé‚£ä¹ˆ `dp[i][w]` åº”è¯¥ç­‰äº `val[i-1] + dp[i-1][w - wt[i-1]]`ã€‚

é¦–å…ˆï¼Œç”±äºæ•°ç»„ç´¢å¼•ä» 0 å¼€å§‹ï¼Œè€Œæˆ‘ä»¬å®šä¹‰ä¸­çš„ `i` æ˜¯ä» 1 å¼€å§‹è®¡æ•°çš„ï¼Œæ‰€ä»¥ `val[i-1]` å’Œ `wt[i-1]` è¡¨ç¤ºç¬¬ `i` ä¸ªç‰©å“çš„ä»·å€¼å’Œé‡é‡ã€‚

ä½ å¦‚æœé€‰æ‹©å°†ç¬¬ `i` ä¸ªç‰©å“è£…è¿›èƒŒåŒ…ï¼Œé‚£ä¹ˆç¬¬ `i` ä¸ªç‰©å“çš„ä»·å€¼ `val[i-1]` è‚¯å®šå°±åˆ°æ‰‹äº†ï¼Œæ¥ä¸‹æ¥ä½ å°±è¦åœ¨å‰©ä½™å®¹é‡ `w - wt[i-1]` çš„é™åˆ¶ä¸‹ï¼Œåœ¨å‰ `i - 1` ä¸ªç‰©å“ä¸­æŒ‘é€‰ï¼Œæ±‚æœ€å¤§ä»·å€¼ï¼Œå³ `dp[i-1][w - wt[i-1]]`ã€‚

ç»¼ä¸Šå°±æ˜¯ä¸¤ç§é€‰æ‹©ï¼Œæˆ‘ä»¬éƒ½å·²ç»åˆ†æå®Œæ¯•ï¼Œä¹Ÿå°±æ˜¯å†™å‡ºæ¥äº†çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œå¯ä»¥è¿›ä¸€æ­¥ç»†åŒ–ä»£ç ï¼š

```python
for i in [1..N]:
    for w in [1..W]:
        dp[i][w] = max(
            dp[i-1][w],
            dp[i-1][w - wt[i-1]] + val[i-1]
        )
return dp[N][W]
```

**æœ€åä¸€æ­¥ï¼ŒæŠŠä¼ªç ç¿»è¯‘æˆä»£ç ï¼Œå¤„ç†ä¸€äº›è¾¹ç•Œæƒ…å†µ**ã€‚

```cpp
#include <cassert>

// å®Œå…¨èƒŒåŒ…é—®é¢˜
// è¾“å…¥ï¼š
// - W: èƒŒåŒ…çš„æœ€å¤§å®¹é‡
// - N: ç‰©å“çš„æ•°é‡
// - wt: ç‰©å“çš„é‡é‡æ•°ç»„ï¼Œwt[i-1]è¡¨ç¤ºç¬¬iä¸ªç‰©å“çš„é‡é‡
// - val: ç‰©å“çš„ä»·å€¼æ•°ç»„ï¼Œval[i-1]è¡¨ç¤ºç¬¬iä¸ªç‰©å“çš„ä»·å€¼
// è¾“å‡ºï¼š
// - æœ€å¤§ä»·å€¼
int knapsack(int W, int N, int wt[], int val[]) {
    assert(N == sizeof(wt)/sizeof(wt[0])); // ç¡®ä¿Nå’Œwtçš„é•¿åº¦åŒ¹é…
    int dp[N + 1][W + 1]; // base case å·²åˆå§‹åŒ–ä¸º0
    for (int i = 1; i <= N; i++) {
        for (int w = 1; w <= W; w++) {
            if (w - wt[i - 1] < 0) {
                // è¿™ç§æƒ…å†µä¸‹åªèƒ½é€‰æ‹©ä¸è£…å…¥èƒŒåŒ…
                dp[i][w] = dp[i - 1][w];
            } else {
                // è£…å…¥æˆ–è€…ä¸è£…å…¥èƒŒåŒ…ï¼Œæ‹©ä¼˜
                dp[i][w] = std::max(
                    dp[i - 1][w - wt[i-1]] + val[i-1], 
                    dp[i - 1][w]
                );
            }
        }
    }   
    return dp[N][W];
}
```

## å­é›†èƒŒåŒ…

### é—®é¢˜åˆ†æ

> é¢˜ç›®

è¾“å…¥ä¸€ä¸ªåªåŒ…å«æ­£æ•´æ•°çš„éç©ºæ•°ç»„ `nums`ï¼Œè¯·ä½ å†™ä¸€ä¸ªç®—æ³•ï¼Œåˆ¤æ–­è¿™ä¸ªæ•°ç»„æ˜¯å¦å¯ä»¥è¢«åˆ†å‰²æˆä¸¤ä¸ªå­é›†ï¼Œä½¿å¾—ä¸¤ä¸ªå­é›†çš„å…ƒç´ å’Œç›¸ç­‰ã€‚

ç®—æ³•çš„å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

```cpp
// è¾“å…¥ä¸€ä¸ªé›†åˆï¼Œè¿”å›æ˜¯å¦èƒ½å¤Ÿåˆ†å‰²æˆå’Œç›¸ç­‰çš„ä¸¤ä¸ªå­é›†
bool canPartition(vector<int>& nums);
```

æ¯”å¦‚è¯´è¾“å…¥ `nums = [1,5,11,5]`ï¼Œç®—æ³•è¿”å› trueï¼Œå› ä¸º `nums` å¯ä»¥åˆ†å‰²æˆ `[1,5,5]` å’Œ `[11]` è¿™ä¸¤ä¸ªå­é›†ã€‚

å¦‚æœè¯´è¾“å…¥ `nums = [1,3,2,5]`ï¼Œç®—æ³•è¿”å› falseï¼Œå› ä¸º `nums` æ— è®ºå¦‚ä½•éƒ½ä¸èƒ½åˆ†å‰²æˆä¸¤ä¸ªå’Œç›¸ç­‰çš„å­é›†ã€‚

> æ€è·¯

é¦–å…ˆå›å¿†ä¸€ä¸‹èƒŒåŒ…é—®é¢˜å¤§è‡´çš„æè¿°æ˜¯ä»€ä¹ˆï¼š

ç»™ä½ ä¸€ä¸ªå¯è£…è½½é‡é‡ä¸º `W` çš„èƒŒåŒ…å’Œ `N` ä¸ªç‰©å“ï¼Œæ¯ä¸ªç‰©å“æœ‰é‡é‡å’Œä»·å€¼ä¸¤ä¸ªå±æ€§ã€‚å…¶ä¸­ç¬¬ `i` ä¸ªç‰©å“çš„é‡é‡ä¸º `wt[i]`ï¼Œä»·å€¼ä¸º `val[i]`ï¼Œç°åœ¨è®©ä½ ç”¨è¿™ä¸ªèƒŒåŒ…è£…ç‰©å“ï¼Œæœ€å¤šèƒ½è£…çš„ä»·å€¼æ˜¯å¤šå°‘ï¼Ÿ

é‚£ä¹ˆå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå¯¹é›†åˆæ±‚å’Œï¼Œå¾—å‡º `sum`ï¼ŒæŠŠé—®é¢˜è½¬åŒ–ä¸ºèƒŒåŒ…é—®é¢˜ï¼š

**ç»™ä¸€ä¸ªå¯è£…è½½é‡é‡ä¸º `sum / 2` çš„èƒŒåŒ…å’Œ `N` ä¸ªç‰©å“ï¼Œæ¯ä¸ªç‰©å“çš„é‡é‡ä¸º `nums[i]`ã€‚ç°åœ¨è®©ä½ è£…ç‰©å“ï¼Œæ˜¯å¦å­˜åœ¨ä¸€ç§è£…æ³•ï¼Œèƒ½å¤Ÿæ°å¥½å°†èƒŒåŒ…è£…æ»¡**ï¼Ÿ

ä½ çœ‹ï¼Œè¿™å°±æ˜¯èƒŒåŒ…é—®é¢˜çš„æ¨¡å‹ï¼Œç”šè‡³æ¯”æˆ‘ä»¬ä¹‹å‰çš„ç»å…¸èƒŒåŒ…é—®é¢˜è¿˜è¦ç®€å•ä¸€äº›ï¼Œ**ä¸‹é¢æˆ‘ä»¬å°±ç›´æ¥è½¬æ¢æˆèƒŒåŒ…é—®é¢˜**ï¼Œå¼€å§‹å¥—å‰æ–‡è®²è¿‡çš„èƒŒåŒ…é—®é¢˜æ¡†æ¶å³å¯ã€‚

### è§£æ³•åˆ†æ

**ç¬¬ä¸€æ­¥è¦æ˜ç¡®ä¸¤ç‚¹ï¼Œã€ŒçŠ¶æ€ã€å’Œã€Œé€‰æ‹©ã€**ã€‚

è¿™ä¸ªå‰æ–‡ [ç»å…¸åŠ¨æ€è§„åˆ’ï¼šèƒŒåŒ…é—®é¢˜](https://labuladong.online/algo/dynamic-programming/knapsack1/) å·²ç»è¯¦ç»†è§£é‡Šè¿‡äº†ï¼ŒçŠ¶æ€å°±æ˜¯ã€ŒèƒŒåŒ…çš„å®¹é‡ã€å’Œã€Œå¯é€‰æ‹©çš„ç‰©å“ã€ï¼Œé€‰æ‹©å°±æ˜¯ã€Œè£…è¿›èƒŒåŒ…ã€æˆ–è€…ã€Œä¸è£…è¿›èƒŒåŒ…ã€ã€‚

**ç¬¬äºŒæ­¥è¦æ˜ç¡® `dp` æ•°ç»„çš„å®šä¹‰**ã€‚

æŒ‰ç…§èƒŒåŒ…é—®é¢˜çš„å¥—è·¯ï¼Œå¯ä»¥ç»™å‡ºå¦‚ä¸‹å®šä¹‰ï¼š

**`dp[i][j] = x` è¡¨ç¤ºï¼Œå¯¹äºå‰ `i` ä¸ªç‰©å“ï¼ˆ`i` ä» 1 å¼€å§‹è®¡æ•°ï¼‰ï¼Œå½“å‰èƒŒåŒ…çš„å®¹é‡ä¸º `j` æ—¶ï¼Œè‹¥ `x` ä¸º `true`ï¼Œåˆ™è¯´æ˜å¯ä»¥æ°å¥½å°†èƒŒåŒ…è£…æ»¡ï¼Œè‹¥ `x` ä¸º `false`ï¼Œåˆ™è¯´æ˜ä¸èƒ½æ°å¥½å°†èƒŒåŒ…è£…æ»¡**ã€‚

æ¯”å¦‚è¯´ï¼Œå¦‚æœ `dp[4][9] = true`ï¼Œå…¶å«ä¹‰ä¸ºï¼šå¯¹äºå®¹é‡ä¸º 9 çš„èƒŒåŒ…ï¼Œè‹¥åªæ˜¯åœ¨å‰ 4 ä¸ªç‰©å“ä¸­è¿›è¡Œé€‰æ‹©ï¼Œå¯ä»¥æœ‰ä¸€ç§æ–¹æ³•æŠŠèƒŒåŒ…æ°å¥½è£…æ»¡ã€‚

æˆ–è€…è¯´å¯¹äºæœ¬é¢˜ï¼Œå«ä¹‰æ˜¯å¯¹äºç»™å®šçš„é›†åˆä¸­ï¼Œè‹¥åªåœ¨å‰ 4 ä¸ªæ•°å­—ä¸­è¿›è¡Œé€‰æ‹©ï¼Œå­˜åœ¨ä¸€ä¸ªå­é›†çš„å’Œå¯ä»¥æ°å¥½å‡‘å‡º 9ã€‚

æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼Œæˆ‘ä»¬æƒ³æ±‚çš„æœ€ç»ˆç­”æ¡ˆå°±æ˜¯ `dp[N][sum/2]`ï¼Œbase case å°±æ˜¯ `dp[..][0] = true` å’Œ `dp[0][..] = false`ï¼Œå› ä¸ºèƒŒåŒ…æ²¡æœ‰ç©ºé—´çš„æ—¶å€™ï¼Œå°±ç›¸å½“äºè£…æ»¡äº†ï¼Œè€Œå½“æ²¡æœ‰ç‰©å“å¯é€‰æ‹©çš„æ—¶å€™ï¼Œè‚¯å®šæ²¡åŠæ³•è£…æ»¡èƒŒåŒ…ã€‚

**ç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®ã€Œé€‰æ‹©ã€ï¼Œæ€è€ƒçŠ¶æ€è½¬ç§»çš„é€»è¾‘**ã€‚

å›æƒ³åˆšæ‰çš„ `dp` æ•°ç»„å«ä¹‰ï¼Œå¯ä»¥æ ¹æ®ã€Œé€‰æ‹©ã€å¯¹ `dp[i][j]` å¾—åˆ°ä»¥ä¸‹çŠ¶æ€è½¬ç§»ï¼š

å¦‚æœä¸æŠŠ `nums[i]` ç®—å…¥å­é›†ï¼Œ**æˆ–è€…è¯´ä½ ä¸æŠŠè¿™ç¬¬ `i` ä¸ªç‰©å“è£…å…¥èƒŒåŒ…**ï¼Œé‚£ä¹ˆæ˜¯å¦èƒ½å¤Ÿæ°å¥½è£…æ»¡èƒŒåŒ…ï¼Œå–å†³äºä¸Šä¸€ä¸ªçŠ¶æ€ `dp[i-1][j]`ï¼Œç»§æ‰¿ä¹‹å‰çš„ç»“æœã€‚

å¦‚æœæŠŠ `nums[i]` ç®—å…¥å­é›†ï¼Œ**æˆ–è€…è¯´ä½ æŠŠè¿™ç¬¬ `i` ä¸ªç‰©å“è£…å…¥äº†èƒŒåŒ…**ï¼Œé‚£ä¹ˆæ˜¯å¦èƒ½å¤Ÿæ°å¥½è£…æ»¡èƒŒåŒ…ï¼Œå–å†³äºçŠ¶æ€ `dp[i-1][j-nums[i-1]]`ã€‚

`dp[i - 1][j-nums[i-1]]` ä¹Ÿå¾ˆå¥½ç†è§£ï¼šä½ å¦‚æœè£…äº†ç¬¬ `i` ä¸ªç‰©å“ï¼Œå°±è¦çœ‹èƒŒåŒ…çš„å‰©ä½™é‡é‡ `j - nums[i-1]` é™åˆ¶ä¸‹æ˜¯å¦èƒ½å¤Ÿè¢«æ°å¥½è£…æ»¡ã€‚

æ¢å¥è¯è¯´ï¼Œå¦‚æœ `j - nums[i-1]` çš„é‡é‡å¯ä»¥è¢«æ°å¥½è£…æ»¡ï¼Œé‚£ä¹ˆåªè¦æŠŠç¬¬ `i` ä¸ªç‰©å“è£…è¿›å»ï¼Œä¹Ÿå¯æ°å¥½è£…æ»¡ `j` çš„é‡é‡ï¼›å¦åˆ™çš„è¯ï¼Œé‡é‡ `j` è‚¯å®šæ˜¯è£…ä¸æ»¡çš„ã€‚

**æœ€åä¸€æ­¥ï¼ŒæŠŠä¼ªç ç¿»è¯‘æˆä»£ç ï¼Œå¤„ç†ä¸€äº›è¾¹ç•Œæƒ…å†µ**ã€‚

```cpp
class Solution {
public:
    bool canPartition(vector<int>& nums) {
        int sum = 0;
        for (int num : nums) sum += num;
        // å’Œä¸ºå¥‡æ•°æ—¶ï¼Œä¸å¯èƒ½åˆ’åˆ†æˆä¸¤ä¸ªå’Œç›¸ç­‰çš„é›†åˆ
        if (sum % 2 != 0) return false;
        int n = nums.size();
        sum = sum / 2;
        vector<vector<bool>> dp(n + 1, vector<bool>(sum + 1, false));
        // base case
        for (int i = 0; i <= n; i++)
            dp[i][0] = true;

        for (int i = 1; i <= n; i++) {
            for (int j = 1; j <= sum; j++) {
                if (j - nums[i - 1] < 0) {
                    // èƒŒåŒ…å®¹é‡ä¸è¶³ï¼Œä¸èƒ½è£…å…¥ç¬¬ i ä¸ªç‰©å“
                    dp[i][j] = dp[i - 1][j];
                } else {
                    // è£…å…¥æˆ–ä¸è£…å…¥èƒŒåŒ…
                    dp[i][j] = dp[i - 1][j] || dp[i - 1][j - nums[i - 1]];
                }
            }
        }
        return dp[n][sum];
    }
};
```

### è¿›ä¸€æ­¥ä¼˜åŒ–

**æ³¨æ„åˆ° `dp[i][j]` éƒ½æ˜¯é€šè¿‡ä¸Šä¸€è¡Œ `dp[i-1][..]` è½¬ç§»è¿‡æ¥çš„**ï¼Œä¹‹å‰çš„æ•°æ®éƒ½ä¸ä¼šå†ä½¿ç”¨äº†ã€‚

```cpp
class Solution {
public:
    bool canPartition(vector<int>& nums) {
        int sum = 0;
        for (int num : nums) sum += num;
        // å’Œä¸ºå¥‡æ•°æ—¶ï¼Œä¸å¯èƒ½åˆ’åˆ†æˆä¸¤ä¸ªå’Œç›¸ç­‰çš„é›†åˆ
        if (sum % 2 != 0) return false;
        int n = nums.size();
        sum = sum / 2;
        vector<bool> dp(sum + 1, false);
        
        // base case
        dp[0] = true;

        for (int i = 0; i < n; i++) {
            for (int j = sum; j >= 0; j--) {
                if (j - nums[i] >= 0) {
                    dp[j] = dp[j] || dp[j - nums[i]];
                }
            }
        }
        return dp[sum];
    }
};
```

å…¶å®è¿™æ®µä»£ç å’Œä¹‹å‰çš„è§£æ³•æ€è·¯å®Œå…¨ç›¸åŒï¼Œåªåœ¨ä¸€è¡Œ `dp` æ•°ç»„ä¸Šæ“ä½œï¼Œ`i` æ¯è¿›è¡Œä¸€è½®è¿­ä»£ï¼Œ`dp[j]` å…¶å®å°±ç›¸å½“äº `dp[i-1][j]`ï¼Œæ‰€ä»¥åªéœ€è¦ä¸€ç»´æ•°ç»„å°±å¤Ÿç”¨äº†ã€‚

**å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ `j` åº”è¯¥ä»åå¾€å‰åå‘éå†ï¼Œå› ä¸ºæ¯ä¸ªç‰©å“ï¼ˆæˆ–è€…è¯´æ•°å­—ï¼‰åªèƒ½ç”¨ä¸€æ¬¡ï¼Œä»¥å…ä¹‹å‰çš„ç»“æœå½±å“å…¶ä»–çš„ç»“æœ**ã€‚

è‡³æ­¤ï¼Œå­é›†åˆ‡å‰²çš„é—®é¢˜å°±å®Œå…¨è§£å†³äº†ï¼Œæ—¶é—´å¤æ‚åº¦ `O(n\*sum)`ï¼Œç©ºé—´å¤æ‚åº¦ `O(sum)`ã€‚

## å®Œå…¨èƒŒåŒ…

> é¢˜ç›®

ç»™å®šä¸åŒé¢é¢çš„ç¡¬å¸ `coins` å’Œä¸€ä¸ªæ€»é‡‘é¢ `amount`ï¼Œå†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å¯ä»¥å‡‘æˆæ€»é‡‘é¢çš„ç¡¬å¸ç»„åˆæ•°ã€‚**å‡è®¾æ¯ä¸€ç§é¢é¢çš„ç¡¬å¸æœ‰æ— é™ä¸ª**ã€‚

æˆ‘ä»¬è¦å®Œæˆçš„å‡½æ•°çš„ç­¾åå¦‚ä¸‹ï¼š

```cpp
int change(int amount, vector<int>& coins);
```

æ¯”å¦‚è¯´è¾“å…¥ `amount = 5, coins = [1,2,5]`ï¼Œç®—æ³•åº”è¯¥è¿”å› 4ï¼Œå› ä¸ºæœ‰å¦‚ä¸‹ 4 ç§æ–¹å¼å¯ä»¥å‡‘å‡ºç›®æ ‡é‡‘é¢ï¼š

```
5=5
5=2+2+1
5=2+1+1+1
5=1+1+1+1+1
```

å¦‚æœè¾“å…¥çš„ `amount = 5, coins = [3]`ï¼Œç®—æ³•åº”è¯¥è¿”å› 0ï¼Œå› ä¸ºç”¨é¢é¢ä¸º 3 çš„ç¡¬å¸æ— æ³•å‡‘å‡ºæ€»é‡‘é¢ 5ã€‚

**æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªé—®é¢˜è½¬åŒ–ä¸ºèƒŒåŒ…é—®é¢˜çš„æè¿°å½¢å¼**ï¼š

æœ‰ä¸€ä¸ªèƒŒåŒ…ï¼Œæœ€å¤§å®¹é‡ä¸º `amount`ï¼Œæœ‰ä¸€ç³»åˆ—ç‰©å“ `coins`ï¼Œæ¯ä¸ªç‰©å“çš„é‡é‡ä¸º `coins[i]`ï¼Œ**æ¯ä¸ªç‰©å“çš„æ•°é‡æ— é™**ã€‚è¯·é—®æœ‰å¤šå°‘ç§æ–¹æ³•ï¼Œèƒ½å¤ŸæŠŠèƒŒåŒ…æ°å¥½è£…æ»¡ï¼Ÿ

è¿™ä¸ªé—®é¢˜å’Œæˆ‘ä»¬å‰é¢è®²è¿‡çš„ä¸¤ä¸ªèƒŒåŒ…é—®é¢˜ï¼Œæœ‰ä¸€ä¸ªæœ€å¤§çš„åŒºåˆ«å°±æ˜¯ï¼Œæ¯ä¸ªç‰©å“çš„æ•°é‡æ˜¯æ— é™çš„ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¼ è¯´ä¸­çš„ã€Œ**å®Œå…¨èƒŒåŒ…é—®é¢˜**ã€ï¼Œæ²¡å•¥é«˜å¤§ä¸Šçš„ï¼Œæ— éå°±æ˜¯çŠ¶æ€è½¬ç§»æ–¹ç¨‹æœ‰ä¸€ç‚¹å˜åŒ–è€Œå·²ã€‚

ä¸‹é¢å°±ä»¥èƒŒåŒ…é—®é¢˜çš„æè¿°å½¢å¼ï¼Œç»§ç»­æŒ‰ç…§æµç¨‹æ¥åˆ†æã€‚

### è§£é¢˜æ€è·¯

**ç¬¬ä¸€æ­¥è¦æ˜ç¡®ä¸¤ç‚¹ï¼Œã€ŒçŠ¶æ€ã€å’Œã€Œé€‰æ‹©ã€**ã€‚

çŠ¶æ€æœ‰ä¸¤ä¸ªï¼Œå°±æ˜¯ã€ŒèƒŒåŒ…çš„å®¹é‡ã€å’Œã€Œå¯é€‰æ‹©çš„ç‰©å“ã€ï¼Œé€‰æ‹©å°±æ˜¯ã€Œè£…è¿›èƒŒåŒ…ã€æˆ–è€…ã€Œä¸è£…è¿›èƒŒåŒ…ã€å˜›ï¼ŒèƒŒåŒ…é—®é¢˜çš„å¥—è·¯éƒ½æ˜¯è¿™æ ·ã€‚

æ˜ç™½äº†çŠ¶æ€å’Œé€‰æ‹©ï¼ŒåŠ¨æ€è§„åˆ’é—®é¢˜åŸºæœ¬ä¸Šå°±è§£å†³äº†ï¼Œåªè¦å¾€è¿™ä¸ªæ¡†æ¶å¥—å°±å®Œäº‹å„¿äº†ï¼š

```python
for çŠ¶æ€1 in çŠ¶æ€1çš„æ‰€æœ‰å–å€¼ï¼š
    for çŠ¶æ€2 in çŠ¶æ€2çš„æ‰€æœ‰å–å€¼ï¼š
        for ...
            dp[çŠ¶æ€1][çŠ¶æ€2][...] = è®¡ç®—(é€‰æ‹©1ï¼Œé€‰æ‹©2...)
```

**ç¬¬äºŒæ­¥è¦æ˜ç¡® `dp` æ•°ç»„çš„å®šä¹‰**ã€‚

é¦–å…ˆçœ‹çœ‹åˆšæ‰æ‰¾åˆ°çš„ã€ŒçŠ¶æ€ã€ï¼Œæœ‰ä¸¤ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦ä¸€ä¸ªäºŒç»´ `dp` æ•°ç»„ã€‚

`dp[i][j]` çš„å®šä¹‰å¦‚ä¸‹ï¼š

è‹¥åªä½¿ç”¨å‰ `i` ä¸ªç‰©å“ï¼ˆå¯ä»¥é‡å¤ä½¿ç”¨ï¼‰ï¼Œå½“èƒŒåŒ…å®¹é‡ä¸º `j` æ—¶ï¼Œæœ‰ `dp[i][j]` ç§æ–¹æ³•å¯ä»¥è£…æ»¡èƒŒåŒ…ã€‚

æ¢å¥è¯è¯´ï¼Œç¿»è¯‘å›æˆ‘ä»¬é¢˜ç›®çš„æ„æ€å°±æ˜¯ï¼š

**è‹¥åªä½¿ç”¨ `coins` ä¸­çš„å‰ `i` ä¸ªï¼ˆ`i` ä» 1 å¼€å§‹è®¡æ•°ï¼‰ç¡¬å¸çš„é¢å€¼ï¼Œè‹¥æƒ³å‡‘å‡ºé‡‘é¢ `j`ï¼Œæœ‰ `dp[i][j]` ç§å‡‘æ³•**ã€‚

ç»è¿‡ä»¥ä¸Šçš„å®šä¹‰ï¼Œå¯ä»¥å¾—åˆ°ï¼š

base case ä¸º `dp[0][..] = 0, dp[..][0] = 1`ã€‚`i = 0` ä»£è¡¨ä¸ä½¿ç”¨ä»»ä½•ç¡¬å¸é¢å€¼ï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¾ç„¶æ— æ³•å‡‘å‡ºä»»ä½•é‡‘é¢ï¼›`j = 0` ä»£è¡¨éœ€è¦å‡‘å‡ºçš„ç›®æ ‡é‡‘é¢ä¸º 0ï¼Œé‚£ä¹ˆä»€ä¹ˆéƒ½ä¸åšå°±æ˜¯å”¯ä¸€çš„ä¸€ç§å‡‘æ³•ã€‚

æˆ‘ä»¬æœ€ç»ˆæƒ³å¾—åˆ°çš„ç­”æ¡ˆå°±æ˜¯ `dp[N][amount]`ï¼Œå…¶ä¸­ `N` ä¸º `coins` æ•°ç»„çš„å¤§å°ã€‚

å¤§è‡´çš„ä¼ªç æ€è·¯å¦‚ä¸‹ï¼š

```python
int dp[N+1][amount+1]
dp[0][..] = 0
dp[..][0] = 1

for i in [1..N]:
    for j in [1..amount]:
        æŠŠç‰©å“ i è£…è¿›èƒŒåŒ…,
        ä¸æŠŠç‰©å“ i è£…è¿›èƒŒåŒ…
return dp[N][amount]
```

**ç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®ã€Œé€‰æ‹©ã€ï¼Œæ€è€ƒçŠ¶æ€è½¬ç§»çš„é€»è¾‘**ã€‚

æ³¨æ„ï¼Œæˆ‘ä»¬è¿™ä¸ªé—®é¢˜çš„ç‰¹æ®Šç‚¹åœ¨äºç‰©å“çš„æ•°é‡æ˜¯æ— é™çš„ï¼Œæ‰€ä»¥è¿™é‡Œå’Œä¹‹å‰å†™çš„ [0-1 èƒŒåŒ…é—®é¢˜](https://labuladong.online/algo/dynamic-programming/knapsack1/) æ–‡ç« æœ‰æ‰€ä¸åŒã€‚

**å¦‚æœä½ ä¸æŠŠè¿™ç¬¬ `i` ä¸ªç‰©å“è£…å…¥èƒŒåŒ…**ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ ä¸ä½¿ç”¨ `coins[i-1]` è¿™ä¸ªé¢å€¼çš„ç¡¬å¸ï¼Œé‚£ä¹ˆå‡‘å‡ºé¢é¢ `j` çš„æ–¹æ³•æ•° `dp[i][j]` åº”è¯¥ç­‰äº `dp[i-1][j]`ï¼Œç»§æ‰¿ä¹‹å‰çš„ç»“æœã€‚

**å¦‚æœä½ æŠŠè¿™ç¬¬ `i` ä¸ªç‰©å“è£…å…¥äº†èƒŒåŒ…**ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ ä½¿ç”¨ `coins[i-1]` è¿™ä¸ªé¢å€¼çš„ç¡¬å¸ï¼Œé‚£ä¹ˆ `dp[i][j]` åº”è¯¥ç­‰äº `dp[i][j-coins[i-1]]`ã€‚

`dp[i][j-coins[i-1]]` ä¹Ÿä¸éš¾ç†è§£ï¼Œå¦‚æœä½ å†³å®šä½¿ç”¨è¿™ä¸ªé¢å€¼çš„ç¡¬å¸ï¼Œé‚£ä¹ˆå°±åº”è¯¥å…³æ³¨å¦‚ä½•å‡‘å‡ºé‡‘é¢ `j - coins[i-1]`ã€‚

æ¯”å¦‚è¯´ï¼Œä½ æƒ³ç”¨é¢å€¼ä¸º 2 çš„ç¡¬å¸å‡‘å‡ºé‡‘é¢ 5ï¼Œé‚£ä¹ˆå¦‚æœä½ çŸ¥é“äº†å‡‘å‡ºé‡‘é¢ 3 çš„æ–¹æ³•ï¼Œå†åŠ ä¸Šä¸€æšé¢é¢ä¸º 2 çš„ç¡¬å¸ï¼Œä¸å°±å¯ä»¥å‡‘å‡º 5 äº†å˜›ã€‚

**ç»¼ä¸Šå°±æ˜¯ä¸¤ç§é€‰æ‹©ï¼Œè€Œæˆ‘ä»¬æƒ³æ±‚çš„ `dp[i][j]` æ˜¯ã€Œå…±æœ‰å¤šå°‘ç§å‡‘æ³•ã€ï¼Œæ‰€ä»¥ `dp[i][j]` çš„å€¼åº”è¯¥æ˜¯ä»¥ä¸Šä¸¤ç§é€‰æ‹©çš„ç»“æœä¹‹å’Œ**ï¼š

```cpp
for (int i = 1; i <= n; i++) {
    for (int j = 1; j <= amount; j++) {
        if (j - coins[i-1] >= 0)
            dp[i][j] = dp[i - 1][j] 
                     + dp[i][j-coins[i-1]];
return dp[N][W]
```

**æœ€åä¸€æ­¥ï¼ŒæŠŠä¼ªç ç¿»è¯‘æˆä»£ç ï¼Œå¤„ç†ä¸€äº›è¾¹ç•Œæƒ…å†µ**ã€‚

```cpp
int change(int amount, vector<int>& coins) {
    int n = coins.size();
    vector<vector<int>> dp(n + 1, vector<int>(amount + 1));
    // base case
    for (int i = 0; i <= n; i++) 
        dp[i][0] = 1;

    for (int i = 1; i <= n; i++) {
        for (int j = 1; j <= amount; j++)
            if (j - coins[i-1] >= 0)
                dp[i][j] = dp[i - 1][j] 
                         + dp[i][j - coins[i-1]];
            else 
                dp[i][j] = dp[i - 1][j];
    }
    return dp[n][amount];
}
```

è€Œä¸”ï¼Œæˆ‘ä»¬é€šè¿‡è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œ`dp` æ•°ç»„çš„è½¬ç§»åªå’Œ `dp[i][..]` å’Œ `dp[i-1][..]` æœ‰å…³ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å‰æ–‡è®²çš„ [åŠ¨æ€è§„åˆ’ç©ºé—´å‹ç¼©æŠ€å·§](https://labuladong.online/algo/dynamic-programming/space-optimization/)ï¼Œè¿›ä¸€æ­¥é™ä½ç®—æ³•çš„ç©ºé—´å¤æ‚åº¦ï¼š

```cpp
int change(int amount, vector<int>& coins) {
    int n = coins.size();
    vector<int> dp(amount + 1);
    dp[0] = 1; // base case
    for (int i = 0; i < n; i++)
        for (int j = 1; j <= amount; j++)
            if (j - coins[i] >= 0)
                dp[j] = dp[j] + dp[j-coins[i]];
    
    return dp[amount];
}
```

è¿™ä¸ªè§£æ³•å’Œä¹‹å‰çš„æ€è·¯å®Œå…¨ç›¸åŒï¼Œå°†äºŒç»´ `dp` æ•°ç»„å‹ç¼©ä¸ºä¸€ç»´ï¼Œæ—¶é—´å¤æ‚åº¦ O(N*amount)ï¼Œç©ºé—´å¤æ‚åº¦ O(amount)ã€‚

# åŠ¨æ€è§„åˆ’ç©æ¸¸æˆ

## åŠ¨æ€è§„åˆ’ä¹‹æœ€å°è·¯å¾„å’Œ

> é¢˜ç›®

ç°åœ¨ç»™ä½ è¾“å…¥ä¸€ä¸ªäºŒç»´æ•°ç»„ `grid`ï¼Œå…¶ä¸­çš„å…ƒç´ éƒ½æ˜¯**éè´Ÿæ•´æ•°**ï¼Œç°åœ¨ä½ ç«™åœ¨å·¦ä¸Šè§’ï¼Œ**åªèƒ½å‘å³æˆ–è€…å‘ä¸‹ç§»åŠ¨**ï¼Œéœ€è¦åˆ°è¾¾å³ä¸‹è§’ã€‚ç°åœ¨è¯·ä½ è®¡ç®—ï¼Œç»è¿‡çš„è·¯å¾„å’Œæœ€å°æ˜¯å¤šå°‘ï¼Ÿ

å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

```cpp
int minPathSum(vector<vector<int>>& grid);
```

æ¯”å¦‚é¢˜ç›®ä¸¾çš„ä¾‹å­ï¼Œè¾“å…¥å¦‚ä¸‹çš„ `grid` æ•°ç»„ï¼š

![img](https://labuladong.online/algo/images/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E5%92%8C/example.jpg)

ç®—æ³•åº”è¯¥è¿”å› 7ï¼Œæœ€å°è·¯å¾„å’Œä¸º 7ï¼Œå°±æ˜¯ä¸Šå›¾é»„è‰²çš„è·¯å¾„ã€‚

> æ€è·¯

**ä¸€èˆ¬æ¥è¯´ï¼Œè®©ä½ åœ¨äºŒç»´çŸ©é˜µä¸­æ±‚æœ€ä¼˜åŒ–é—®é¢˜ï¼ˆæœ€å¤§å€¼æˆ–è€…æœ€å°å€¼ï¼‰ï¼Œè‚¯å®šéœ€è¦é€’å½’ + å¤‡å¿˜å½•ï¼Œä¹Ÿå°±æ˜¯åŠ¨æ€è§„åˆ’æŠ€å·§**ã€‚

å°±æ‹¿é¢˜ç›®ä¸¾çš„ä¾‹å­æ¥è¯´ï¼Œæˆ‘ç»™å›¾ä¸­çš„å‡ ä¸ªæ ¼å­ç¼–ä¸ªå·æ–¹ä¾¿æè¿°ï¼š

![img](https://labuladong.online/algo/images/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E5%92%8C/minpath.jpg)

æˆ‘ä»¬æƒ³è®¡ç®—ä»èµ·ç‚¹ `D` åˆ°è¾¾ `B` çš„æœ€å°è·¯å¾„å’Œï¼Œé‚£ä½ è¯´æ€ä¹ˆæ‰èƒ½åˆ°è¾¾ `B` å‘¢ï¼Ÿ

é¢˜ç›®è¯´äº†åªèƒ½å‘å³æˆ–è€…å‘ä¸‹èµ°ï¼Œæ‰€ä»¥åªæœ‰ä» `A` æˆ–è€… `C` èµ°åˆ° `B`ã€‚

é‚£ä¹ˆç®—æ³•æ€ä¹ˆçŸ¥é“ä» `A` èµ°åˆ° `B` æ‰èƒ½ä½¿è·¯å¾„å’Œæœ€å°ï¼Œè€Œä¸æ˜¯ä» `C` èµ°åˆ° `B` å‘¢ï¼Ÿ

éš¾é“æ˜¯å› ä¸ºä½ç½® `A` çš„å…ƒç´ å¤§å°æ˜¯ 1ï¼Œä½ç½® `C` çš„å…ƒç´ æ˜¯ 2ï¼Œ1 å°äº 2ï¼Œæ‰€ä»¥ä¸€å®šè¦ä» `A` èµ°åˆ° `B` æ‰èƒ½ä½¿è·¯å¾„å’Œæœ€å°å—ï¼Ÿ

å…¶å®ä¸æ˜¯çš„ï¼Œ**çœŸæ­£çš„åŸå› æ˜¯ï¼Œä» `D` èµ°åˆ° `A` çš„æœ€å°è·¯å¾„å’Œæ˜¯ 6ï¼Œè€Œä» `D` èµ°åˆ° `C` çš„æœ€å°è·¯å¾„å’Œæ˜¯ 8ï¼Œ6 å°äº 8ï¼Œæ‰€ä»¥ä¸€å®šè¦ä» `A` èµ°åˆ° `B` æ‰èƒ½ä½¿è·¯å¾„å’Œæœ€å°**ã€‚

æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬æŠŠã€Œä» `D` èµ°åˆ° `B` çš„æœ€å°è·¯å¾„å’Œã€è¿™ä¸ªé—®é¢˜è½¬åŒ–æˆäº†ã€Œä» `D` èµ°åˆ° `A` çš„æœ€å°è·¯å¾„å’Œã€å’Œ ã€Œä» `D` èµ°åˆ° `C` çš„æœ€å°è·¯å¾„å’Œã€è¿™ä¸¤ä¸ªé—®é¢˜ã€‚

ç†è§£äº†ä¸Šé¢çš„åˆ†æï¼Œè¿™ä¸å°±æ˜¯çŠ¶æ€è½¬ç§»æ–¹ç¨‹å—ï¼Ÿæ‰€ä»¥è¿™ä¸ªé—®é¢˜è‚¯å®šä¼šç”¨åˆ°åŠ¨æ€è§„åˆ’æŠ€å·§æ¥è§£å†³ã€‚

æ¯”å¦‚æˆ‘ä»¬å®šä¹‰å¦‚ä¸‹ä¸€ä¸ª `dp` å‡½æ•°ï¼š

```cpp
int dp(int grid[][], int i, int j);
```

è¿™ä¸ª `dp` å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š

**ä»å·¦ä¸Šè§’ä½ç½® `(0, 0)` èµ°åˆ°ä½ç½® `(i, j)` çš„æœ€å°è·¯å¾„å’Œä¸º `dp(grid, i, j)`**ã€‚

æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼Œæˆ‘ä»¬æƒ³æ±‚çš„æœ€å°è·¯å¾„å’Œå°±å¯ä»¥é€šè¿‡è°ƒç”¨è¿™ä¸ª `dp` å‡½æ•°è®¡ç®—å‡ºæ¥ï¼š

```cpp
int minPathSum(vector<vector<int>>& grid) {
    int m = grid.size();
    int n = grid[0].size();
    // è®¡ç®—ä»å·¦ä¸Šè§’èµ°åˆ°å³ä¸‹è§’çš„æœ€å°è·¯å¾„å’Œ
    return dp(grid, m - 1, n - 1);
}
```

å†æ ¹æ®åˆšæ‰çš„åˆ†æï¼Œå¾ˆå®¹æ˜“å‘ç°ï¼Œ`dp(grid, i, j)` çš„å€¼å–å†³äº `dp(grid, i - 1, j)` å’Œ `dp(grid, i, j - 1)` è¿”å›çš„å€¼ã€‚

æˆ‘ä»¬å¯ä»¥ç›´æ¥å†™ä»£ç äº†ï¼š

```cpp
int dp(vector<vector<int>>& grid, int i, int j) {
    // base case
    if (i == 0 && j == 0) {
        return grid[0][0];
    }
    // å¦‚æœç´¢å¼•å‡ºç•Œï¼Œè¿”å›ä¸€ä¸ªå¾ˆå¤§çš„å€¼ï¼Œ
    // ä¿è¯åœ¨å– min çš„æ—¶å€™ä¸ä¼šè¢«å–åˆ°
    if (i < 0 || j < 0) {
        return INT_MAX;
    }

    // å·¦è¾¹å’Œä¸Šé¢çš„æœ€å°è·¯å¾„å’ŒåŠ ä¸Š grid[i][j]
    // å°±æ˜¯åˆ°è¾¾ (i, j) çš„æœ€å°è·¯å¾„å’Œ
    return min(
            dp(grid, i - 1, j), 
            dp(grid, i, j - 1)
        ) + grid[i][j];
}
```

ä¸Šè¿°ä»£ç é€»è¾‘å·²ç»å®Œæ•´äº†ï¼Œæ¥ä¸‹æ¥å°±åˆ†æä¸€ä¸‹ï¼Œè¿™ä¸ªé€’å½’ç®—æ³•æ˜¯å¦å­˜åœ¨é‡å å­é—®é¢˜ï¼Ÿæ˜¯å¦éœ€è¦ç”¨å¤‡å¿˜å½•ä¼˜åŒ–ä¸€ä¸‹æ‰§è¡Œæ•ˆç‡ï¼Ÿ

**å‰æ–‡å¤šæ¬¡è¯´è¿‡åˆ¤æ–­é‡å å­é—®é¢˜çš„æŠ€å·§ï¼Œé¦–å…ˆæŠ½è±¡å‡ºä¸Šè¿°ä»£ç çš„é€’å½’æ¡†æ¶**ï¼š

```cpp
int dp(int i, int j) {
    dp(i - 1, j); // #1
    dp(i, j - 1); // #2
}
```

å¦‚æœæˆ‘æƒ³ä» `dp(i, j)` é€’å½’åˆ° `dp(i-1, j-1)`ï¼Œæœ‰å‡ ç§ä¸åŒçš„é€’å½’è°ƒç”¨è·¯å¾„ï¼Ÿ

å¯ä»¥æ˜¯ `dp(i, j) -> #1 -> #2` æˆ–è€… `dp(i, j) -> #2 -> #1`ï¼Œä¸æ­¢ä¸€ç§ï¼Œè¯´æ˜ `dp(i-1, j-1)` ä¼šè¢«å¤šæ¬¡è®¡ç®—ï¼Œæ‰€ä»¥ä¸€å®šå­˜åœ¨é‡å å­é—®é¢˜ã€‚

é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤‡å¿˜å½•æŠ€å·§è¿›è¡Œä¼˜åŒ–ï¼š

```cpp
class Solution {
private:
    //å¤‡å¿˜å½•
    vector<vector<int>> memo;

    int dp(vector<vector<int>> &grid, int i, int j) {
        //base case
        if (i == 0 && j == 0) {
            return grid[0][0];
        }
        if (i < 0 || j < 0) {
            return INT_MAX;
        }
        //é¿å…é‡å¤è®¡ç®—
        if (memo[i][j] != -1) {
            return memo[i][j];
        }
        //å°†è®¡ç®—ç»“æœè®°å…¥å¤‡å¿˜å½•
        memo[i][j] = min(
            dp(grid, i - 1, j),
            dp(grid, i, j - 1)
        ) + grid[i][j];

        return memo[i][j];
    }

public:
    int minPathSum(vector<vector<int>>& grid) {
        int m = grid.size();
        int n = grid[0].size();
        //æ„é€ å¤‡å¿˜å½•ï¼Œåˆå§‹å€¼å…¨éƒ¨è®¾ä¸º -1
        memo = vector<vector<int>>(m, vector<int>(n, -1));
        return dp(grid, m - 1, n - 1);
    }
};
```

è‡³æ­¤ï¼Œæœ¬é¢˜å°±ç®—æ˜¯è§£å†³äº†ï¼Œæ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦éƒ½æ˜¯ `O(MN)`ï¼Œæ ‡å‡†çš„è‡ªé¡¶å‘ä¸‹åŠ¨æ€è§„åˆ’è§£æ³•ã€‚

èƒ½ä¸èƒ½ç”¨è‡ªåº•å‘ä¸Šçš„è¿­ä»£è§£æ³•æ¥åšè¿™é“é¢˜å‘¢ï¼Ÿå®Œå…¨å¯ä»¥çš„ã€‚

é¦–å…ˆï¼Œç±»ä¼¼åˆšæ‰çš„ `dp` å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªäºŒç»´ `dp` æ•°ç»„ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š

**ä»å·¦ä¸Šè§’ä½ç½® `(0, 0)` èµ°åˆ°ä½ç½® `(i, j)` çš„æœ€å°è·¯å¾„å’Œä¸º `dp[i][j]`**ã€‚

çŠ¶æ€è½¬ç§»æ–¹ç¨‹å½“ç„¶ä¸ä¼šå˜çš„ï¼Œ`dp[i][j]` ä¾ç„¶å–å†³äº `dp[i-1][j]` å’Œ `dp[i][j-1]`ï¼Œç›´æ¥çœ‹ä»£ç å§ï¼š

```cpp
class Solution {
public:
    int minPathSum(vector<vector<int>>& grid) {
        int m = grid.size();
        int n = grid[0].size();
        vector<vector<int>> dp(m, vector<int>(n, 0));

        // **** base case ****
        dp[0][0] = grid[0][0];

        for (int i = 1; i < m; i++)
            dp[i][0] = dp[i - 1][0] + grid[i][0];
        
        for (int j = 1; j < n; j++)
            dp[0][j] = dp[0][j - 1] + grid[0][j];
        // *******************

        // çŠ¶æ€è½¬ç§»
        for (int i = 1; i < m; i++) {
            for (int j = 1; j < n; j++) {
                dp[i][j] = min(
                    dp[i - 1][j],
                    dp[i][j - 1]
                ) + grid[i][j];
            }
        }

        return dp[m - 1][n - 1];
    }
};
```

**è¿™ä¸ªè§£æ³•çš„ base case çœ‹èµ·æ¥å’Œé€’å½’è§£æ³•ç•¥æœ‰ä¸åŒï¼Œä½†å®é™…ä¸Šæ˜¯ä¸€æ ·çš„**ã€‚

å› ä¸ºçŠ¶æ€è½¬ç§»ä¸ºä¸‹é¢è¿™æ®µä»£ç ï¼š

```java
dp[i][j] = Math.min(
    dp[i - 1][j],
    dp[i][j - 1]
) + grid[i][j];
```

é‚£å¦‚æœ `i` æˆ–è€… `j` ç­‰äº 0 çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°ç´¢å¼•è¶Šç•Œçš„é”™è¯¯ã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦æå‰è®¡ç®—å‡º `dp[0][..]` å’Œ `dp[..][0]`ï¼Œç„¶åè®© `i` å’Œ `j` çš„å€¼ä» 1 å¼€å§‹è¿­ä»£ã€‚

`dp[0][..]` å’Œ `dp[..][0]` çš„å€¼æ€ä¹ˆç®—å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—çš„è·¯å¾„å’Œåªæœ‰ä¸‹é¢è¿™ä¸€ç§æƒ…å†µå˜›ï¼š

![img](https://labuladong.online/algo/images/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E5%92%8C/1.jpeg)

é‚£ä¹ˆæŒ‰ç…§ `dp` æ•°ç»„çš„å®šä¹‰ï¼Œ`dp[i][0] = sum(grid[0..i][0]), dp[0][j] = sum(grid[0][0..j])`ï¼Œä¹Ÿå°±æ˜¯å¦‚ä¸‹ä»£ç ï¼š

```cpp
// **** base case ****
dp[0][0] = grid[0][0];

for (int i = 1; i < m; i++)
    dp[i][0] = dp[i - 1][0] + grid[i][0];

for (int j = 1; j < n; j++)
    dp[0][j] = dp[0][j - 1] + grid[0][j];        
// *******************
```

> å¦‚ä½•ä¼˜åŒ–ç©ºé—´å¤æ‚åº¦

ä¹Ÿå¯ä»¥ç”¨æ»šåŠ¨æ•°ç»„çš„æ€è·¯ï¼Œä¸è¿‡è¿™é‡Œçš„æ»šåŠ¨æ•°ç»„ä¸æ˜¯æ•°å­—ï¼Œè€Œæ˜¯çœŸçš„æ•°ç»„ï¼Œåˆ©ç”¨ä¸¤ä¸ª`vector`è®°å½•ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—çš„æ•°æ®ï¼Œç„¶åæ›´æ–°å³å¯ã€‚

## é€šå…³ã€Šé­”å¡”ã€‹

ã€Œé­”å¡”ã€æ˜¯ä¸€æ¬¾ç»å…¸çš„åœ°ç‰¢ç±»æ¸¸æˆï¼Œç¢°æ€ªç‰©è¦æ‰è¡€ï¼Œåƒè¡€ç“¶èƒ½åŠ è¡€ï¼Œä½ è¦æ”¶é›†é’¥åŒ™ï¼Œä¸€å±‚ä¸€å±‚ä¸Šæ¥¼ï¼Œæœ€åæ•‘å‡ºç¾ä¸½çš„å…¬ä¸»ã€‚

ç°åœ¨æ‰‹æœºä¸Šä»ç„¶å¯ä»¥ç©è¿™ä¸ªæ¸¸æˆï¼š

![img](https://labuladong.online/algo/images/%E5%9C%B0%E4%B8%8B%E5%9F%8E/0.png)

> é¢˜ç›®

è¾“å…¥ä¸€ä¸ªå­˜å‚¨ç€æ•´æ•°çš„äºŒç»´æ•°ç»„ `grid`ï¼Œå¦‚æœ `grid[i][j] > 0`ï¼Œè¯´æ˜è¿™ä¸ªæ ¼å­è£…ç€è¡€ç“¶ï¼Œç»è¿‡å®ƒå¯ä»¥å¢åŠ å¯¹åº”çš„ç”Ÿå‘½å€¼ï¼›å¦‚æœ `grid[i][j] == 0`ï¼Œåˆ™è¿™æ˜¯ä¸€ä¸ªç©ºæ ¼å­ï¼Œç»è¿‡å®ƒä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ï¼›å¦‚æœ `grid[i][j] < 0`ï¼Œè¯´æ˜è¿™ä¸ªæ ¼å­æœ‰æ€ªç‰©ï¼Œç»è¿‡å®ƒä¼šæŸå¤±å¯¹åº”çš„ç”Ÿå‘½å€¼ã€‚

ç°åœ¨ä½ æ˜¯ä¸€åéª‘å£«ï¼Œå°†ä¼šå‡ºç°åœ¨æœ€å·¦ä¸Šè§’ï¼Œå…¬ä¸»è¢«å›°åœ¨æœ€å³ä¸‹è§’ï¼Œä½ åªèƒ½å‘å³å’Œå‘ä¸‹ç§»åŠ¨ï¼Œè¯·é—®ä½ åˆå§‹è‡³å°‘éœ€è¦å¤šå°‘ç”Ÿå‘½å€¼æ‰èƒ½æˆåŠŸæ•‘å‡ºå…¬ä¸»ï¼Ÿ

**æ¢å¥è¯è¯´ï¼Œå°±æ˜¯é—®ä½ è‡³å°‘éœ€è¦å¤šå°‘åˆå§‹ç”Ÿå‘½å€¼ï¼Œèƒ½å¤Ÿè®©éª‘å£«ä»æœ€å·¦ä¸Šè§’ç§»åŠ¨åˆ°æœ€å³ä¸‹è§’ï¼Œä¸”ä»»ä½•æ—¶å€™ç”Ÿå‘½å€¼éƒ½è¦å¤§äº 0**ã€‚

å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

```cpp
int calculateMinimumHP(vector<vector<int>>& grid);
```

> æ€è·¯

æ¯”å¦‚é¢˜ç›®ç»™æˆ‘ä»¬ä¸¾çš„ä¾‹å­ï¼Œè¾“å…¥å¦‚ä¸‹ä¸€ä¸ªäºŒç»´æ•°ç»„ `grid`ï¼Œç”¨ `K` è¡¨ç¤ºéª‘å£«ï¼Œç”¨ `P` è¡¨ç¤ºå…¬ä¸»ï¼š

![img](https://labuladong.online/algo/images/%E5%9C%B0%E4%B8%8B%E5%9F%8E/1.png)

ç®—æ³•åº”è¯¥è¿”å› 7ï¼Œä¹Ÿå°±æ˜¯è¯´éª‘å£«çš„åˆå§‹ç”Ÿå‘½å€¼**è‡³å°‘**ä¸º 7 æ—¶æ‰èƒ½æˆåŠŸæ•‘å‡ºå…¬ä¸»ï¼Œè¡Œè¿›è·¯çº¿å¦‚å›¾ä¸­çš„ç®­å¤´æ‰€ç¤ºã€‚

ä¸Šæ–‡ [æœ€å°è·¯å¾„å’Œ](https://labuladong.online/algo/dynamic-programming/minimum-path-sum/) å†™è¿‡ç±»ä¼¼çš„é—®é¢˜ï¼Œé—®ä½ ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„æœ€å°è·¯å¾„å’Œæ˜¯å¤šå°‘ã€‚

æˆ‘ä»¬åšç®—æ³•é¢˜ä¸€å®šè¦å°è¯•ä¸¾ä¸€åä¸‰ï¼Œæ„Ÿè§‰ä»Šå¤©è¿™é“é¢˜å’Œæœ€å°è·¯å¾„å’Œæœ‰ç‚¹å…³ç³»å¯¹å§ï¼Ÿ

æƒ³è¦æœ€å°åŒ–éª‘å£«çš„åˆå§‹ç”Ÿå‘½å€¼ï¼Œæ˜¯ä¸æ˜¯æ„å‘³ç€è¦æœ€å¤§åŒ–éª‘å£«è¡Œè¿›è·¯çº¿ä¸Šçš„è¡€ç“¶ï¼Ÿæ˜¯ä¸æ˜¯ç›¸å½“äºæ±‚ã€Œæœ€å¤§è·¯å¾„å’Œã€ï¼Ÿæ˜¯ä¸æ˜¯å¯ä»¥ç›´æ¥å¥—ç”¨è®¡ç®—ã€Œæœ€å°è·¯å¾„å’Œã€çš„æ€è·¯ï¼Ÿ

ä½†æ˜¯ç¨åŠ æ€è€ƒï¼Œå‘ç°è¿™ä¸ªæ¨è®ºå¹¶ä¸æˆç«‹ï¼Œåƒåˆ°æœ€å¤šçš„è¡€ç“¶ï¼Œå¹¶ä¸ä¸€å®šå°±èƒ½è·å¾—æœ€å°çš„åˆå§‹ç”Ÿå‘½å€¼ã€‚

æ¯”å¦‚å¦‚ä¸‹è¿™ç§æƒ…å†µï¼Œå¦‚æœæƒ³è¦åƒåˆ°æœ€å¤šçš„è¡€ç“¶è·å¾—ã€Œæœ€å¤§è·¯å¾„å’Œã€ï¼Œåº”è¯¥æŒ‰ç…§ä¸‹å›¾ç®­å¤´æ‰€ç¤ºçš„è·¯å¾„ï¼Œåˆå§‹ç”Ÿå‘½å€¼éœ€è¦ 11ï¼š

![img](https://labuladong.online/algo/images/%E5%9C%B0%E4%B8%8B%E5%9F%8E/2.png)

ä½†ä¹Ÿå¾ˆå®¹æ˜“çœ‹åˆ°ï¼Œæ­£ç¡®çš„ç­”æ¡ˆåº”è¯¥æ˜¯ä¸‹å›¾ç®­å¤´æ‰€ç¤ºçš„è·¯å¾„ï¼Œåˆå§‹ç”Ÿå‘½å€¼åªéœ€è¦ 1ï¼š

![img](https://labuladong.online/algo/images/%E5%9C%B0%E4%B8%8B%E5%9F%8E/3.png)

**æ‰€ä»¥ï¼Œå…³é”®ä¸åœ¨äºåƒæœ€å¤šçš„è¡€ç“¶ï¼Œè€Œæ˜¯åœ¨äºå¦‚ä½•æŸå¤±æœ€å°‘çš„ç”Ÿå‘½å€¼**ã€‚

è¿™ç±»æ±‚æœ€å€¼çš„é—®é¢˜ï¼Œè‚¯å®šè¦å€ŸåŠ©åŠ¨æ€è§„åˆ’æŠ€å·§ï¼Œè¦åˆç†è®¾è®¡ `dp` æ•°ç»„/å‡½æ•°çš„å®šä¹‰ã€‚ç±»æ¯”å‰æ–‡ [æœ€å°è·¯å¾„å’Œé—®é¢˜](https://labuladong.online/algo/dynamic-programming/minimum-path-sum/)ï¼Œ`dp` å‡½æ•°ç­¾åè‚¯å®šé•¿è¿™æ ·ï¼š

```cpp
int dp(int** grid, int i, int j);
```

ä½†æ˜¯è¿™é“é¢˜å¯¹ `dp` å‡½æ•°çš„å®šä¹‰æ¯”è¾ƒæœ‰æ„æ€ï¼ŒæŒ‰ç…§å¸¸ç†ï¼Œè¿™ä¸ª `dp` å‡½æ•°çš„å®šä¹‰åº”è¯¥æ˜¯ï¼š

**ä»å·¦ä¸Šè§’ï¼ˆ`grid[0][0]`ï¼‰èµ°åˆ° `grid[i][j]` è‡³å°‘éœ€è¦ `dp(grid, i, j)` çš„ç”Ÿå‘½å€¼**ã€‚

è¿™æ ·å®šä¹‰çš„è¯ï¼Œbase case å°±æ˜¯ `i, j` éƒ½ç­‰äº 0 çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ä»£ç ï¼š

```cpp
int dp(vector<vector<int>>& grid, int i, int j) {
    // base case
    if (i == 0 && j == 0) {
        // ä¿è¯éª‘å£«è½åœ°ä¸æ­»å°±è¡Œäº†
        return grid[i][j] > 0 ? 1 : -grid[i][j] + 1;
    }
    ...
}

int calculateMinimumHP(vector<vector<int>>& grid) {
    int m = grid.size();
    int n = grid[0].size();
    // æˆ‘ä»¬æƒ³è®¡ç®—å·¦ä¸Šè§’åˆ°å³ä¸‹è§’æ‰€éœ€çš„æœ€å°ç”Ÿå‘½å€¼
    return dp(grid, m - 1, n - 1);
}
```

æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ‰¾çŠ¶æ€è½¬ç§»äº†ï¼Œè¿˜è®°å¾—å¦‚ä½•æ‰¾çŠ¶æ€è½¬ç§»æ–¹ç¨‹å—ï¼Ÿæˆ‘ä»¬è¿™æ ·å®šä¹‰ `dp` å‡½æ•°èƒ½å¦æ­£ç¡®è¿›è¡ŒçŠ¶æ€è½¬ç§»å‘¢ï¼Ÿ

æˆ‘ä»¬å¸Œæœ› `dp(i, j)` èƒ½å¤Ÿé€šè¿‡ `dp(i-1, j)` å’Œ `dp(i, j-1)` æ¨å¯¼å‡ºæ¥ï¼Œè¿™æ ·å°±èƒ½ä¸æ–­é€¼è¿‘ base caseï¼Œä¹Ÿå°±èƒ½å¤Ÿæ­£ç¡®è¿›è¡ŒçŠ¶æ€è½¬ç§»ã€‚

å…·ä½“æ¥è¯´ï¼Œã€Œåˆ°è¾¾ `A` çš„æœ€å°ç”Ÿå‘½å€¼ã€åº”è¯¥èƒ½å¤Ÿç”±ã€Œåˆ°è¾¾ `B` çš„æœ€å°ç”Ÿå‘½å€¼ã€å’Œã€Œåˆ°è¾¾ `C` çš„æœ€å°ç”Ÿå‘½å€¼ã€æ¨å¯¼å‡ºæ¥ï¼š

![img](https://labuladong.online/algo/images/%E5%9C%B0%E4%B8%8B%E5%9F%8E/4.png)

**ä½†é—®é¢˜æ˜¯ï¼Œèƒ½æ¨å‡ºæ¥ä¹ˆï¼Ÿå®é™…ä¸Šæ˜¯ä¸èƒ½çš„**ã€‚

å› ä¸ºæŒ‰ç…§ `dp` å‡½æ•°çš„å®šä¹‰ï¼Œä½ åªçŸ¥é“ã€Œèƒ½å¤Ÿä»å·¦ä¸Šè§’åˆ°è¾¾ `B` çš„æœ€å°ç”Ÿå‘½å€¼ã€ï¼Œä½†å¹¶ä¸çŸ¥é“ã€Œåˆ°è¾¾ `B` æ—¶çš„ç”Ÿå‘½å€¼ã€ã€‚

ã€Œåˆ°è¾¾ `B` æ—¶çš„ç”Ÿå‘½å€¼ã€æ˜¯è¿›è¡ŒçŠ¶æ€è½¬ç§»çš„å¿…è¦å‚è€ƒï¼Œä¸¾ä¸ªä¾‹å­ä½ å°±æ˜ç™½äº†ï¼Œå‡è®¾ä¸‹å›¾è¿™ç§æƒ…å†µï¼š

![img](https://labuladong.online/algo/images/%E5%9C%B0%E4%B8%8B%E5%9F%8E/5.png)

è¿™ç§æƒ…å†µä¸‹ï¼Œéª‘å£«æ•‘å…¬ä¸»çš„æœ€ä¼˜è·¯çº¿æ˜¯ä»€ä¹ˆï¼Ÿ

æ˜¾ç„¶æ˜¯æŒ‰ç…§å›¾ä¸­è“è‰²çš„çº¿èµ°åˆ° `B`ï¼Œæœ€åèµ°åˆ° `A` å¯¹å§ï¼Œè¿™æ ·åˆå§‹è¡€é‡åªéœ€è¦ 1 å°±å¯ä»¥ï¼›å¦‚æœèµ°é»„è‰²ç®­å¤´è¿™æ¡è·¯ï¼Œå…ˆèµ°åˆ° `C` ç„¶åèµ°åˆ° `A`ï¼Œåˆå§‹è¡€é‡è‡³å°‘éœ€è¦ 6ã€‚

ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿéª‘å£«èµ°åˆ° `B` å’Œ `C` çš„æœ€å°‘åˆå§‹è¡€é‡éƒ½æ˜¯ 1ï¼Œä¸ºä»€ä¹ˆæœ€åæ˜¯ä» `B` èµ°åˆ° `A`ï¼Œè€Œä¸æ˜¯ä» `C` èµ°åˆ° `A` å‘¢ï¼Ÿ

å› ä¸ºéª‘å£«èµ°åˆ° `B` çš„æ—¶å€™ç”Ÿå‘½å€¼ä¸º 11ï¼Œè€Œèµ°åˆ° `C` çš„æ—¶å€™ç”Ÿå‘½å€¼ä¾ç„¶æ˜¯ 1ã€‚

å¦‚æœéª‘å£«æ‰§æ„è¦é€šè¿‡ `C` èµ°åˆ° `A`ï¼Œé‚£ä¹ˆåˆå§‹è¡€é‡å¿…é¡»åŠ åˆ° 6 ç‚¹æ‰è¡Œï¼›è€Œå¦‚æœé€šè¿‡ `B` èµ°åˆ° `A`ï¼Œåˆå§‹è¡€é‡ä¸º 1 å°±å¤Ÿäº†ï¼Œå› ä¸ºè·¯ä¸Šåƒåˆ°è¡€ç“¶äº†ï¼Œç”Ÿå‘½å€¼è¶³å¤ŸæŠ— `A` ä¸Šé¢æ€ªç‰©çš„ä¼¤å®³ã€‚

è¿™ä¸‹åº”è¯¥è¯´çš„å¾ˆæ¸…æ¥šäº†ï¼Œå†å›é¡¾æˆ‘ä»¬å¯¹ `dp` å‡½æ•°çš„å®šä¹‰ï¼Œä¸Šå›¾çš„æƒ…å†µï¼Œç®—æ³•åªçŸ¥é“ `dp(1, 2) = dp(2, 1) = 1`ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ€ä¹ˆåšå‡ºæ­£ç¡®çš„å†³ç­–ï¼Œè®¡ç®—å‡º `dp(2, 2)` å‘¢ï¼Ÿ

**æ‰€ä»¥è¯´ï¼Œæˆ‘ä»¬ä¹‹å‰å¯¹ `dp` æ•°ç»„çš„å®šä¹‰æ˜¯é”™è¯¯çš„ï¼Œä¿¡æ¯é‡ä¸è¶³ï¼Œç®—æ³•æ— æ³•åšå‡ºæ­£ç¡®çš„çŠ¶æ€è½¬ç§»**ã€‚

æ­£ç¡®çš„åšæ³•éœ€è¦åå‘æ€è€ƒï¼Œä¾ç„¶æ˜¯å¦‚ä¸‹çš„ `dp` å‡½æ•°ï¼š

```cpp
int dp(int** grid, int i, int j);
```

ä½†æ˜¯æˆ‘ä»¬è¦ä¿®æ”¹ `dp` å‡½æ•°çš„å®šä¹‰ï¼š

**ä» `grid[i][j]` åˆ°è¾¾ç»ˆç‚¹ï¼ˆå³ä¸‹è§’ï¼‰æ‰€éœ€çš„æœ€å°‘ç”Ÿå‘½å€¼æ˜¯ `dp(grid, i, j)`**ã€‚

é‚£ä¹ˆå¯ä»¥è¿™æ ·å†™ä»£ç ï¼š

```cpp
int calculateMinimumHP(vector<vector<int>>& grid) {
    // æˆ‘ä»¬æƒ³è®¡ç®—å·¦ä¸Šè§’åˆ°å³ä¸‹è§’æ‰€éœ€çš„æœ€å°ç”Ÿå‘½å€¼
    return dp(grid, 0, 0);
}

int dp(vector<vector<int>>& grid, int i, int j) {
    int m = grid.size();
    int n = grid[0].size();
    // base case
    if (i == m - 1 && j == n - 1) {
        return grid[i][j] >= 0 ? 1 : -grid[i][j] + 1;
    }
    ...
}
```

æ ¹æ®æ–°çš„ `dp` å‡½æ•°å®šä¹‰å’Œ base caseï¼Œæˆ‘ä»¬æƒ³æ±‚ `dp(0, 0)`ï¼Œé‚£å°±åº”è¯¥è¯•å›¾é€šè¿‡ `dp(i, j+1)` å’Œ `dp(i+1, j)` æ¨å¯¼å‡º `dp(i, j)`ï¼Œè¿™æ ·æ‰èƒ½ä¸æ–­é€¼è¿‘ base caseï¼Œæ­£ç¡®è¿›è¡ŒçŠ¶æ€è½¬ç§»ã€‚

å…·ä½“æ¥è¯´ï¼Œã€Œä» `A` åˆ°è¾¾å³ä¸‹è§’çš„æœ€å°‘ç”Ÿå‘½å€¼ã€åº”è¯¥ç”±ã€Œä» `B` åˆ°è¾¾å³ä¸‹è§’çš„æœ€å°‘ç”Ÿå‘½å€¼ã€å’Œã€Œä» `C` åˆ°è¾¾å³ä¸‹è§’çš„æœ€å°‘ç”Ÿå‘½å€¼ã€æ¨å¯¼å‡ºæ¥ï¼š

![img](https://labuladong.online/algo/images/%E5%9C%B0%E4%B8%8B%E5%9F%8E/6.png)

èƒ½ä¸èƒ½æ¨å¯¼å‡ºæ¥å‘¢ï¼Ÿè¿™æ¬¡æ˜¯å¯ä»¥çš„ï¼Œå‡è®¾ `dp(0, 1) = 5, dp(1, 0) = 4`ï¼Œé‚£ä¹ˆå¯ä»¥è‚¯å®šè¦ä» `A` èµ°å‘ `C`ï¼Œå› ä¸º 4 å°äº 5 å˜›ã€‚

é‚£ä¹ˆæ€ä¹ˆæ¨å‡º `dp(0, 0)` æ˜¯å¤šå°‘å‘¢ï¼Ÿ

å‡è®¾ `A` çš„å€¼ä¸º 1ï¼Œæ—¢ç„¶çŸ¥é“ä¸‹ä¸€æ­¥è¦å¾€ `C` èµ°ï¼Œä¸” `dp(1, 0) = 4` æ„å‘³ç€èµ°åˆ° `grid[1][0]` çš„æ—¶å€™è‡³å°‘è¦æœ‰ 4 ç‚¹ç”Ÿå‘½å€¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç¡®å®šéª‘å£«å‡ºç°åœ¨ `A` ç‚¹æ—¶éœ€è¦ 4 - 1 = 3 ç‚¹åˆå§‹ç”Ÿå‘½å€¼ï¼Œå¯¹å§ã€‚

é‚£å¦‚æœ `A` çš„å€¼ä¸º 10ï¼Œè½åœ°å°±èƒ½æ¡åˆ°ä¸€ä¸ªå¤§è¡€ç“¶ï¼Œè¶…å‡ºäº†åç»­éœ€æ±‚ï¼Œ4 - 10 = -6 æ„å‘³ç€éª‘å£«çš„åˆå§‹ç”Ÿå‘½å€¼ä¸ºè´Ÿæ•°ï¼Œè¿™æ˜¾ç„¶ä¸å¯ä»¥ï¼Œéª‘å£«çš„ç”Ÿå‘½å€¼å°äº 1 å°±æŒ‚äº†ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹éª‘å£«çš„åˆå§‹ç”Ÿå‘½å€¼åº”è¯¥æ˜¯ 1ã€‚

ç»¼ä¸Šï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹å·²ç»æ¨å‡ºæ¥äº†ï¼š

```cpp
int res = min(
    dp(i + 1, j),
    dp(i, j + 1)
) - grid[i][j];

dp(i, j) = res <= 0 ? 1 : res;
```

æ ¹æ®è¿™ä¸ªæ ¸å¿ƒé€»è¾‘ï¼ŒåŠ ä¸€ä¸ªå¤‡å¿˜å½•æ¶ˆé™¤é‡å å­é—®é¢˜ï¼Œå°±å¯ä»¥ç›´æ¥å†™å‡ºæœ€ç»ˆçš„ä»£ç äº†ï¼š

```cpp
class Solution {
public:
    // ä¸»å‡½æ•°
    int calculateMinimumHP(vector<vector<int>>& grid) {
        int m = grid.size();
        int n = grid[0].size();
        // å¤‡å¿˜å½•ä¸­éƒ½åˆå§‹åŒ–ä¸º -1
        memo = vector<vector<int>>(m, vector<int>(n, -1));

        return dp(grid, 0, 0);
    }

private:
    // å¤‡å¿˜å½•ï¼Œæ¶ˆé™¤é‡å å­é—®é¢˜
    vector<vector<int>> memo;

    // å®šä¹‰ï¼šä» (i, j) åˆ°è¾¾å³ä¸‹è§’ï¼Œéœ€è¦çš„åˆå§‹è¡€é‡è‡³å°‘æ˜¯å¤šå°‘
    int dp(vector<vector<int>>& grid, int i, int j) {
        int m = grid.size();
        int n = grid[0].size();
        // base case
        if (i == m - 1 && j == n - 1) {
            return grid[i][j] >= 0 ? 1 : -grid[i][j] + 1;
        }
        if (i == m || j == n) {
            return INT_MAX;
        }
        // é¿å…é‡å¤è®¡ç®—
        if (memo[i][j] != -1) {
            return memo[i][j];
        }
        // çŠ¶æ€è½¬ç§»é€»è¾‘
        int res = min(
                dp(grid, i, j + 1),
                dp(grid, i + 1, j)
            ) - grid[i][j];
        // éª‘å£«çš„ç”Ÿå‘½å€¼è‡³å°‘ä¸º 1
        memo[i][j] = res <= 0 ? 1 : res;

        return memo[i][j];
    }
};
```

## é€šå…³ã€Šè¾å°„4ã€‹

å°é¢å›¾æ˜¯ä¸€æ¬¾å«åšã€Šè¾å°„4ã€‹çš„æ¸¸æˆä¸­çš„ä¸€ä¸ªä»»åŠ¡å‰§æƒ…ç”»é¢ï¼š

![img](https://labuladong.online/algo/images/%E8%BD%AC%E7%9B%98/1.jpg)

è¿™ä¸ªå¯ä»¥è½¬åŠ¨çš„åœ†ç›˜ç±»ä¼¼æ˜¯ä¸€ä¸ªå¯†ç æœºå…³ï¼Œä¸­é—´åä¸Šçš„ä½ç½®æœ‰ä¸ªçº¢è‰²çš„æŒ‡é’ˆçœ‹åˆ°æ²¡ï¼Œä½ åªè¦è½¬åŠ¨åœ†ç›˜å¯ä»¥è®©æŒ‡é’ˆæŒ‡å‘ä¸åŒçš„å­—æ¯ï¼Œç„¶åå†æŒ‰ä¸‹ä¸­é—´çš„æŒ‰é’®å°±å¯ä»¥è¾“å…¥æŒ‡é’ˆæŒ‡å‘çš„å­—æ¯ã€‚

åªè¦è½¬åŠ¨åœ†ç¯ï¼Œè®©æŒ‡é’ˆä¾æ¬¡æŒ‡å‘ Rã€Aã€Iã€Lã€Rã€Oã€Aã€D å¹¶ä¾æ¬¡æŒ‰ä¸‹æŒ‰é’®ï¼Œå°±å¯ä»¥è§¦å‘æœºå…³ï¼Œæ‰“å¼€æ—è¾¹çš„é—¨ã€‚

è‡³äºå¯†ç ä¸ºä»€ä¹ˆæ˜¯è¿™å‡ ä¸ªå­—æ¯ï¼Œåœ¨æ¸¸æˆä¸­çš„å‰§æƒ…æœ‰æš—ç¤ºã€‚

é‚£ä¹ˆè¿™ä¸ªæ¸¸æˆåœºæ™¯å’ŒåŠ¨æ€è§„åˆ’æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ

**æˆ‘ä»¬æ¥æ²¡äº‹å„¿æ‰¾äº‹å„¿åœ°æƒ³ä¸€æƒ³ï¼Œæ‹¨åŠ¨åœ†ç›˜è¾“å…¥è¿™äº›å­—æ¯è¿˜æŒºéº»çƒ¦çš„ï¼ŒæŒ‰ç…§ä»€ä¹ˆé¡ºåºæ‰èƒ½ä½¿å¾—æ‹¨åŠ¨åœ†ç›˜æ‰€éœ€çš„æ“ä½œæ¬¡æ•°æœ€å°‘å‘¢**ï¼Ÿ

æ‹¨åŠ¨åœ†ç›˜çš„ä¸åŒæ–¹æ³•æ‰€éœ€çš„æ“ä½œæ¬¡æ•°è‚¯å®šæ˜¯ä¸åŒçš„ã€‚

æ¯”å¦‚è¯´æƒ³æŠŠä¸€ä¸ªå­—æ¯å¯¹å‡†åˆ°æŒ‡é’ˆä¸Šï¼Œä½ å¯ä»¥é¡ºæ—¶é’ˆè½¬åœ†ç›˜ï¼Œä¹Ÿå¯ä»¥é€†æ—¶é’ˆè½¬åœ†ç›˜ï¼›è€Œä¸”æŸäº›å­—æ¯å¯èƒ½ä¸æ­¢å‡ºç°ä¸€æ¬¡ï¼Œæ¯”å¦‚ä¸Šå›¾ä¸­å¤§å†™å­—æ¯ O å°±åœ¨åœ†ç›˜çš„ä¸åŒä½ç½®å‡ºç°äº†ä¸‰æ¬¡ï¼Œåˆ°æ—¶å€™åº”è¯¥æ‹¨å“ªä¸ª O æ‰èƒ½ä½¿å¾—æ•´ä½“çš„æ“ä½œæ¬¡æ•°æœ€å°‘å‘¢ï¼Ÿ

é‡åˆ°æ±‚æœ€å€¼çš„é—®é¢˜ï¼ŒåŸºæœ¬éƒ½æ˜¯ç”±åŠ¨æ€è§„åˆ’ç®—æ³•æ¥è§£å†³ï¼Œå› ä¸ºåŠ¨æ€è§„åˆ’æœ¬èº«å°±æ˜¯è¿ç­¹ä¼˜åŒ–ç®—æ³•çš„ä¸€ç§å˜›ã€‚

> é¢˜ç›®

ç»™ä½ è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸² `ring` ä»£è¡¨åœ†ç›˜ä¸Šçš„å­—ç¬¦ï¼ˆæŒ‡é’ˆä½ç½®åœ¨ 12 ç‚¹é’Ÿæ–¹å‘ï¼Œåˆå§‹æŒ‡å‘ `ring[0]`ï¼‰ï¼Œå†è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸² `key` ä»£è¡¨ä½ éœ€è¦æ‹¨åŠ¨åœ†ç›˜è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œä½ çš„ç®—æ³•éœ€è¦è¿”å›è¾“å…¥è¿™ä¸ª `key` è‡³å°‘è¿›è¡Œå¤šå°‘æ¬¡æ“ä½œï¼ˆæ‹¨åŠ¨ä¸€æ ¼åœ†ç›˜å’ŒæŒ‰ä¸‹åœ†ç›˜ä¸­é—´çš„æŒ‰é’®éƒ½ç®—æ˜¯ä¸€æ¬¡æ“ä½œï¼‰ã€‚

å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

```cpp
int findRotateSteps(string ring, string key);
```

æ¯”å¦‚é¢˜ç›®ä¸¾çš„ä¾‹å­ï¼Œè¾“å…¥ `ring = "godding", key = "gd"`ï¼Œå¯¹åº”çš„åœ†ç›˜å¦‚ä¸‹ï¼ˆå¤§å†™åªæ˜¯ä¸ºäº†æ¸…æ™°ï¼Œå®é™…ä¸Šè¾“å…¥çš„å­—ç¬¦ä¸²éƒ½æ˜¯å°å†™å­—æ¯ï¼‰ï¼š

![img](https://labuladong.online/algo/images/%E8%BD%AC%E7%9B%98/3.jpg)

æˆ‘ä»¬éœ€è¦è¾“å…¥ `key = "gd"`ï¼Œç®—æ³•è¿”å› 4ã€‚

å› ä¸ºç°åœ¨æŒ‡é’ˆæŒ‡çš„å­—æ¯å°±æ˜¯å­—æ¯ `"g"`ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æŒ‰ä¸‹ä¸­é—´çš„æŒ‰é’®ï¼Œç„¶åå†å°†åœ†ç›˜é€†æ—¶é’ˆæ‹¨åŠ¨ä¸¤æ ¼ï¼Œè®©æŒ‡é’ˆæŒ‡å‘å­—æ¯ `"d"`ï¼Œç„¶åå†æŒ‰ä¸€æ¬¡ä¸­é—´çš„æŒ‰é’®ã€‚

ä¸Šè¿°è¿‡ç¨‹ï¼ŒæŒ‰äº†ä¸¤æ¬¡æŒ‰é’®ï¼Œæ‹¨äº†ä¸¤æ ¼è½¬ç›˜ï¼Œæ€»å…±æ“ä½œäº† 4 æ¬¡ï¼Œæ˜¯æœ€å°‘çš„æ“ä½œæ¬¡æ•°ï¼Œæ‰€ä»¥ç®—æ³•åº”è¯¥è¿”å› 4ã€‚

> æ€è·¯

æˆ‘ä»¬è¿™é‡Œå¯ä»¥é¦–å…ˆç»™é¢˜ç›®åšä¸€ä¸ªç­‰ä»·ï¼Œè½¬åŠ¨åœ†ç›˜æ˜¯ä¸æ˜¯å°±ç­‰äºæ‹¨åŠ¨æŒ‡é’ˆï¼Ÿ

**åŸé¢˜å¯ä»¥è½¬åŒ–ä¸ºï¼šåœ†ç›˜å›ºå®šï¼Œæˆ‘ä»¬å¯ä»¥æ‹¨åŠ¨æŒ‡é’ˆï¼›ç°åœ¨éœ€è¦æˆ‘ä»¬æ‹¨åŠ¨æŒ‡é’ˆå¹¶æŒ‰ä¸‹æŒ‰é’®ï¼Œä»¥æœ€å°‘çš„æ“ä½œæ¬¡æ•°è¾“å…¥ `key` å¯¹åº”çš„å­—ç¬¦ä¸²**ã€‚

é‚£ä¹ˆï¼Œè¿™ä¸ªé—®é¢˜å¦‚ä½•ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„æŠ€å·§è§£å†³å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œè¿™é“é¢˜çš„ã€ŒçŠ¶æ€ã€å’Œã€Œé€‰æ‹©ã€æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

**ã€ŒçŠ¶æ€ã€å°±æ˜¯ã€Œå½“å‰éœ€è¦è¾“å…¥çš„å­—ç¬¦ã€å’Œã€Œå½“å‰åœ†ç›˜æŒ‡é’ˆçš„ä½ç½®ã€**ã€‚

å†å…·ä½“ç‚¹ï¼Œã€ŒçŠ¶æ€ã€å°±æ˜¯ `i` å’Œ `j` ä¸¤ä¸ªå˜é‡ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ `i` è¡¨ç¤ºå½“å‰åœ†ç›˜ä¸ŠæŒ‡é’ˆæŒ‡å‘çš„å­—ç¬¦ï¼ˆä¹Ÿå°±æ˜¯ `ring[i]`ï¼‰ï¼›ç”¨ `j` è¡¨ç¤ºéœ€è¦è¾“å…¥çš„å­—ç¬¦ï¼ˆä¹Ÿå°±æ˜¯ `key[j]`ï¼‰ã€‚

è¿™æ ·æˆ‘ä»¬å¯ä»¥å†™è¿™æ ·ä¸€ä¸ª `dp` å‡½æ•°ï¼š

```cpp
int dp(string ring, int i, string key, int j);
```

è¿™ä¸ª `dp` å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š

**å½“åœ†ç›˜æŒ‡é’ˆæŒ‡å‘ `ring[i]` æ—¶ï¼Œè¾“å…¥å­—ç¬¦ä¸² `key[j..]` è‡³å°‘éœ€è¦ `dp(ring, i, key, j)` æ¬¡æ“ä½œ**ã€‚

æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼Œé¢˜ç›®å…¶å®å°±æ˜¯æƒ³è®¡ç®— `dp(ring, 0, key, 0)` çš„å€¼ï¼Œè€Œä¸”æˆ‘ä»¬å¯ä»¥æŠŠ `dp` å‡½æ•°çš„ base case å†™å‡ºæ¥ï¼š

```cpp
int dp(string ring, int i, string key, int j) {
    // base caseï¼Œå®Œæˆè¾“å…¥
    if (j == key.length()) return 0;
    // ...
}
```

æ¥ä¸‹æ¥ï¼Œæ€è€ƒä¸€ä¸‹å¦‚ä½•æ ¹æ®çŠ¶æ€åšé€‰æ‹©ï¼Œå¦‚ä½•è¿›è¡ŒçŠ¶æ€è½¬ç§»ï¼Ÿ

**ã€Œé€‰æ‹©ã€å°±æ˜¯ã€Œå¦‚ä½•æ‹¨åŠ¨æŒ‡é’ˆå¾—åˆ°å¾…è¾“å…¥çš„å­—ç¬¦ã€**ã€‚

å†å…·ä½“ç‚¹å°±æ˜¯ï¼Œå¯¹äºç°åœ¨æƒ³è¾“å…¥çš„å­—ç¬¦ `key[j]`ï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä½•æ‹¨åŠ¨åœ†ç›˜ï¼Œå¾—åˆ°è¿™ä¸ªå­—ç¬¦ï¼Ÿ

æ¯”å¦‚è¯´è¾“å…¥ `ring = "gdonidg"`ï¼Œç°åœ¨åœ†ç›˜çš„çŠ¶æ€å¦‚ä¸‹å›¾ï¼š

![img](https://labuladong.online/algo/images/%E8%BD%AC%E7%9B%98/4.jpeg)

å‡è®¾æˆ‘æƒ³è¾“å…¥çš„å­—ç¬¦ `key[j] = "d"`ï¼Œåœ†ç›˜ä¸­æœ‰ä¸¤ä¸ªå­—æ¯ `"d"`ï¼Œè€Œä¸”æˆ‘å¯ä»¥é¡ºæ—¶é’ˆä¹Ÿå¯ä»¥é€†æ—¶é’ˆæ‹¨åŠ¨æŒ‡é’ˆï¼Œæ‰€ä»¥æ€»å…±æœ‰å››ç§ã€Œé€‰æ‹©ã€è¾“å…¥å­—ç¬¦ `"d"`ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©æ“ä½œæ¬¡æ•°æœ€å°‘çš„é‚£ä¸ªæ‹¨æ³•ã€‚

å¤§è‡´çš„ä»£ç é€»è¾‘å¦‚ä¸‹ï¼š

```cpp
int dp(string ring, int i, string key, int j) {
    // base case å®Œæˆè¾“å…¥
    if (j == key.length()) return 0;
    
    // åšé€‰æ‹©
    int res = INT_MAX;
    for (int k : {index of character key[j] in ring}) {
        res = min(
            cost of clockwise rotation from i to k,
            cost of counterclockwise rotation from i to k
        );
    }
    
    return res;
}
```

è‡³äºåˆ°åº•æ˜¯é¡ºæ—¶é’ˆè¿˜æ˜¯é€†æ—¶é’ˆï¼Œå…¶å®éå¸¸å¥½åˆ¤æ–­ï¼Œæ€ä¹ˆè¿‘å°±æ€ä¹ˆæ¥ï¼›ä½†æ˜¯å¯¹äºåœ†ç›˜ä¸­çš„ä¸¤ä¸ªå­—ç¬¦ `"d"`ï¼Œè¿˜èƒ½æ˜¯æ€ä¹ˆè¿‘æ€ä¹ˆæ¥å—ï¼Ÿ

ä¸èƒ½ï¼Œå› ä¸ºè¿™å’Œ `key[i]` ä¹‹åéœ€è¦è¾“å…¥çš„å­—ç¬¦æœ‰å…³ï¼Œè¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼š

![img](https://labuladong.online/algo/images/%E8%BD%AC%E7%9B%98/4.jpeg)

å¦‚æœè¾“å…¥çš„æ˜¯ `key = "di"`ï¼Œé‚£ä¹ˆå³ä¾¿å³è¾¹çš„ `"d"` ç¦»å¾—è¿‘ï¼Œä¹Ÿåº”è¯¥å»å·¦è¾¹çš„ `"d"`ï¼Œå› ä¸ºå·¦è¾¹çš„ `"d"` æ—è¾¹å°±æ˜¯ `"i"`ï¼Œã€Œæ•´ä½“ã€çš„æ“ä½œæ•°æœ€å°‘ã€‚

é‚£ä¹ˆï¼Œåº”è¯¥å¦‚ä½•åˆ¤æ–­å‘¢ï¼Ÿå…¶å®å°±æ˜¯ç©·ä¸¾ï¼Œé€’å½’è°ƒç”¨ `dp` å‡½æ•°ï¼ŒæŠŠä¸¤ç§é€‰æ‹©çš„ã€Œæ•´ä½“ã€ä»£ä»·ç®—å‡ºæ¥ï¼Œç„¶åå†åšæ¯”è¾ƒå°±è¡Œäº†ã€‚

è®²åˆ°è¿™å°±å·®ä¸å¤šäº†ï¼Œç›´æ¥çœ‹ä»£ç å§ï¼š

```cpp
class Solution {
    // å­—ç¬¦ -> ç´¢å¼•åˆ—è¡¨
    unordered_map<char, vector<int>> charToIndex;
    // å¤‡å¿˜å½•
    vector<vector<int>> memo;

    // ä¸»å‡½æ•°
public:
    int findRotateSteps(string ring, string key) {
        int m = ring.size();
        int n = key.size();
        // å¤‡å¿˜å½•å…¨éƒ¨åˆå§‹åŒ–ä¸º 0
        memo = vector<vector<int>>(m, vector<int>(n, 0));
        // è®°å½•åœ†ç¯ä¸Šå­—ç¬¦åˆ°ç´¢å¼•çš„æ˜ å°„
        for (int i = 0; i < ring.size(); i++) {
            char c = ring[i];
            if (!charToIndex.count(c)) {
                charToIndex[c] = vector<int>();
            }
            charToIndex[c].push_back(i);
        }
        // åœ†ç›˜æŒ‡é’ˆæœ€åˆæŒ‡å‘ 12 ç‚¹é’Ÿæ–¹å‘ï¼Œ
        // ä»ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹è¾“å…¥ key
        return dp(ring, 0, key, 0);
    }

    // è®¡ç®—åœ†ç›˜æŒ‡é’ˆåœ¨ ring[i]ï¼Œè¾“å…¥ key[j..] çš„æœ€å°‘æ“ä½œæ•°
private:
    int dp(const string& ring, int i, const string& key, int j) {
        // base case å®Œæˆè¾“å…¥
        if (j == key.size()) return 0;
        // æŸ¥æ‰¾å¤‡å¿˜å½•ï¼Œé¿å…é‡å å­é—®é¢˜
        if (memo[i][j] != 0) return memo[i][j];
        
        int n = ring.size();
        // åšé€‰æ‹©
        int res = INT_MAX;
        // ring ä¸Šå¯èƒ½æœ‰å¤šä¸ªå­—ç¬¦ key[j]
        for (int k : charToIndex[key[j]]) {
            // æ‹¨åŠ¨æŒ‡é’ˆçš„æ¬¡æ•°
            int delta = abs(k - i);
            // é€‰æ‹©é¡ºæ—¶é’ˆè¿˜æ˜¯é€†æ—¶é’ˆ
            delta = min(delta, n - delta);
            // å°†æŒ‡é’ˆæ‹¨åˆ° ring[k]ï¼Œç»§ç»­è¾“å…¥ key[j+1..]
            int subProblem = dp(ring, k, key, j + 1);
            // é€‰æ‹©ã€Œæ•´ä½“ã€æ“ä½œæ¬¡æ•°æœ€å°‘çš„
            // åŠ ä¸€æ˜¯å› ä¸ºæŒ‰åŠ¨æŒ‰é’®ä¹Ÿæ˜¯ä¸€æ¬¡æ“ä½œ
            res = min(res, 1 + delta + subProblem);
        }
        // å°†ç»“æœå­˜å…¥å¤‡å¿˜å½•
        memo[i][j] = res;
        return res;
    }
};
```

## åŠ æƒæœ€çŸ­è·¯å¾„

> é¢˜ç›®

ç°åœ¨æœ‰ `n` ä¸ªåŸå¸‚ï¼Œåˆ†åˆ«ç”¨ `0`, `1`..., `n - 1` è¿™äº›åºå·è¡¨ç¤ºï¼ŒåŸå¸‚ä¹‹é—´çš„èˆªçº¿ç”¨ä¸‰å…ƒç»„ `[from, to, price]` æ¥è¡¨ç¤ºï¼Œæ¯”å¦‚è¯´ä¸‰å…ƒç»„ `[0,1,100]` å°±è¡¨ç¤ºï¼Œä»åŸå¸‚ `0` åˆ°åŸå¸‚ `1` ä¹‹é—´çš„æœºç¥¨ä»·æ ¼æ˜¯ 100 å…ƒã€‚

é¢˜ç›®ä¼šç»™ä½ è¾“å…¥è‹¥å¹²å‚æ•°ï¼šæ­£æ•´æ•° `n` ä»£è¡¨åŸå¸‚ä¸ªæ•°ï¼Œæ•°ç»„ `flights` è£…ç€è‹¥å¹²ä¸‰å…ƒç»„ä»£è¡¨åŸå¸‚é—´çš„èˆªçº¿åŠä»·æ ¼ï¼ŒåŸå¸‚ç¼–å· `src` ä»£è¡¨ä½ æ‰€åœ¨çš„åŸå¸‚ï¼ŒåŸå¸‚ç¼–å· `dst` ä»£è¡¨ä½ è¦å»çš„ç›®æ ‡åŸå¸‚ï¼Œæ•´æ•° `K` ä»£è¡¨ä½ æœ€å¤šç»è¿‡çš„ä¸­è½¬ç«™ä¸ªæ•°ã€‚

å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

```cpp
int findCheapestPrice(int n, vector<vector<int>>& flights, int src, int dst, int K);
```

è¯·ä½ çš„ç®—æ³•è®¡ç®—ï¼Œåœ¨ `K` æ¬¡ä¸­è½¬ä¹‹å†…ï¼Œä» `src` åˆ° `dst` æ‰€éœ€çš„æœ€å°èŠ±è´¹æ˜¯å¤šå°‘é’±ï¼Œå¦‚æœæ— æ³•åˆ°è¾¾ï¼Œåˆ™è¿”å› -1ã€‚

æ¯”æ–¹è¯´é¢˜ç›®ç»™çš„ä¾‹å­ï¼š

```
n = 3, flights = [[0,1,100],[1,2,100],[0,2,500]], src = 0, dst = 2, K = 1
```

èˆªçº¿å°±æ˜¯å¦‚ä¸‹è¿™å¼ å›¾æ‰€ç¤ºï¼Œæœ‰å‘è¾¹ä»£è¡¨èˆªå‘çš„æ–¹å‘ï¼Œè¾¹ä¸Šçš„æ•°å­—ä»£è¡¨èˆªçº¿çš„æœºç¥¨ä»·æ ¼ï¼š

![img](https://labuladong.online/algo/images/%E6%97%85%E8%A1%8C%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/7.png)

å‡ºå‘ç‚¹æ˜¯ `0`ï¼Œåˆ°è¾¾ç‚¹æ˜¯ `2`ï¼Œå…è®¸çš„æœ€å¤§ä¸­è½¬æ¬¡æ•° `K` ä¸º 1ï¼Œæ‰€ä»¥æœ€å°çš„å¼€é”€å°±æ˜¯å›¾ä¸­çº¢è‰²çš„ä¸¤æ¡è¾¹ï¼Œä» `0` å‡ºå‘ï¼Œç»è¿‡ä¸­è½¬åŸå¸‚ `1` åˆ°è¾¾ç›®æ ‡åŸå¸‚ `2`ï¼Œæ‰€ä»¥ç®—æ³•çš„è¿”å›å€¼åº”è¯¥æ˜¯ 200ã€‚

æ³¨æ„è¿™ä¸ªä¸­è½¬æ¬¡æ•°çš„ä¸Šé™ `K` æ˜¯æ¯”è¾ƒæ£˜æ‰‹çš„ï¼Œå¦‚æœä¸Šè¿°é¢˜ç›®å°† `K` æ”¹ä¸º 0ï¼Œä¹Ÿå°±æ˜¯ä¸å…è®¸ä¸­è½¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç®—æ³•åªèƒ½è¿”å› 500 äº†ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥ä» `0` é£åˆ° `2`ã€‚

> æ€è·¯

**å¾ˆæ˜æ˜¾ï¼Œè¿™é¢˜å°±æ˜¯ä¸ªåŠ æƒæœ‰å‘å›¾ä¸­æ±‚æœ€çŸ­è·¯å¾„çš„é—®é¢˜**ã€‚

è¯´ç™½äº†ï¼Œå°±æ˜¯ç»™ä½ ä¸€å¹…åŠ æƒæœ‰å‘å›¾ï¼Œè®©ä½ æ±‚ `src` åˆ° `dst` æƒé‡æœ€å°çš„ä¸€æ¡è·¯å¾„ï¼ŒåŒæ—¶è¦æ»¡è¶³ï¼Œ**è¿™æ¡è·¯å¾„æœ€å¤šä¸èƒ½è¶…è¿‡ `K + 1` æ¡è¾¹**ï¼ˆç»è¿‡ `K` ä¸ªèŠ‚ç‚¹ç›¸å½“äºç»è¿‡ `K + 1` æ¡è¾¹ï¼‰ã€‚

æˆ‘ä»¬æ¥åˆ†æä¸‹æ±‚æœ€çŸ­è·¯å¾„ç›¸å…³çš„ç®—æ³•ã€‚

### BFSç®—æ³•æ€è·¯

æˆ‘ä»¬å‰æ–‡ [BFS ç®—æ³•æ¡†æ¶è¯¦è§£](https://labuladong.online/algo/essential-technique/bfs-framework/) ä¸­è¯´åˆ°ï¼Œæ±‚æœ€çŸ­è·¯å¾„ï¼Œè‚¯å®šå¯ä»¥ç”¨ BFS ç®—æ³•æ¥è§£å†³ã€‚

å› ä¸º BFS ç®—æ³•ç›¸å½“äºä»èµ·å§‹ç‚¹å¼€å§‹ï¼Œä¸€æ­¥ä¸€æ­¥å‘å¤–æ‰©æ•£ï¼Œé‚£å½“ç„¶æ˜¯ç¦»èµ·ç‚¹è¶Šè¿‘çš„èŠ‚ç‚¹è¶Šå…ˆè¢«éå†åˆ°ï¼Œå¦‚æœ BFS éå†çš„è¿‡ç¨‹ä¸­é‡åˆ°ç»ˆç‚¹ï¼Œé‚£ä¹ˆèµ°çš„è‚¯å®šæ˜¯æœ€çŸ­è·¯å¾„ã€‚

ä¸è¿‡å‘¢ï¼Œæˆ‘ä»¬åœ¨ [BFS ç®—æ³•æ¡†æ¶è¯¦è§£](https://labuladong.online/algo/essential-technique/bfs-framework/) ç”¨çš„æ˜¯æ™®é€šçš„é˜Ÿåˆ— `Queue` æ¥éå†å¤šå‰æ ‘ï¼Œè€Œå¯¹äºåŠ æƒå›¾çš„æœ€çŸ­è·¯å¾„æ¥è¯´ï¼Œæ™®é€šçš„é˜Ÿåˆ—ä¸ç®¡ç”¨äº†ï¼Œå¾—ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ— `PriorityQueue`ã€‚

ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¹Ÿå¥½ç†è§£ï¼Œåœ¨å¤šå‰æ ‘ï¼ˆæˆ–è€…æ‰©å±•åˆ°æ— æƒå›¾ï¼‰çš„éå†ä¸­ï¼Œä¸å…¶è¯´è¾¹æ²¡æœ‰æƒé‡ï¼Œä¸å¦‚è¯´æ¯æ¡è¾¹çš„æƒé‡éƒ½æ˜¯ 1ï¼Œèµ·ç‚¹ä¸ç»ˆç‚¹ä¹‹é—´çš„è·¯å¾„æƒé‡å°±æ˜¯å®ƒä»¬ä¹‹é—´ã€Œè¾¹ã€çš„æ¡æ•°ã€‚

è¿™æ ·ï¼ŒæŒ‰ç…§ BFS ç®—æ³•ä¸€æ­¥æ­¥å‘å››å‘¨æ‰©æ•£çš„é€»è¾‘ï¼Œå…ˆéå†åˆ°çš„èŠ‚ç‚¹å’Œèµ·ç‚¹ä¹‹é—´çš„ã€Œè¾¹ã€æ›´å°‘ï¼Œç´¯è®¡çš„æƒé‡å½“ç„¶å°‘ã€‚

æ¢è¨€ä¹‹ï¼Œå…ˆè¿›å…¥ `Queue` çš„èŠ‚ç‚¹å°±æ˜¯ç¦»èµ·ç‚¹è¿‘çš„ï¼Œè·¯å¾„æƒé‡å°çš„èŠ‚ç‚¹ã€‚

ä½†å¯¹äºåŠ æƒå›¾ï¼Œè·¯å¾„ä¸­è¾¹çš„æ¡æ•°å’Œè·¯å¾„çš„æƒé‡å¹¶ä¸æ˜¯æ­£ç›¸å…³çš„å…³ç³»äº†ï¼Œæœ‰çš„è·¯å¾„å¯èƒ½è¾¹çš„æ¡æ•°å¾ˆå°‘ï¼Œä½†æ¯æ¡è¾¹çš„æƒé‡éƒ½å¾ˆå¤§ï¼Œé‚£æ˜¾ç„¶è¿™æ¡è·¯å¾„æƒé‡ä¹Ÿä¼šå¾ˆå¤§ï¼Œå¾ˆéš¾æˆä¸ºæœ€çŸ­è·¯å¾„ã€‚

æ¯”å¦‚é¢˜ç›®ç»™çš„è¿™ä¸ªä¾‹å­ï¼š

![img](https://labuladong.online/algo/images/%E6%97%85%E8%A1%8C%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/7.png)

ä½ æ˜¯å¯ä»¥ä¸€æ­¥ä» `0` èµ°åˆ° `2`ï¼Œä½†è·¯å¾„æƒé‡ä¸è§å¾—æ˜¯æœ€å°çš„ã€‚

æ‰€ä»¥ï¼Œå¯¹äºåŠ æƒå›¾çš„åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦ä¼˜å…ˆçº§é˜Ÿåˆ—ã€Œè‡ªåŠ¨æ’åºã€çš„ç‰¹æ€§ï¼Œå°†è·¯å¾„æƒé‡è¾ƒå°çš„èŠ‚ç‚¹æ’åœ¨é˜Ÿåˆ—å‰é¢ï¼Œä»¥æ­¤ä¸ºåŸºç¡€æ–½å±• BFS ç®—æ³•ï¼Œä¹Ÿå°±å˜æˆäº† [Dijkstra ç®—æ³•](https://labuladong.online/algo/data-structure/dijkstra/)ã€‚

```cpp
class Solution {
public:
    struct State {
        // å›¾èŠ‚ç‚¹çš„ id
        int id;
        // ä» src èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„èŠ±è´¹
        int costFromSrc;
        // ä» src èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹ç»è¿‡çš„èŠ‚ç‚¹ä¸ªæ•°
        int nodeNumFromSrc;

        State(int id, int costFromSrc, int nodeNumFromSrc) {
            this->id = id;
            this->costFromSrc = costFromSrc;
            this->nodeNumFromSrc = nodeNumFromSrc;
        }
    };

    // è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼Œä»¥å®ç°ä¼˜å…ˆé˜Ÿåˆ—ä¸­costFromSrcè¾ƒå°çš„å…ƒç´ ä¼˜å…ˆ
    class CompareState {
    public:
        bool operator()(State const& s1, State const& s2) {
            return s1.costFromSrc > s2.costFromSrc;
        }
    };

    int findCheapestPrice(int n, vector<vector<int>>& flights, int src, int dst, int K) {
        vector<vector<int*>> graph(n);
        for (vector<int> edge : flights) {
            int from = edge[0];
            int to = edge[1];
            int price = edge[2];
            int* arr = new int[2]{to, price};
            graph[from].push_back(arr);
        }

        // å¯åŠ¨ dijkstra ç®—æ³•
        // è®¡ç®—ä»¥ src ä¸ºèµ·ç‚¹åœ¨ k æ¬¡ä¸­è½¬åˆ°è¾¾ dst çš„æœ€çŸ­è·¯å¾„
        K++;
        return dijkstra(graph, src, K, dst);
    }

    int dijkstra(vector<vector<int*>>& graph, int src, int k, int dst) {
        // å®šä¹‰ï¼šä»èµ·ç‚¹ src åˆ°è¾¾èŠ‚ç‚¹ i çš„æœ€çŸ­è·¯å¾„æƒé‡ä¸º distTo[i]
        vector<int> distTo(graph.size(), INT_MAX);
        // å®šä¹‰ï¼šä»èµ·ç‚¹ src åˆ°è¾¾èŠ‚ç‚¹ i çš„æœ€å°æƒé‡è·¯å¾„è‡³å°‘è¦ç»è¿‡ nodeNumTo[i] ä¸ªèŠ‚ç‚¹
        vector<int> nodeNumTo(graph.size(), INT_MAX);
        // base case
        distTo[src] = 0;
        nodeNumTo[src] = 0;

        // ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ŒcostFromSrc è¾ƒå°çš„æ’åœ¨å‰é¢
        priority_queue<State, vector<State>, CompareState> pq;
        // ä»èµ·ç‚¹ src å¼€å§‹è¿›è¡Œ BFS
        pq.push(State(src, 0, 0));
        while (!pq.empty()) {
            State curState = pq.top();
            pq.pop();
            int curNodeID = curState.id;
            int costFromSrc = curState.costFromSrc;
            int curNodeNumFromSrc = curState.nodeNumFromSrc;

            if (curNodeID == dst) {
                // æ‰¾åˆ°æœ€çŸ­è·¯å¾„
                return costFromSrc;
            }
            if (curNodeNumFromSrc == k) {
                // ä¸­è½¬æ¬¡æ•°è€—å°½
                continue;
            }
            // å°†å½“å‰èŠ‚ç‚¹ç›¸é‚»èŠ‚ç‚¹è£…å…¥é˜Ÿåˆ—
            for (int* neighbor : graph[curNodeID]) {
                int nextNodeID = neighbor[0];
                int costToNextNode = costFromSrc + neighbor[1];
                // ä¸­è½¬æ¬¡æ•°æ¶ˆè€— 1
                int nextNodeNumFromSrc = curNodeNumFromSrc + 1;

                // æ›´æ–° dp table
                if (distTo[nextNodeID] > costToNextNode) {
                    distTo[nextNodeID] = costToNextNode;
                    nodeNumTo[nextNodeID] = nextNodeNumFromSrc;
                }
                // å‰ªæï¼Œå¦‚æœä¸­è½¬æ¬¡æ•°æ›´å¤šï¼ŒèŠ±è´¹è¿˜æ›´å¤§ï¼Œé‚£å¿…ç„¶ä¸ä¼šæ˜¯æœ€çŸ­è·¯å¾„
                if (costToNextNode > distTo[nextNodeID]
                    && nextNodeNumFromSrc > nodeNumTo[nextNodeID]) {
                    continue;
                }

                pq.push(State(nextNodeID, costToNextNode, nextNodeNumFromSrc));
            }
        }
        return -1;
    }
};
```

### åŠ¨æ€è§„åˆ’æ€è·¯

åŠ æƒæœ€çŸ­è·¯å¾„é—®é¢˜ï¼Œå†åŠ ä¸ª `K` çš„é™åˆ¶ä¹Ÿæ— å¦¨ï¼Œä¸ä¹Ÿæ˜¯ä¸ªæ±‚æœ€å€¼çš„é—®é¢˜å˜›ï¼ŒåŠ¨æ€è§„åˆ’ç»Ÿç»Ÿæ‹¿ä¸‹ã€‚

æˆ‘ä»¬å…ˆä¸ç®¡ `K` çš„é™åˆ¶ï¼Œå•å°±ã€ŒåŠ æƒæœ€çŸ­è·¯å¾„ã€è¿™ä¸ªé—®é¢˜æ¥çœ‹çœ‹ï¼Œå®ƒæ€ä¹ˆå°±æ˜¯ä¸ªåŠ¨æ€è§„åˆ’é—®é¢˜äº†å‘¢ï¼Ÿ

æ¯”æ–¹è¯´ï¼Œç°åœ¨æˆ‘æƒ³è®¡ç®— `src` åˆ° `dst` çš„æœ€çŸ­è·¯å¾„ï¼š

![img](https://labuladong.online/algo/images/%E6%97%85%E8%A1%8C%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/1.jpeg)

æœ€å°æƒé‡æ˜¯å¤šå°‘ï¼Ÿæˆ‘ä¸çŸ¥é“ã€‚

ä½†æˆ‘å¯ä»¥æŠŠé—®é¢˜è¿›è¡Œåˆ†è§£ï¼š

![img](https://labuladong.online/algo/images/%E6%97%85%E8%A1%8C%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/2.jpeg)

`s1, s2` æ˜¯æŒ‡å‘ `dst` çš„ç›¸é‚»èŠ‚ç‚¹ï¼Œå®ƒä»¬ä¹‹é—´çš„æƒé‡æˆ‘æ˜¯çŸ¥é“çš„ï¼Œåˆ†åˆ«æ˜¯ `w1, w2`ã€‚

åªè¦æˆ‘çŸ¥é“äº†ä» `src` åˆ° `s1, s2` çš„æœ€çŸ­è·¯å¾„ï¼Œæˆ‘ä¸å°±çŸ¥é“ `src` åˆ° `dst` çš„æœ€çŸ­è·¯å¾„äº†å—ï¼

```cpp
minPath(src, dst) = min(
    minPath(src, s1) + w1, 
    minPath(src, s2) + w2
)
```

è¿™å…¶å®å°±æ˜¯é€’å½’å…³ç³»äº†ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ã€‚

**ä¸è¿‡åˆ«å¿˜äº†ï¼Œé¢˜ç›®å¯¹æˆ‘ä»¬çš„æœ€çŸ­è·¯å¾„è¿˜æœ‰ä¸ªã€Œè·¯å¾„ä¸Šä¸èƒ½è¶…è¿‡ `K + 1` æ¡è¾¹ã€çš„é™åˆ¶**ã€‚

é‚£ä¹ˆæˆ‘ä»¬ä¸å¦¨å®šä¹‰è¿™æ ·ä¸€ä¸ª `dp` å‡½æ•°ï¼š

```cpp
int dp(int s, int k);
```

å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š

**ä»èµ·ç‚¹ `src` å‡ºå‘ï¼Œ`k` æ­¥ä¹‹å†…ï¼ˆä¸€æ­¥å°±æ˜¯ä¸€æ¡è¾¹ï¼‰åˆ°è¾¾èŠ‚ç‚¹ `s` çš„æœ€å°è·¯å¾„æƒé‡ä¸º `dp(s, k)`**ã€‚

é‚£ä¹ˆï¼Œ`dp` å‡½æ•°çš„ base case å°±æ˜¾è€Œæ˜“è§äº†ï¼š

```cpp
// å®šä¹‰ï¼šä» src å‡ºå‘ï¼Œk æ­¥ä¹‹å†…åˆ°è¾¾ s çš„æœ€å°æˆæœ¬
int dp(int s, int k) {
    // ä» src åˆ° srcï¼Œä¸€æ­¥éƒ½ä¸ç”¨èµ°
    if (s == src) {
        return 0;
    }
    // å¦‚æœæ­¥æ•°ç”¨å°½ï¼Œå°±æ— è§£äº†
    if (k == 0) {
        return -1;
    }

    // ...
}
```

é¢˜ç›®æƒ³æ±‚çš„æœ€å°æœºç¥¨å¼€é”€å°±å¯ä»¥ç”¨ `dp(dst, K+1)` æ¥è¡¨ç¤ºï¼š

æ·»åŠ äº†ä¸€ä¸ª `K` æ¡è¾¹çš„é™åˆ¶ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹æ€ä¹ˆå†™å‘¢ï¼Ÿå…¶å®å’Œåˆšæ‰æ˜¯ä¸€æ ·çš„ï¼š

![img](https://labuladong.online/algo/images/%E6%97%85%E8%A1%8C%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/3.jpeg)

`K` æ­¥ä¹‹å†…ä» `src` åˆ° `dst` çš„æœ€å°è·¯å¾„æƒé‡æ˜¯å¤šå°‘ï¼Ÿæˆ‘ä¸çŸ¥é“ã€‚

ä½†æˆ‘å¯ä»¥æŠŠé—®é¢˜åˆ†è§£ï¼š

![img](https://labuladong.online/algo/images/%E6%97%85%E8%A1%8C%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/4.jpeg)

`s1, s2` æ˜¯æŒ‡å‘ `dst` çš„ç›¸é‚»èŠ‚ç‚¹ï¼Œæˆ‘åªè¦çŸ¥é“ `K - 1` æ­¥ä¹‹å†…ä» `src` åˆ°è¾¾ `s1, s2`ï¼Œé‚£æˆ‘å°±å¯ä»¥åœ¨ `K` æ­¥ä¹‹å†…ä» `src` åˆ°è¾¾ `dst`ã€‚

ä¹Ÿå°±æ˜¯å¦‚ä¸‹å…³ç³»å¼ï¼š

```cpp
dp(dst, k) = min(
    dp(s1, k - 1) + w1, 
    dp(s2, k - 1) + w2
)
```

è¿™å°±æ˜¯æ–°çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œå¦‚æœä½ èƒ½çœ‹æ‡‚è¿™ä¸ªç®—å¼ï¼Œå°±å·²ç»å¯ä»¥è§£å†³è¿™é“é¢˜äº†ã€‚

#### ä»£ç å®ç°

æ ¹æ®ä¸Šè¿°æ€è·¯ï¼Œæˆ‘æ€ä¹ˆçŸ¥é“ `s1, s2` æ˜¯æŒ‡å‘ `dst` çš„ç›¸é‚»èŠ‚ç‚¹ï¼Œä»–ä»¬ä¹‹é—´çš„æƒé‡æ˜¯ `w1, w2`ï¼Ÿ

æˆ‘å¸Œæœ›ç»™ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±èƒ½çŸ¥é“æœ‰è°æŒ‡å‘è¿™ä¸ªèŠ‚ç‚¹ï¼Œè¿˜çŸ¥é“å®ƒä»¬ä¹‹é—´çš„æƒé‡ï¼Œå¯¹å§ã€‚

ä¸“ä¸šç‚¹è¯´ï¼Œå¾—ç”¨ä¸€ä¸ªæ•°æ®ç»“æ„è®°å½•æ¯ä¸ªèŠ‚ç‚¹çš„ã€Œå…¥åº¦ã€indegreeï¼Œå³å­˜å‚¨æ‰€æœ‰æŒ‡å‘è¯¥èŠ‚ç‚¹çš„ç›¸é‚»èŠ‚ç‚¹ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´è¾¹çš„æƒé‡ã€‚

å…·ä½“çœ‹ä»£ç å§ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ `indegree` å­˜å‚¨å…¥åº¦ï¼Œç„¶åå®ç° `dp` å‡½æ•°ï¼š

```cpp
class Solution {
public:
    // å“ˆå¸Œè¡¨è®°å½•æ¯ä¸ªç‚¹çš„å…¥åº¦ï¼Œé”®æ˜¯èŠ‚ç‚¹ç¼–å·ï¼Œå€¼æ˜¯æŒ‡å‘è¯¥èŠ‚ç‚¹çš„ç›¸é‚»èŠ‚ç‚¹ä»¥åŠä¹‹é—´çš„æƒé‡
    // to -> [from, price]
    unordered_map<int, vector<pair<int, int>>> indegree;
    int src, dst;
    
    int findCheapestPrice(int n, vector<vector<int>>& flights, int src, int dst, int K) {
        // å°†ä¸­è½¬ç«™ä¸ªæ•°è½¬åŒ–æˆè¾¹çš„æ¡æ•°
        K++;
        this->src = src;
        this->dst = dst;
        
        for(const auto& f : flights) {
            int from = f[0];
            int to = f[1];
            int price = f[2];
            // è®°å½•è°æŒ‡å‘è¯¥èŠ‚ç‚¹ï¼Œä»¥åŠä¹‹é—´çš„æƒé‡
            indegree[to].push_back(make_pair(from, price));
        }
        
        return dp(dst, K);
    }
    
    // å®šä¹‰ï¼šä» src å‡ºå‘ï¼Œk æ­¥ä¹‹å†…åˆ°è¾¾ s çš„æœ€çŸ­è·¯å¾„æƒé‡
    int dp(int s, int k) {
        // base case
        if (s == src) {
            return 0;
        }
        if (k == 0) {
            return -1;
        }
        // åˆå§‹åŒ–ä¸ºæœ€å¤§å€¼ï¼Œæ–¹ä¾¿ç­‰ä¼šå–æœ€å°å€¼
        int res = INT_MAX;
        if (indegree.count(s)) {
            // å½“ s æœ‰å…¥åº¦èŠ‚ç‚¹æ—¶ï¼Œåˆ†è§£ä¸ºå­é—®é¢˜
            for(const auto& v : indegree[s]) {
                int from = v.first;
                int price = v.second;
                // ä» src åˆ°è¾¾ç›¸é‚»çš„å…¥åº¦èŠ‚ç‚¹æ‰€éœ€çš„æœ€çŸ­è·¯å¾„æƒé‡
                int subProblem = dp(from, k - 1);
                // è·³è¿‡æ— è§£çš„æƒ…å†µ
                if (subProblem != -1) {
                    res = min(res, subProblem + price);
                }
            }
        }
        // å¦‚æœè¿˜æ˜¯åˆå§‹å€¼ï¼Œè¯´æ˜æ­¤èŠ‚ç‚¹ä¸å¯è¾¾
        return res == INT_MAX ? -1 : res;
    }
};
```

æœ‰ä¹‹å‰çš„é“ºå«ï¼Œè¿™æ®µè§£æ³•é€»è¾‘åº”è¯¥æ˜¯å¾ˆæ¸…æ™°çš„ã€‚å½“ç„¶ï¼Œå¯¹äºåŠ¨æ€è§„åˆ’é—®é¢˜ï¼Œè‚¯å®šè¦æ¶ˆé™¤é‡å å­é—®é¢˜ã€‚

ä¸ºä»€ä¹ˆæœ‰é‡å å­é—®é¢˜ï¼Ÿå¾ˆç®€å•ï¼Œå¦‚æœæŸä¸ªèŠ‚ç‚¹åŒæ—¶æŒ‡å‘ä¸¤ä¸ªå…¶ä»–èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªèŠ‚ç‚¹å°±æœ‰ç›¸åŒçš„ä¸€ä¸ªå…¥åº¦èŠ‚ç‚¹ï¼Œå°±ä¼šäº§ç”Ÿé‡å¤çš„é€’å½’è®¡ç®—ã€‚

**æ€ä¹ˆæ¶ˆé™¤é‡å å­é—®é¢˜ï¼Ÿæ‰¾é—®é¢˜çš„ã€ŒçŠ¶æ€ã€ã€‚**

çŠ¶æ€æ˜¯ä»€ä¹ˆï¼Ÿåœ¨é—®é¢˜åˆ†è§£ï¼ˆçŠ¶æ€è½¬ç§»ï¼‰çš„è¿‡ç¨‹ä¸­å˜åŒ–çš„ï¼Œå°±æ˜¯çŠ¶æ€ã€‚

**è°åœ¨å˜åŒ–ï¼Ÿæ˜¾ç„¶å°±æ˜¯ `dp` å‡½æ•°çš„å‚æ•° `s` å’Œ `k`ï¼Œæ¯æ¬¡é€’å½’è°ƒç”¨ï¼Œç›®æ ‡ç‚¹ `s` å’Œæ­¥æ•°çº¦æŸ `k` åœ¨å˜åŒ–**ã€‚

æ‰€ä»¥ï¼Œæœ¬é¢˜çš„çŠ¶æ€æœ‰ä¸¤ä¸ªï¼Œåº”è¯¥ç®—æ˜¯äºŒç»´åŠ¨æ€è§„åˆ’ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª `memo` äºŒç»´æ•°ç»„æˆ–è€…å“ˆå¸Œè¡¨ä½œä¸ºå¤‡å¿˜å½•ï¼Œå‡å°‘é‡å¤è®¡ç®—ã€‚

æˆ‘ä»¬é€‰ç”¨äºŒç»´æ•°ç»„åšå¤‡å¿˜å½•å§ï¼Œæ³¨æ„ `K` æ˜¯ä» 1 å¼€å§‹ç®—çš„ï¼Œæ‰€ä»¥å¤‡å¿˜å½•åˆå§‹å¤§å°è¦å†åŠ ä¸€ï¼š

```cpp
class Solution {
    int src, dst;
    unordered_map<int, vector<vector<int>>> indegree;
    // å¤‡å¿˜å½•
    vector<vector<int>> memo;

public:
    int findCheapestPrice(int n, vector<vector<int>>& flights, int src, int dst, int K) {
        K++;
        this->src = src;
        this->dst = dst;
        // åˆå§‹åŒ–å¤‡å¿˜å½•ï¼Œå…¨éƒ¨å¡«ä¸€ä¸ªç‰¹æ®Šå€¼
        memo = vector<vector<int>>(n, vector<int>(K + 1, -888));
        
        // åˆå§‹åŒ– indegree çš„ä»£ç ä¸å˜
        // ...
        
        return dp(dst, K);
    }

    // å®šä¹‰ï¼šä» src å‡ºå‘ï¼Œk æ­¥ä¹‹å†…åˆ°è¾¾ s çš„æœ€å°æˆæœ¬
    int dp(int s, int k) {
        // base case
        if (s == src) {
            return 0;
        }
        if (k == 0) {
            return -1;
        }
        // æŸ¥å¤‡å¿˜å½•ï¼Œé˜²æ­¢å†—ä½™è®¡ç®—
        if (memo[s][k] != -888) {
            return memo[s][k];
        }
        
        // çŠ¶æ€è½¬ç§»ä»£ç ä¸å˜
        // ...
        
        // å­˜å…¥å¤‡å¿˜å½•
        memo[s][k] = res == INT_MAX ? -1 : res;
        return memo[s][k];
    }
};
```

## åšå¼ˆé—®é¢˜

æœ‰è¶£çš„ã€ŒçŸ³å¤´æ¸¸æˆã€ï¼Œé€šè¿‡é¢˜ç›®çš„é™åˆ¶æ¡ä»¶ï¼Œè¿™ä¸ªæ¸¸æˆæ˜¯å…ˆæ‰‹å¿…èƒœçš„ã€‚ä½†æ˜¯æ™ºåŠ›é¢˜ç»ˆç©¶æ˜¯æ™ºåŠ›é¢˜ï¼ŒçœŸæ­£çš„ç®—æ³•é—®é¢˜è‚¯å®šä¸ä¼šæ˜¯æŠ•æœºå–å·§èƒ½æå®šçš„ã€‚æ‰€ä»¥ï¼Œæœ¬æ–‡å°±å€ŸçŸ³å¤´æ¸¸æˆæ¥è®²è®²ã€Œå‡è®¾ä¸¤ä¸ªäººéƒ½è¶³å¤Ÿèªæ˜ï¼Œæœ€åè°ä¼šè·èƒœã€è¿™ä¸€ç±»é—®é¢˜è¯¥å¦‚ä½•ç”¨åŠ¨æ€è§„åˆ’ç®—æ³•è§£å†³ã€‚

åšå¼ˆç±»é—®é¢˜çš„å¥—è·¯éƒ½å·®ä¸å¤šï¼Œå…¶æ ¸å¿ƒæ€è·¯æ˜¯åœ¨äºŒç»´ dp çš„åŸºç¡€ä¸Šä½¿ç”¨å…ƒç»„åˆ†åˆ«å­˜å‚¨ä¸¤ä¸ªäººçš„åšå¼ˆç»“æœã€‚

### çŸ³å¤´æ¸¸æˆ

ä½ å’Œä½ çš„æœ‹å‹é¢å‰æœ‰ä¸€æ’çŸ³å¤´å †ï¼Œç”¨ä¸€ä¸ªæ•°ç»„ `piles` è¡¨ç¤ºï¼Œ`piles[i]` è¡¨ç¤ºç¬¬ `i` å †çŸ³å­æœ‰å¤šå°‘ä¸ªã€‚ä½ ä»¬è½®æµæ‹¿çŸ³å¤´ï¼Œä¸€æ¬¡æ‹¿ä¸€å †ï¼Œä½†æ˜¯åªèƒ½æ‹¿èµ°æœ€å·¦è¾¹æˆ–è€…æœ€å³è¾¹çš„çŸ³å¤´å †ã€‚æ‰€æœ‰çŸ³å¤´è¢«æ‹¿å®Œåï¼Œè°æ‹¥æœ‰çš„çŸ³å¤´å¤šï¼Œè°è·èƒœã€‚

çŸ³å¤´çš„å †æ•°å¯ä»¥æ˜¯ä»»æ„æ­£æ•´æ•°ï¼ŒçŸ³å¤´çš„æ€»æ•°ä¹Ÿå¯ä»¥æ˜¯ä»»æ„æ­£æ•´æ•°ï¼Œè¿™æ ·å°±èƒ½æ‰“ç ´å…ˆæ‰‹å¿…èƒœçš„å±€é¢äº†ã€‚æ¯”å¦‚æœ‰ä¸‰å †çŸ³å¤´ `piles = [1, 100, 3]`ï¼Œå…ˆæ‰‹ä¸ç®¡æ‹¿ 1 è¿˜æ˜¯ 3ï¼Œèƒ½å¤Ÿå†³å®šèƒœè´Ÿçš„ 100 éƒ½ä¼šè¢«åæ‰‹æ‹¿èµ°ï¼Œåæ‰‹ä¼šè·èƒœã€‚

**å‡è®¾ä¸¤äººéƒ½å¾ˆèªæ˜**ï¼Œè¯·ä½ å†™ä¸€ä¸ª `stoneGame` å‡½æ•°ï¼Œè¿”å›å…ˆæ‰‹å’Œåæ‰‹çš„æœ€åå¾—åˆ†ï¼ˆçŸ³å¤´æ€»æ•°ï¼‰ä¹‹å·®ã€‚æ¯”å¦‚ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼Œå…ˆæ‰‹èƒ½è·å¾— 4 åˆ†ï¼Œåæ‰‹ä¼šè·å¾— 100 åˆ†ï¼Œä½ çš„ç®—æ³•åº”è¯¥è¿”å› -96ï¼š

```java
int stoneGame(int[] nums);
```

è¿™ä¸ª `stoneGame` å‡½æ•°æ€ä¹ˆå†™å‘¢ï¼Ÿåšå¼ˆé—®é¢˜çš„éš¾ç‚¹åœ¨äºï¼Œä¸¤ä¸ªäººè¦è½®æµè¿›è¡Œé€‰æ‹©ï¼Œè€Œä¸”éƒ½è´¼ç²¾æ˜ï¼Œåº”è¯¥å¦‚ä½•ç¼–ç¨‹è¡¨ç¤ºè¿™ä¸ªè¿‡ç¨‹å‘¢ï¼Ÿå…¶å®ä¸éš¾ï¼Œé¦–å…ˆæ˜ç¡® `dp` æ•°ç»„çš„å«ä¹‰ï¼Œç„¶ååªè¦æ‰¾åˆ°ã€ŒçŠ¶æ€ã€å’Œã€Œé€‰æ‹©ã€ï¼Œä¸€åˆ‡å°±æ°´åˆ°æ¸ æˆäº†ã€‚

### å®šä¹‰dpæ•°ç»„çš„å«ä¹‰

ä»‹ç» `dp` æ•°ç»„çš„å«ä¹‰ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸‹ `dp` æ•°ç»„æœ€ç»ˆçš„æ ·å­ï¼š

![img](https://labuladong.online/algo/images/%E5%8D%9A%E5%BC%88%E9%97%AE%E9%A2%98/1.png)

ä¸‹æ–‡è®²è§£æ—¶ï¼Œè®¤ä¸ºå…ƒç»„æ˜¯åŒ…å« `first` å’Œ `second` å±æ€§çš„ä¸€ä¸ªç±»ï¼Œè€Œä¸”ä¸ºäº†èŠ‚çœç¯‡å¹…ï¼Œå°†è¿™ä¸¤ä¸ªå±æ€§ç®€å†™ä¸º `fir` å’Œ `sec`ã€‚æ¯”å¦‚æŒ‰ä¸Šå›¾çš„æ•°æ®ï¼Œæˆ‘ä»¬è¯´ `dp[1][3].fir = 11`ï¼Œ`dp[0][1].sec = 2`ã€‚

å…ˆå›ç­”å‡ ä¸ªè¯»è€…å¯èƒ½æå‡ºçš„é—®é¢˜ï¼š

è¿™ä¸ªäºŒç»´ dp table ä¸­å­˜å‚¨çš„æ˜¯å…ƒç»„ï¼Œæ€ä¹ˆç¼–ç¨‹è¡¨ç¤ºå‘¢ï¼Ÿè¿™ä¸ª dp table æœ‰ä¸€åŠæ ¹æœ¬æ²¡ç”¨ä¸Šï¼Œæ€ä¹ˆä¼˜åŒ–ï¼Ÿå¾ˆç®€å•ï¼Œéƒ½ä¸è¦ç®¡ï¼Œå…ˆæŠŠè§£é¢˜çš„æ€è·¯æƒ³æ˜ç™½äº†å†è°ˆä¹Ÿä¸è¿Ÿã€‚

**ä»¥ä¸‹æ˜¯å¯¹ dp æ•°ç»„å«ä¹‰çš„è§£é‡Šï¼š**

`dp[i][j].fir = x` è¡¨ç¤ºï¼Œå¯¹äº `piles[i...j]` è¿™éƒ¨åˆ†çŸ³å¤´å †ï¼Œå…ˆæ‰‹èƒ½è·å¾—çš„æœ€é«˜åˆ†æ•°ä¸º `x`ã€‚

`dp[i][j].sec = y` è¡¨ç¤ºï¼Œå¯¹äº `piles[i...j]` è¿™éƒ¨åˆ†çŸ³å¤´å †ï¼Œåæ‰‹èƒ½è·å¾—çš„æœ€é«˜åˆ†æ•°ä¸º `y`ã€‚

ä¸¾ä¾‹ç†è§£ä¸€ä¸‹ï¼Œå‡è®¾ `piles = [2, 8, 3, 5]`ï¼Œç´¢å¼•ä» 0 å¼€å§‹ï¼Œé‚£ä¹ˆï¼š

`dp[0][1].fir = 8` æ„å‘³ç€ï¼šé¢å¯¹çŸ³å¤´å † `[2, 8]`ï¼Œå…ˆæ‰‹æœ€å¤šèƒ½å¤Ÿè·å¾— 8 åˆ†ï¼›`dp[1][3].sec = 5` æ„å‘³ç€ï¼šé¢å¯¹çŸ³å¤´å † `[8, 3, 5]`ï¼Œåæ‰‹æœ€å¤šèƒ½å¤Ÿè·å¾— 5 åˆ†ã€‚

æˆ‘ä»¬æƒ³æ±‚çš„ç­”æ¡ˆæ˜¯å…ˆæ‰‹å’Œåæ‰‹æœ€ç»ˆåˆ†æ•°ä¹‹å·®ï¼ŒæŒ‰ç…§è¿™ä¸ªå®šä¹‰ä¹Ÿå°±æ˜¯ `dp[0][n-1].fir - dp[0][n-1].sec`ï¼Œå³é¢å¯¹æ•´ä¸ª `piles`ï¼Œå…ˆæ‰‹çš„æœ€ä¼˜å¾—åˆ†å’Œåæ‰‹çš„æœ€ä¼˜å¾—åˆ†ä¹‹å·®ã€‚

### çŠ¶æ€è½¬ç§»æ–¹ç¨‹

å†™çŠ¶æ€è½¬ç§»æ–¹ç¨‹å¾ˆç®€å•ï¼Œé¦–å…ˆè¦æ‰¾åˆ°æ‰€æœ‰ã€ŒçŠ¶æ€ã€å’Œæ¯ä¸ªçŠ¶æ€å¯ä»¥åšçš„ã€Œé€‰æ‹©ã€ï¼Œç„¶åæ‹©ä¼˜ã€‚

æ ¹æ®å‰é¢å¯¹ `dp` æ•°ç»„çš„å®šä¹‰ï¼Œ**çŠ¶æ€æ˜¾ç„¶æœ‰ä¸‰ä¸ªï¼šå¼€å§‹çš„ç´¢å¼• `i`ï¼Œç»“æŸçš„ç´¢å¼• `j`ï¼Œå½“å‰è½®åˆ°çš„äººã€‚**

```cpp
dp[i][j][fir or sec]
å…¶ä¸­ï¼š
0 <= i < piles.length
i <= j < piles.length
```

å¯¹äºè¿™ä¸ªé—®é¢˜çš„æ¯ä¸ªçŠ¶æ€ï¼Œå¯ä»¥åšçš„**é€‰æ‹©æœ‰ä¸¤ä¸ªï¼šé€‰æ‹©æœ€å·¦è¾¹çš„é‚£å †çŸ³å¤´ï¼Œæˆ–è€…é€‰æ‹©æœ€å³è¾¹çš„é‚£å †çŸ³å¤´ã€‚** æˆ‘ä»¬å¯ä»¥è¿™æ ·ç©·ä¸¾æ‰€æœ‰çŠ¶æ€ï¼š

```python
n = piles.length
for 0 <= i < n:
    for j <= i < n:
        for who in {fir, sec}:
            dp[i][j][who] = max(left, right)
```

ä¸Šé¢çš„ä¼ªç æ˜¯åŠ¨æ€è§„åˆ’çš„ä¸€ä¸ªå¤§è‡´çš„æ¡†æ¶ï¼Œè¿™é“é¢˜çš„éš¾ç‚¹åœ¨äºï¼Œä¸¤äººè¶³å¤Ÿèªæ˜ï¼Œè€Œä¸”æ˜¯äº¤æ›¿è¿›è¡Œé€‰æ‹©çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å…ˆæ‰‹çš„é€‰æ‹©ä¼šå¯¹åæ‰‹æœ‰å½±å“ï¼Œè¿™æ€ä¹ˆè¡¨è¾¾å‡ºæ¥å‘¢ï¼Ÿ

æ ¹æ®æˆ‘ä»¬å¯¹ `dp` æ•°ç»„çš„å®šä¹‰ï¼Œå¾ˆå®¹æ˜“è§£å†³è¿™ä¸ªéš¾ç‚¹ï¼Œ**å†™å‡ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š**

```python
dp[i][j].fir = max(piles[i] + dp[i+1][j].sec, piles[j] + dp[i][j-1].sec)
dp[i][j].fir = max(     é€‰æ‹©æœ€å·¦è¾¹çš„çŸ³å¤´å †     ,     é€‰æ‹©æœ€å³è¾¹çš„çŸ³å¤´å †      )
# è§£é‡Šï¼šæˆ‘ä½œä¸ºå…ˆæ‰‹ï¼Œé¢å¯¹ piles[i...j] æ—¶ï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼š

# è¦ä¹ˆæˆ‘é€‰æ‹©æœ€å·¦è¾¹çš„é‚£ä¸€å †çŸ³å¤´ piles[i]ï¼Œå±€é¢å˜æˆäº† piles[i+1...j]ï¼Œ
# ç„¶åè½®åˆ°å¯¹æ–¹é€‰äº†ï¼Œæˆ‘å˜æˆäº†åæ‰‹ï¼Œæ­¤æ—¶æˆ‘ä½œä¸ºåæ‰‹çš„æœ€ä¼˜å¾—åˆ†æ˜¯ dp[i+1][j].sec

# è¦ä¹ˆæˆ‘é€‰æ‹©æœ€å³è¾¹çš„é‚£ä¸€å †çŸ³å¤´ piles[j]ï¼Œå±€é¢å˜æˆäº† piles[i...j-1]
# ç„¶åè½®åˆ°å¯¹æ–¹é€‰äº†ï¼Œæˆ‘å˜æˆäº†åæ‰‹ï¼Œæ­¤æ—¶æˆ‘ä½œä¸ºåæ‰‹çš„æœ€ä¼˜å¾—åˆ†æ˜¯ dp[i][j-1].sec

if å…ˆæ‰‹é€‰æ‹©å·¦è¾¹:
    dp[i][j].sec = dp[i+1][j].fir
if å…ˆæ‰‹é€‰æ‹©å³è¾¹:
    dp[i][j].sec = dp[i][j-1].fir
# è§£é‡Šï¼šæˆ‘ä½œä¸ºåæ‰‹ï¼Œè¦ç­‰å…ˆæ‰‹å…ˆé€‰æ‹©ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š

# å¦‚æœå…ˆæ‰‹é€‰æ‹©äº†æœ€å·¦è¾¹é‚£å †ï¼Œç»™æˆ‘å‰©ä¸‹äº† piles[i+1...j]
# æ­¤æ—¶è½®åˆ°æˆ‘ï¼Œæˆ‘å˜æˆäº†å…ˆæ‰‹ï¼Œæ­¤æ—¶çš„æœ€ä¼˜å¾—åˆ†æ˜¯ dp[i+1][j].fir

# å¦‚æœå…ˆæ‰‹é€‰æ‹©äº†æœ€å³è¾¹é‚£å †ï¼Œç»™æˆ‘å‰©ä¸‹äº† piles[i...j-1]
# æ­¤æ—¶è½®åˆ°æˆ‘ï¼Œæˆ‘å˜æˆäº†å…ˆæ‰‹ï¼Œæ­¤æ—¶çš„æœ€ä¼˜å¾—åˆ†æ˜¯ dp[i][j-1].fir
```

æ ¹æ® dp æ•°ç»„çš„å®šä¹‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰¾å‡º **base case**ï¼Œä¹Ÿå°±æ˜¯æœ€ç®€å•çš„æƒ…å†µï¼š

```python
dp[i][j].fir = piles[i]
dp[i][j].sec = 0
å…¶ä¸­ 0 <= i == j < n
# è§£é‡Šï¼ši å’Œ j ç›¸ç­‰å°±æ˜¯è¯´é¢å‰åªæœ‰ä¸€å †çŸ³å¤´ piles[i]
# é‚£ä¹ˆæ˜¾ç„¶å…ˆæ‰‹çš„å¾—åˆ†ä¸º piles[i]
# åæ‰‹æ²¡æœ‰çŸ³å¤´æ‹¿äº†ï¼Œå¾—åˆ†ä¸º 0
```

![img](https://labuladong.online/algo/images/%E5%8D%9A%E5%BC%88%E9%97%AE%E9%A2%98/2.png)

è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œæˆ‘ä»¬å‘ç° base case æ˜¯æ–œç€çš„ï¼Œè€Œä¸”æˆ‘ä»¬æ¨ç®— `dp[i][j]` æ—¶éœ€è¦ç”¨åˆ° `dp[i+1][j]` å’Œ `dp[i][j-1]`ï¼š

![img](https://labuladong.online/algo/images/%E5%8D%9A%E5%BC%88%E9%97%AE%E9%A2%98/3.png)

åˆ¤æ–­ `dp` æ•°ç»„éå†æ–¹å‘çš„åŸåˆ™ï¼Œç®—æ³•åº”è¯¥å€’ç€éå† `dp` æ•°ç»„ï¼š

```cpp
for (int i = n - 2; i >= 0; i--) {
    for (int j = i + 1; j < n; j++) {
        dp[i][j] = ...
    }
}
```

### ä»£ç å®ç°

å¦‚ä½•å®ç°è¿™ä¸ª fir å’Œ sec å…ƒç»„å‘¢ï¼Œä½ å¯ä»¥ç”¨ pythonï¼Œè‡ªå¸¦å…ƒç»„ç±»å‹ï¼›æˆ–è€…ä½¿ç”¨ C++ çš„ pair å®¹å™¨ï¼›æˆ–è€…ç”¨ä¸€ä¸ªä¸‰ç»´æ•°ç»„ `dp[n][n][2]`ï¼Œæœ€åä¸€ä¸ªç»´åº¦å°±ç›¸å½“äºå…ƒç»„ï¼›æˆ–è€…æˆ‘ä»¬è‡ªå·±å†™ä¸€ä¸ª Pair ç±»ï¼š

```cpp
class Pair {
    private:
        int fir, sec;
    public:
        Pair(int fir, int sec) {
            this->fir = fir;
            this->sec = sec;
        }
};
```

ç„¶åç›´æ¥æŠŠæˆ‘ä»¬çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ç¿»è¯‘æˆä»£ç å³å¯ï¼Œæ³¨æ„æˆ‘ä»¬è¦å€’ç€éå†æ•°ç»„ï¼š

```cpp
#include <iostream>
#include <algorithm>
using namespace std;

struct Pair {
    int fir, sec;
    Pair(int f, int s) : fir(f), sec(s) {}
};

/* è¿”å›æ¸¸æˆæœ€åå…ˆæ‰‹å’Œåæ‰‹çš„å¾—åˆ†ä¹‹å·® */
int stoneGame(int* piles, int n) {
    // åˆå§‹åŒ– dp æ•°ç»„
    Pair** dp = new Pair*[n];
    for (int i = 0; i < n; i++)
        dp[i] = new Pair[n];
    for (int i = 0; i < n; i++) 
        for (int j = i; j < n; j++)
            dp[i][j] = Pair(0, 0);
    // å¡«å…¥ base case
    for (int i = 0; i < n; i++) {
        dp[i][i].fir = piles[i];
        dp[i][i].sec = 0;
    }

    // å€’ç€éå†æ•°ç»„
    for (int i = n - 2; i >= 0; i--) {
        for (int j = i + 1; j < n; j++) {
            // å…ˆæ‰‹é€‰æ‹©æœ€å·¦è¾¹æˆ–æœ€å³è¾¹çš„åˆ†æ•°
            int left = piles[i] + dp[i+1][j].sec;
            int right = piles[j] + dp[i][j-1].sec;
            // å¥—ç”¨çŠ¶æ€è½¬ç§»æ–¹ç¨‹
            // å…ˆæ‰‹è‚¯å®šä¼šé€‰æ‹©æ›´å¤§çš„ç»“æœï¼Œåæ‰‹çš„é€‰æ‹©éšä¹‹æ”¹å˜
            if (left > right) {
                dp[i][j].fir = left;
                dp[i][j].sec = dp[i+1][j].fir;
            } else {
                dp[i][j].fir = right;
                dp[i][j].sec = dp[i][j-1].fir;
            }
        }
    }
    Pair res = dp[0][n-1];
    for (int i = 0; i < n; i++) {
        delete[] dp[i];
    }
    delete[] dp;
    return res.fir - res.sec;
}

int main() {
    int piles[] = {3, 9, 1, 2};
    int n = sizeof(piles) / sizeof(*piles);
    
    cout << stoneGame(piles, n) << endl;
    return 0; 
}
```

### æ€»ç»“

æœ¬æ–‡ç»™å‡ºäº†è§£å†³åšå¼ˆé—®é¢˜çš„åŠ¨æ€è§„åˆ’è§£æ³•ã€‚åšå¼ˆé—®é¢˜çš„å‰æä¸€èˆ¬éƒ½æ˜¯åœ¨ä¸¤ä¸ªèªæ˜äººä¹‹é—´è¿›è¡Œï¼Œç¼–ç¨‹æè¿°è¿™ç§æ¸¸æˆçš„ä¸€èˆ¬æ–¹æ³•æ˜¯äºŒç»´ dp æ•°ç»„ï¼Œæ•°ç»„ä¸­é€šè¿‡å…ƒç»„åˆ†åˆ«è¡¨ç¤ºä¸¤äººçš„æœ€ä¼˜å†³ç­–ã€‚

ä¹‹æ‰€ä»¥è¿™æ ·è®¾è®¡ï¼Œæ˜¯å› ä¸ºå…ˆæ‰‹åœ¨åšå‡ºé€‰æ‹©ä¹‹åï¼Œå°±æˆäº†åæ‰‹ï¼Œåæ‰‹åœ¨å¯¹æ–¹åšå®Œé€‰æ‹©åï¼Œå°±å˜æˆäº†å…ˆæ‰‹ã€‚**è¿™ç§è§’è‰²è½¬æ¢ä½¿å¾—æˆ‘ä»¬å¯ä»¥é‡ç”¨ä¹‹å‰çš„ç»“æœï¼Œå…¸å‹çš„åŠ¨æ€è§„åˆ’æ ‡å¿—**ã€‚

## å››é”®é”®ç›˜

> é¢˜ç›®

å‡è®¾ä½ æœ‰ä¸€ä¸ªç‰¹æ®Šçš„é”®ç›˜ï¼Œä¸Šé¢åªæœ‰å››ä¸ªé”®ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š

1ã€`A` é”®ï¼šåœ¨å±å¹•ä¸Šæ‰“å°ä¸€ä¸ª `A`ã€‚

2ã€`Ctrl-A` é”®ï¼šé€‰ä¸­æ•´ä¸ªå±å¹•ã€‚

3ã€`Ctrl-C` é”®ï¼šå¤åˆ¶é€‰ä¸­çš„åŒºåŸŸåˆ°ç¼“å†²åŒºã€‚

4ã€`Ctrl-V` é”®ï¼šå°†ç¼“å†²åŒºçš„å†…å®¹è¾“å…¥åˆ°å…‰æ ‡æ‰€åœ¨çš„å±å¹•ä¸Šã€‚

è¿™å°±å’Œæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„å…¨é€‰å¤åˆ¶ç²˜è´´åŠŸèƒ½å®Œå…¨ç›¸åŒå˜›ï¼Œåªä¸è¿‡é¢˜ç›®æŠŠ `Ctrl` çš„ç»„åˆé”®è§†ä¸ºäº†ä¸€ä¸ªé”®ã€‚ç°åœ¨è¦æ±‚ä½ åªèƒ½è¿›è¡Œ `N` æ¬¡æ“ä½œï¼Œè¯·ä½ è®¡ç®—å±å¹•ä¸Šæœ€å¤šèƒ½æ˜¾ç¤ºå¤šå°‘ä¸ª `A`ï¼Ÿ

å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

```cpp
int maxA(int N);
```

æ¯”å¦‚è¯´è¾“å…¥ `N = 3`ï¼Œç®—æ³•è¿”å› 3ï¼Œå› ä¸ºè¿æŒ‰ 3 æ¬¡ `A` é”®æ˜¯æœ€ä¼˜çš„æ–¹æ¡ˆã€‚

å¦‚æœè¾“å…¥æ˜¯ `N = 7`ï¼Œåˆ™ç®—æ³•è¿”å› 9ï¼Œæœ€ä¼˜çš„æ“ä½œåºåˆ—å¦‚ä¸‹ï¼š

```
A, A, A, Ctrl-A, Ctrl-C, Ctrl-V, Ctrl-V
```

å¯ä»¥å¾—åˆ° 9 ä¸ª `A`ã€‚

å¦‚ä½•åœ¨ `N` æ¬¡æ•²å‡»æŒ‰é’®åå¾—åˆ°æœ€å¤šçš„ `A`ï¼Ÿæˆ‘ä»¬ç©·ä¸¾å‘—ï¼Œæ¯æ¬¡æœ‰å¯¹äºæ¯æ¬¡æŒ‰é”®ï¼Œæˆ‘ä»¬å¯ä»¥ç©·ä¸¾å››ç§å¯èƒ½ï¼Œå¾ˆæ˜æ˜¾å°±æ˜¯ä¸€ä¸ªåŠ¨æ€è§„åˆ’é—®é¢˜ã€‚

### ç¬¬ä¸€ç§æ€è·¯

è¿™ç§æ€è·¯ä¼šå¾ˆå®¹æ˜“ç†è§£ï¼Œä½†æ˜¯æ•ˆç‡å¹¶ä¸é«˜ï¼Œæˆ‘ä»¬ç›´æ¥èµ°æµç¨‹ï¼š**å¯¹äºåŠ¨æ€è§„åˆ’é—®é¢˜ï¼Œé¦–å…ˆè¦æ˜ç™½æœ‰å“ªäº›ã€ŒçŠ¶æ€ã€ï¼Œæœ‰å“ªäº›ã€Œé€‰æ‹©ã€**ã€‚

å…·ä½“åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå¯¹äºæ¯æ¬¡æ•²å‡»æŒ‰é”®ï¼Œæœ‰å“ªäº›ã€Œé€‰æ‹©ã€æ˜¯å¾ˆæ˜æ˜¾çš„ï¼š4 ç§ï¼Œå°±æ˜¯é¢˜ç›®ä¸­æåˆ°çš„å››ä¸ªæŒ‰é”®ï¼Œåˆ†åˆ«æ˜¯ `A`ã€`C-A`ã€`C-C`ã€`C-V`ï¼ˆ`Ctrl` ç®€å†™ä¸º `C`ï¼‰ã€‚

æ¥ä¸‹æ¥ï¼Œæ€è€ƒä¸€ä¸‹å¯¹äºè¿™ä¸ªé—®é¢˜æœ‰å“ªäº›ã€ŒçŠ¶æ€ã€ï¼Ÿ**æˆ–è€…æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆä¿¡æ¯ï¼Œæ‰èƒ½å°†åŸé—®é¢˜åˆ†è§£ä¸ºè§„æ¨¡æ›´å°çš„å­é—®é¢˜**ï¼Ÿ

ä½ çœ‹æˆ‘è¿™æ ·å®šä¹‰ä¸‰ä¸ªçŠ¶æ€è¡Œä¸è¡Œï¼šç¬¬ä¸€ä¸ªçŠ¶æ€æ˜¯å‰©ä½™çš„æŒ‰é”®æ¬¡æ•°ï¼Œç”¨ `n` è¡¨ç¤ºï¼›ç¬¬äºŒä¸ªçŠ¶æ€æ˜¯å½“å‰å±å¹•ä¸Šå­—ç¬¦ A çš„æ•°é‡ï¼Œç”¨ `a_num` è¡¨ç¤ºï¼›ç¬¬ä¸‰ä¸ªçŠ¶æ€æ˜¯å‰ªåˆ‡æ¿ä¸­å­—ç¬¦ A çš„æ•°é‡ï¼Œç”¨ `copy` è¡¨ç¤ºã€‚

å¦‚æ­¤å®šä¹‰ã€ŒçŠ¶æ€ã€ï¼Œå°±å¯ä»¥çŸ¥é“ base caseï¼šå½“å‰©ä½™æ¬¡æ•° `n` ä¸º 0 æ—¶ï¼Œ`a_num` å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆã€‚

ç»“åˆåˆšæ‰è¯´çš„ 4 ç§ã€Œé€‰æ‹©ã€ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™å‡ ç§é€‰æ‹©é€šè¿‡çŠ¶æ€è½¬ç§»è¡¨ç¤ºå‡ºæ¥ï¼š

```python
dp(n - 1, a_num + 1, copy),    # A
è§£é‡Šï¼šæŒ‰ä¸‹ A é”®ï¼Œå±å¹•ä¸ŠåŠ ä¸€ä¸ªå­—ç¬¦
åŒæ—¶æ¶ˆè€— 1 ä¸ªæ“ä½œæ•°

dp(n - 1, a_num + copy, copy), # C-V
è§£é‡Šï¼šæŒ‰ä¸‹ C-V ç²˜è´´ï¼Œå‰ªåˆ‡æ¿ä¸­çš„å­—ç¬¦åŠ å…¥å±å¹•
åŒæ—¶æ¶ˆè€— 1 ä¸ªæ“ä½œæ•°

dp(n - 2, a_num, a_num)        # C-A C-C
è§£é‡Šï¼šå…¨é€‰å’Œå¤åˆ¶å¿…ç„¶æ˜¯è”åˆä½¿ç”¨çš„ï¼Œ
å‰ªåˆ‡æ¿ä¸­ A çš„æ•°é‡å˜ä¸ºå±å¹•ä¸Š A çš„æ•°é‡
åŒæ—¶æ¶ˆè€— 2 ä¸ªæ“ä½œæ•°
```

è¿™æ ·å¯ä»¥çœ‹åˆ°é—®é¢˜çš„è§„æ¨¡ `n` åœ¨ä¸æ–­å‡å°ï¼Œè‚¯å®šå¯ä»¥åˆ°è¾¾ `n = 0` çš„ base caseï¼Œæ‰€ä»¥è¿™ä¸ªæ€è·¯æ˜¯æ­£ç¡®çš„ï¼š

```cpp
int maxA(int n) {
    // å¯¹äº (n, a_num, copy) è¿™ä¸ªçŠ¶æ€ï¼Œ
    // å±å¹•ä¸Šèƒ½æœ€ç»ˆæœ€å¤šèƒ½æœ‰ dp(n, a_num, copy) ä¸ª A
    map<tuple<int,int,int>, int> memo;

    // å®šä¹‰ dp å‡½æ•°
    function<int(int,int,int)> dp = [&](int n, int a_num, int copy) -> int {
        // base case
        if(n <= 0) return a_num;
        auto key = make_tuple(n, a_num, copy);
        if(memo.count(key)) return memo[key];
        // å‡ ç§é€‰æ‹©å…¨è¯•ä¸€éï¼Œé€‰æ‹©æœ€å¤§çš„ç»“æœ
        memo[key] = max({dp(n-1, a_num + 1, copy), dp(n-1, a_num + copy, copy), dp(n-2, a_num, a_num + copy)});
        return memo[key];
    };

    // å¯ä»¥æŒ‰ N æ¬¡æŒ‰é”®ï¼Œå±å¹•å’Œå‰ªåˆ‡æ¿é‡Œéƒ½è¿˜æ²¡æœ‰ A
    return dp(n, 0, 0);
}
```

æˆ‘ä»¬å°è¯•åˆ†æä¸€ä¸‹è¿™ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼Œå°±ä¼šå‘ç°ä¸å®¹æ˜“åˆ†æã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ª dp å‡½æ•°å†™æˆ dp æ•°ç»„ï¼š

```
dp[n][a_num][copy]
# çŠ¶æ€çš„æ€»æ•°ï¼ˆæ—¶ç©ºå¤æ‚åº¦ï¼‰å°±æ˜¯è¿™ä¸ªä¸‰ç»´æ•°ç»„çš„ä½“ç§¯
```

æˆ‘ä»¬çŸ¥é“å˜é‡ `n` æœ€å¤šä¸º `N`ï¼Œä½†æ˜¯ `a_num` å’Œ `copy` æœ€å¤šä¸ºå¤šå°‘æˆ‘ä»¬å¾ˆéš¾è®¡ç®—ï¼Œå¤æ‚åº¦èµ·ç ä¹Ÿæœ‰ O(N^3) å§ã€‚æ‰€ä»¥è¿™ä¸ªç®—æ³•å¹¶ä¸å¥½ï¼Œå¤æ‚åº¦å¤ªé«˜ï¼Œä¸”å·²ç»æ— æ³•ä¼˜åŒ–äº†ã€‚

è¿™ä¹Ÿå°±è¯´æ˜ï¼Œæˆ‘ä»¬è¿™æ ·å®šä¹‰ã€ŒçŠ¶æ€ã€æ˜¯ä¸å¤ªä¼˜ç§€çš„ï¼Œä¸‹é¢æˆ‘ä»¬æ¢ä¸€ç§å®šä¹‰ dp çš„æ€è·¯ã€‚

### ç¬¬äºŒç§æ€è·¯

è¿™ç§æ€è·¯ç¨å¾®æœ‰ç‚¹å¤æ‚ï¼Œä½†æ˜¯æ•ˆç‡é«˜ã€‚ç»§ç»­èµ°æµç¨‹ï¼Œã€Œé€‰æ‹©ã€è¿˜æ˜¯é‚£ 4 ä¸ªï¼Œä½†æ˜¯è¿™æ¬¡æˆ‘ä»¬åªå®šä¹‰ä¸€ä¸ªã€ŒçŠ¶æ€ã€ï¼Œä¹Ÿå°±æ˜¯å‰©ä½™çš„æ•²å‡»æ¬¡æ•° `n`ã€‚

è¿™ä¸ªç®—æ³•åŸºäºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œ**æœ€ä¼˜æŒ‰é”®åºåˆ—ä¸€å®šåªæœ‰ä¸¤ç§æƒ…å†µ**ï¼š

è¦ä¹ˆä¸€ç›´æŒ‰ `A`ï¼šA,A,...Aï¼ˆå½“ N æ¯”è¾ƒå°æ—¶ï¼‰ã€‚

è¦ä¹ˆæ˜¯è¿™ä¹ˆä¸€ä¸ªå½¢å¼ï¼šA,A,...C-A,C-C,C-V,C-V,...C-Vï¼ˆå½“ N æ¯”è¾ƒå¤§æ—¶ï¼‰ã€‚

å› ä¸ºå­—ç¬¦æ•°é‡å°‘ï¼ˆN æ¯”è¾ƒå°ï¼‰æ—¶ï¼Œ`C-A C-C C-V` è¿™ä¸€å¥—æ“ä½œçš„ä»£ä»·ç›¸å¯¹æ¯”è¾ƒé«˜ï¼Œå¯èƒ½ä¸å¦‚ä¸€ä¸ªä¸ªæŒ‰ `A`ï¼›è€Œå½“ N æ¯”è¾ƒå¤§æ—¶ï¼ŒåæœŸ `C-V` çš„æ”¶è·è‚¯å®šå¾ˆå¤§ã€‚è¿™ç§æƒ…å†µä¸‹æ•´ä¸ªæ“ä½œåºåˆ—å¤§è‡´æ˜¯ï¼š**å¼€å¤´è¿æŒ‰å‡ ä¸ª `A`ï¼Œç„¶å `C-A C-C` ç»„åˆå†æ¥è‹¥å¹² `C-V`ï¼Œç„¶åå† `C-A C-C` æ¥ç€è‹¥å¹² `C-V`ï¼Œå¾ªç¯ä¸‹å»**ã€‚

æ¢å¥è¯è¯´ï¼Œæœ€åä¸€æ¬¡æŒ‰é”®è¦ä¹ˆæ˜¯ `A` è¦ä¹ˆæ˜¯ `C-V`ã€‚æ˜ç¡®äº†è¿™ä¸€ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸¤ç§æƒ…å†µæ¥è®¾è®¡ç®—æ³•ï¼š

```cpp
int[] dp = new int[N + 1];
// å®šä¹‰ï¼šdp[i] è¡¨ç¤º i æ¬¡æ“ä½œåæœ€å¤šèƒ½æ˜¾ç¤ºå¤šå°‘ä¸ª A
for (int i = 0; i <= N; i++) 
    dp[i] = max(
            è¿™æ¬¡æŒ‰ A é”®ï¼Œ
            è¿™æ¬¡æŒ‰ C-V
        )
```

å¯¹äºã€ŒæŒ‰ `A` é”®ã€è¿™ç§æƒ…å†µï¼Œå°±æ˜¯çŠ¶æ€ `i - 1` çš„å±å¹•ä¸Šæ–°å¢äº†ä¸€ä¸ª A è€Œå·²ï¼Œå¾ˆå®¹æ˜“å¾—åˆ°ç»“æœï¼š

```cpp
// æŒ‰ A é”®ï¼Œå°±æ¯”ä¸Šæ¬¡å¤šä¸€ä¸ª A è€Œå·²
dp[i] = dp[i - 1] + 1;
```

ä½†æ˜¯ï¼Œå¦‚æœè¦æŒ‰ `C-V`ï¼Œè¿˜è¦è€ƒè™‘ä¹‹å‰æ˜¯åœ¨å“ªé‡Œ `C-A C-C` çš„ã€‚

**åˆšæ‰è¯´äº†ï¼Œæœ€ä¼˜çš„æ“ä½œåºåˆ—ä¸€å®šæ˜¯ `C-A C-C` æ¥ç€è‹¥å¹² `C-V`ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ä¸€ä¸ªå˜é‡ `j` ä½œä¸ºè‹¥å¹² `C-V` çš„èµ·ç‚¹**ã€‚é‚£ä¹ˆ `j` ä¹‹å‰çš„ 2 ä¸ªæ“ä½œå°±åº”è¯¥æ˜¯ `C-A C-C` äº†ï¼š

```cpp
int maxA(int N) {
    vector<int> dp(N + 1);
    dp[0] = 0;
    for (int i = 1; i <= N; i++) {
        // æŒ‰ A é”®
        dp[i] = dp[i - 1] + 1;
        for (int j = 2; j < i; j++) {
            // å…¨é€‰ & å¤åˆ¶ dp[j-2]ï¼Œè¿ç»­ç²˜è´´ i - j æ¬¡
            // å±å¹•ä¸Šå…± dp[j - 2] * (i - j + 1) ä¸ª A
            dp[i] = max(dp[i], dp[j - 2] * (i - j + 1));
        }
    }
    // N æ¬¡æŒ‰é”®ä¹‹åæœ€å¤šæœ‰å‡ ä¸ª Aï¼Ÿ
    return dp[N];
}
```

å…¶ä¸­ `j` å˜é‡å‡ 2 æ˜¯ç»™ `C-A C-C` ç•™ä¸‹æ“ä½œæ•°ï¼Œçœ‹ä¸ªå›¾å°±æ˜ç™½äº†ï¼š

![img](https://labuladong.online/algo/images/4keyboard/1.jpg)

è¿™æ ·ï¼Œæ­¤ç®—æ³•å°±å®Œæˆäº†ï¼Œæ—¶é—´å¤æ‚åº¦ O(N^2)ï¼Œç©ºé—´å¤æ‚åº¦ O(N)ï¼Œè¿™ç§è§£æ³•åº”è¯¥æ˜¯æ¯”è¾ƒé«˜æ•ˆçš„äº†ã€‚

### æ€»ç»“

åŠ¨æ€è§„åˆ’éš¾å°±éš¾åœ¨å¯»æ‰¾çŠ¶æ€è½¬ç§»ï¼Œä¸åŒçš„å®šä¹‰å¯ä»¥äº§ç”Ÿä¸åŒçš„çŠ¶æ€è½¬ç§»é€»è¾‘ï¼Œè™½ç„¶æœ€åéƒ½èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œä½†æ˜¯æ•ˆç‡å¯èƒ½æœ‰å·¨å¤§çš„å·®å¼‚ã€‚

å›é¡¾ç¬¬ä¸€ç§è§£æ³•ï¼Œé‡å å­é—®é¢˜å·²ç»æ¶ˆé™¤äº†ï¼Œä½†æ˜¯æ•ˆç‡è¿˜æ˜¯ä½ï¼Œåˆ°åº•ä½åœ¨å“ªé‡Œå‘¢ï¼ŸæŠ½è±¡å‡ºé€’å½’æ¡†æ¶ï¼š

```python
def dp(n, a_num, copy):
    dp(n - 1, a_num + 1, copy),    # A
    dp(n - 1, a_num + copy, copy), # C-V
    dp(n - 2, a_num, a_num)        # C-A C-C
```

çœ‹è¿™ä¸ªç©·ä¸¾é€»è¾‘ï¼Œæ˜¯æœ‰å¯èƒ½å‡ºç°è¿™æ ·çš„æ“ä½œåºåˆ— `C-A C-Cï¼ŒC-A C-C...` æˆ–è€… `C-V,C-V,...`ã€‚ç„¶è¿™ç§æ“ä½œåºåˆ—çš„ç»“æœä¸æ˜¯æœ€ä¼˜çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰æƒ³åŠæ³•è§„é¿è¿™äº›æƒ…å†µçš„å‘ç”Ÿï¼Œä»è€Œå¢åŠ äº†å¾ˆå¤šæ²¡å¿…è¦çš„å­é—®é¢˜è®¡ç®—ã€‚

å›é¡¾ç¬¬äºŒç§è§£æ³•ï¼Œæˆ‘ä»¬ç¨åŠ æ€è€ƒå°±èƒ½æƒ³åˆ°ï¼Œæœ€ä¼˜çš„åºåˆ—åº”è¯¥æ˜¯è¿™ç§å½¢å¼ï¼š`A,A..C-A,C-C,C-V,C-V..C-A,C-C,C-V..`ã€‚

æ ¹æ®è¿™ä¸ªäº‹å®ï¼Œæˆ‘ä»¬é‡æ–°å®šä¹‰äº†çŠ¶æ€ï¼Œé‡æ–°å¯»æ‰¾äº†çŠ¶æ€è½¬ç§»ï¼Œä»é€»è¾‘ä¸Šå‡å°‘äº†æ— æ•ˆçš„å­é—®é¢˜ä¸ªæ•°ï¼Œä»è€Œæé«˜äº†ç®—æ³•çš„æ•ˆç‡ã€‚

## å›¢ç­LeetCodeè‚¡ç¥¨

è¿™ 6 é“é¢˜ç›®æ˜¯æœ‰å…±æ€§çš„ï¼Œæˆ‘ä»¬åªéœ€è¦æŠ½å‡ºæ¥åŠ›æ‰£ç¬¬ 188 é¢˜ã€Œ[ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IV](https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-iv/)ã€è¿›è¡Œç ”ç©¶ï¼Œå› ä¸ºè¿™é“é¢˜æ˜¯æœ€æ³›åŒ–çš„å½¢å¼ï¼Œå…¶ä»–çš„é—®é¢˜éƒ½æ˜¯è¿™ä¸ªå½¢å¼çš„ç®€åŒ–ï¼Œçœ‹ä¸‹é¢˜ç›®ï¼š

> é¢˜ç›®

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `prices` å’Œä¸€ä¸ªæ•´æ•° `k` ï¼Œå…¶ä¸­ `prices[i]` æ˜¯æŸæ”¯ç»™å®šçš„è‚¡ç¥¨åœ¨ç¬¬ `i` å¤©çš„ä»·æ ¼ã€‚

è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ æœ€å¤šå¯ä»¥å®Œæˆ `k` ç¬”äº¤æ˜“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ æœ€å¤šå¯ä»¥ä¹° `k` æ¬¡ï¼Œå– `k` æ¬¡ã€‚

**æ³¨æ„ï¼š**ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼šk = 2, prices = [2,4,1]
è¾“å‡ºï¼š2
è§£é‡Šï¼šåœ¨ç¬¬ 1 å¤© (è‚¡ç¥¨ä»·æ ¼ = 2) çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 2 å¤© (è‚¡ç¥¨ä»·æ ¼ = 4) çš„æ—¶å€™å–å‡ºï¼Œè¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 4-2 = 2 ã€‚
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šk = 2, prices = [3,2,6,5,0,3]
è¾“å‡ºï¼š7
è§£é‡Šï¼šåœ¨ç¬¬ 2 å¤© (è‚¡ç¥¨ä»·æ ¼ = 2) çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤© (è‚¡ç¥¨ä»·æ ¼ = 6) çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 6-2 = 4 ã€‚
     éšåï¼Œåœ¨ç¬¬ 5 å¤© (è‚¡ç¥¨ä»·æ ¼ = 0) çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 6 å¤© (è‚¡ç¥¨ä»·æ ¼ = 3) çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 3-0 = 3 ã€‚
```

**æç¤ºï¼š**

- `1 <= k <= 100`
- `1 <= prices.length <= 1000`
- `0 <= prices[i] <= 1000`

ç¬¬ä¸€é¢˜æ˜¯åªè¿›è¡Œä¸€æ¬¡äº¤æ˜“ï¼Œç›¸å½“äº `k = 1`ï¼›ç¬¬äºŒé¢˜æ˜¯ä¸é™äº¤æ˜“æ¬¡æ•°ï¼Œç›¸å½“äº `k = +infinity`ï¼ˆæ­£æ— ç©·ï¼‰ï¼›ç¬¬ä¸‰é¢˜æ˜¯åªè¿›è¡Œ 2 æ¬¡äº¤æ˜“ï¼Œç›¸å½“äº `k = 2`ï¼›å‰©ä¸‹ä¸¤é“ä¹Ÿæ˜¯ä¸é™æ¬¡æ•°ï¼Œä½†æ˜¯åŠ äº†äº¤æ˜“ã€Œå†·å†»æœŸã€å’Œã€Œæ‰‹ç»­è´¹ã€çš„é¢å¤–æ¡ä»¶ï¼Œå…¶å®å°±æ˜¯ç¬¬äºŒé¢˜çš„å˜ç§ï¼Œéƒ½å¾ˆå®¹æ˜“å¤„ç†ã€‚

### ç©·ä¸¾æ¡†æ¶

åŠ¨æ€è§„åˆ’ç®—æ³•æœ¬è´¨ä¸Šå°±æ˜¯ç©·ä¸¾ã€ŒçŠ¶æ€ã€ï¼Œç„¶ååœ¨ã€Œé€‰æ‹©ã€ä¸­é€‰æ‹©æœ€ä¼˜è§£ã€‚

é‚£ä¹ˆå¯¹äºè¿™é“é¢˜ï¼Œæˆ‘ä»¬å…·ä½“åˆ°æ¯ä¸€å¤©ï¼Œçœ‹çœ‹æ€»å…±æœ‰å‡ ç§å¯èƒ½çš„ã€ŒçŠ¶æ€ã€ï¼Œå†æ‰¾å‡ºæ¯ä¸ªã€ŒçŠ¶æ€ã€å¯¹åº”çš„ã€Œé€‰æ‹©ã€ã€‚æˆ‘ä»¬è¦ç©·ä¸¾æ‰€æœ‰ã€ŒçŠ¶æ€ã€ï¼Œç©·ä¸¾çš„ç›®çš„æ˜¯æ ¹æ®å¯¹åº”çš„ã€Œé€‰æ‹©ã€æ›´æ–°çŠ¶æ€ã€‚å¬èµ·æ¥æŠ½è±¡ï¼Œä½ åªè¦è®°ä½ã€ŒçŠ¶æ€ã€å’Œã€Œé€‰æ‹©ã€ä¸¤ä¸ªè¯å°±è¡Œï¼Œä¸‹é¢å®æ“ä¸€ä¸‹å°±å¾ˆå®¹æ˜“æ˜ç™½äº†ã€‚

```python
for çŠ¶æ€1 in çŠ¶æ€1çš„æ‰€æœ‰å–å€¼ï¼š
    for çŠ¶æ€2 in çŠ¶æ€2çš„æ‰€æœ‰å–å€¼ï¼š
        for ...
            dp[çŠ¶æ€1][çŠ¶æ€2][...] = æ‹©ä¼˜(é€‰æ‹©1ï¼Œé€‰æ‹©2...)
```

æ¯”å¦‚è¯´è¿™ä¸ªé—®é¢˜ï¼Œ**æ¯å¤©éƒ½æœ‰ä¸‰ç§ã€Œé€‰æ‹©ã€**ï¼šä¹°å…¥ã€å–å‡ºã€æ— æ“ä½œï¼Œæˆ‘ä»¬ç”¨ `buy`, `sell`, `rest` è¡¨ç¤ºè¿™ä¸‰ç§é€‰æ‹©ã€‚

ä½†é—®é¢˜æ˜¯ï¼Œå¹¶ä¸æ˜¯æ¯å¤©éƒ½å¯ä»¥ä»»æ„é€‰æ‹©è¿™ä¸‰ç§é€‰æ‹©çš„ï¼Œå› ä¸º `sell` å¿…é¡»åœ¨ `buy` ä¹‹åï¼Œ`buy` å¿…é¡»åœ¨ `sell` ä¹‹åã€‚é‚£ä¹ˆ `rest` æ“ä½œè¿˜åº”è¯¥åˆ†ä¸¤ç§çŠ¶æ€ï¼Œä¸€ç§æ˜¯ `buy` ä¹‹åçš„ `rest`ï¼ˆæŒæœ‰äº†è‚¡ç¥¨ï¼‰ï¼Œä¸€ç§æ˜¯ `sell` ä¹‹åçš„ `rest`ï¼ˆæ²¡æœ‰æŒæœ‰è‚¡ç¥¨ï¼‰ã€‚è€Œä¸”åˆ«å¿˜äº†ï¼Œæˆ‘ä»¬è¿˜æœ‰äº¤æ˜“æ¬¡æ•° `k` çš„é™åˆ¶ï¼Œå°±æ˜¯è¯´ä½  `buy` è¿˜åªèƒ½åœ¨ `k > 0` çš„å‰æä¸‹æ“ä½œã€‚

> æœ¬æ–‡ä¼šé¢‘ç¹ä½¿ç”¨ã€Œäº¤æ˜“ã€è¿™ä¸ªè¯ï¼Œ**æˆ‘ä»¬æŠŠä¸€æ¬¡ä¹°å…¥å’Œä¸€æ¬¡å–å‡ºå®šä¹‰ä¸ºä¸€æ¬¡ã€Œäº¤æ˜“ã€**ã€‚

å¾ˆå¤æ‚å¯¹å§ï¼Œä¸è¦æ€•ï¼Œæˆ‘ä»¬ç°åœ¨çš„ç›®çš„åªæ˜¯ç©·ä¸¾ï¼Œä½ æœ‰å†å¤šçš„çŠ¶æ€ï¼Œè€å¤«è¦åšçš„å°±æ˜¯ä¸€æŠŠæ¢­å…¨éƒ¨åˆ—ä¸¾å‡ºæ¥ã€‚

**è¿™ä¸ªé—®é¢˜çš„ã€ŒçŠ¶æ€ã€æœ‰ä¸‰ä¸ª**ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¤©æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯å…è®¸äº¤æ˜“çš„æœ€å¤§æ¬¡æ•°ï¼Œç¬¬ä¸‰ä¸ªæ˜¯å½“å‰çš„æŒæœ‰çŠ¶æ€ï¼ˆå³ä¹‹å‰è¯´çš„ `rest` çš„çŠ¶æ€ï¼Œæˆ‘ä»¬ä¸å¦¨ç”¨ 1 è¡¨ç¤ºæŒæœ‰ï¼Œ0 è¡¨ç¤ºæ²¡æœ‰æŒæœ‰ï¼‰ã€‚ç„¶åæˆ‘ä»¬ç”¨ä¸€ä¸ªä¸‰ç»´æ•°ç»„å°±å¯ä»¥è£…ä¸‹è¿™å‡ ç§çŠ¶æ€çš„å…¨éƒ¨ç»„åˆï¼š

```python
dp[i][k][0 or 1]
0 <= i <= n - 1, 1 <= k <= K
n ä¸ºå¤©æ•°ï¼Œå¤§ K ä¸ºäº¤æ˜“æ•°çš„ä¸Šé™ï¼Œ0 å’Œ 1 ä»£è¡¨æ˜¯å¦æŒæœ‰è‚¡ç¥¨ã€‚
æ­¤é—®é¢˜å…± n Ã— K Ã— 2 ç§çŠ¶æ€ï¼Œå…¨éƒ¨ç©·ä¸¾å°±èƒ½æå®šã€‚

for 0 <= i < n:
    for 1 <= k <= K:
        for s in {0, 1}:
            dp[i][k][s] = max(buy, sell, rest)
```

è€Œä¸”æˆ‘ä»¬å¯ä»¥ç”¨è‡ªç„¶è¯­è¨€æè¿°å‡ºæ¯ä¸€ä¸ªçŠ¶æ€çš„å«ä¹‰ï¼Œæ¯”å¦‚è¯´ `dp[3][2][1]` çš„å«ä¹‰å°±æ˜¯ï¼šä»Šå¤©æ˜¯ç¬¬ä¸‰å¤©ï¼Œæˆ‘ç°åœ¨æ‰‹ä¸ŠæŒæœ‰ç€è‚¡ç¥¨ï¼Œè‡³ä»Šæœ€å¤šè¿›è¡Œ 2 æ¬¡äº¤æ˜“ã€‚å†æ¯”å¦‚ `dp[2][3][0]` çš„å«ä¹‰ï¼šä»Šå¤©æ˜¯ç¬¬äºŒå¤©ï¼Œæˆ‘ç°åœ¨æ‰‹ä¸Šæ²¡æœ‰æŒæœ‰è‚¡ç¥¨ï¼Œè‡³ä»Šæœ€å¤šè¿›è¡Œ 3 æ¬¡äº¤æ˜“ã€‚å¾ˆå®¹æ˜“ç†è§£ï¼Œå¯¹å§ï¼Ÿ

æˆ‘ä»¬æƒ³æ±‚çš„æœ€ç»ˆç­”æ¡ˆæ˜¯ `dp[n - 1][K][0]`ï¼Œå³æœ€åä¸€å¤©ï¼Œæœ€å¤šå…è®¸ `K` æ¬¡äº¤æ˜“ï¼Œæœ€å¤šè·å¾—å¤šå°‘åˆ©æ¶¦ã€‚

è¯»è€…å¯èƒ½é—®ä¸ºä»€ä¹ˆä¸æ˜¯ `dp[n - 1][K][1]`ï¼Ÿå› ä¸º `dp[n - 1][K][1]` ä»£è¡¨åˆ°æœ€åä¸€å¤©æ‰‹ä¸Šè¿˜æŒæœ‰è‚¡ç¥¨ï¼Œ`dp[n - 1][K][0]` è¡¨ç¤ºæœ€åä¸€å¤©æ‰‹ä¸Šçš„è‚¡ç¥¨å·²ç»å–å‡ºå»äº†ï¼Œå¾ˆæ˜¾ç„¶åè€…å¾—åˆ°çš„åˆ©æ¶¦ä¸€å®šå¤§äºå‰è€…ã€‚

è®°ä½å¦‚ä½•è§£é‡Šã€ŒçŠ¶æ€ã€ï¼Œä¸€æ—¦ä½ è§‰å¾—å“ªé‡Œä¸å¥½ç†è§£ï¼ŒæŠŠå®ƒç¿»è¯‘æˆè‡ªç„¶è¯­è¨€å°±å®¹æ˜“ç†è§£äº†ã€‚

### çŠ¶æ€è½¬ç§»æ¡†æ¶



ç°åœ¨ï¼Œæˆ‘ä»¬å®Œæˆäº†ã€ŒçŠ¶æ€ã€çš„ç©·ä¸¾ï¼Œæˆ‘ä»¬å¼€å§‹æ€è€ƒæ¯ç§ã€ŒçŠ¶æ€ã€æœ‰å“ªäº›ã€Œé€‰æ‹©ã€ï¼Œåº”è¯¥å¦‚ä½•æ›´æ–°ã€ŒçŠ¶æ€ã€ã€‚

åªçœ‹ã€ŒæŒæœ‰çŠ¶æ€ã€ï¼Œå¯ä»¥ç”»ä¸ªçŠ¶æ€è½¬ç§»å›¾ï¼š

![img](https://labuladong.online/algo/images/%E8%82%A1%E7%A5%A8%E9%97%AE%E9%A2%98/1.png)

é€šè¿‡è¿™ä¸ªå›¾å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°ï¼Œæ¯ç§çŠ¶æ€ï¼ˆ0 å’Œ 1ï¼‰æ˜¯å¦‚ä½•è½¬ç§»è€Œæ¥çš„ã€‚æ ¹æ®è¿™ä¸ªå›¾ï¼Œæˆ‘ä»¬æ¥å†™ä¸€ä¸‹çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š

```cpp
dp[i][k][0] = max(dp[i-1][k][0], dp[i-1][k][1] + prices[i])
            = max( ä»Šå¤©é€‰æ‹© rest,        ä»Šå¤©é€‰æ‹© sell       )
```

è§£é‡Šï¼šä»Šå¤©æˆ‘æ²¡æœ‰æŒæœ‰è‚¡ç¥¨ï¼Œæœ‰ä¸¤ç§å¯èƒ½ï¼Œæˆ‘ä»è¿™ä¸¤ç§å¯èƒ½ä¸­æ±‚æœ€å¤§åˆ©æ¶¦ï¼š

1ã€æˆ‘æ˜¨å¤©å°±æ²¡æœ‰æŒæœ‰ï¼Œä¸”æˆªè‡³æ˜¨å¤©æœ€å¤§äº¤æ˜“æ¬¡æ•°é™åˆ¶ä¸º `k`ï¼›ç„¶åæˆ‘ä»Šå¤©é€‰æ‹© `rest`ï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©è¿˜æ˜¯æ²¡æœ‰æŒæœ‰ï¼Œæœ€å¤§äº¤æ˜“æ¬¡æ•°é™åˆ¶ä¾ç„¶ä¸º `k`ã€‚

2ã€æˆ‘æ˜¨å¤©æŒæœ‰è‚¡ç¥¨ï¼Œä¸”æˆªè‡³æ˜¨å¤©æœ€å¤§äº¤æ˜“æ¬¡æ•°é™åˆ¶ä¸º `k`ï¼›ä½†æ˜¯ä»Šå¤©æˆ‘ `sell` äº†ï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©æ²¡æœ‰æŒæœ‰è‚¡ç¥¨äº†ï¼Œæœ€å¤§äº¤æ˜“æ¬¡æ•°é™åˆ¶ä¾ç„¶ä¸º `k`ã€‚

```cpp
dp[i][k][1] = max(dp[i-1][k][1], dp[i-1][k-1][0] - prices[i])
            = max( ä»Šå¤©é€‰æ‹© rest,        ä»Šå¤©é€‰æ‹© buy        )
```

è§£é‡Šï¼šä»Šå¤©æˆ‘æŒæœ‰ç€è‚¡ç¥¨ï¼Œæœ€å¤§äº¤æ˜“æ¬¡æ•°é™åˆ¶ä¸º `k`ï¼Œé‚£ä¹ˆå¯¹äºæ˜¨å¤©æ¥è¯´ï¼Œæœ‰ä¸¤ç§å¯èƒ½ï¼Œæˆ‘ä»è¿™ä¸¤ç§å¯èƒ½ä¸­æ±‚æœ€å¤§åˆ©æ¶¦ï¼š

1ã€æˆ‘æ˜¨å¤©å°±æŒæœ‰ç€è‚¡ç¥¨ï¼Œä¸”æˆªè‡³æ˜¨å¤©æœ€å¤§äº¤æ˜“æ¬¡æ•°é™åˆ¶ä¸º `k`ï¼›ç„¶åä»Šå¤©é€‰æ‹© `rest`ï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©è¿˜æŒæœ‰ç€è‚¡ç¥¨ï¼Œæœ€å¤§äº¤æ˜“æ¬¡æ•°é™åˆ¶ä¾ç„¶ä¸º `k`ã€‚

2ã€æˆ‘æ˜¨å¤©æœ¬æ²¡æœ‰æŒæœ‰ï¼Œä¸”æˆªè‡³æ˜¨å¤©æœ€å¤§äº¤æ˜“æ¬¡æ•°é™åˆ¶ä¸º `k - 1`ï¼›ä½†ä»Šå¤©æˆ‘é€‰æ‹© `buy`ï¼Œæ‰€ä»¥ä»Šå¤©æˆ‘å°±æŒæœ‰è‚¡ç¥¨äº†ï¼Œæœ€å¤§äº¤æ˜“æ¬¡æ•°é™åˆ¶ä¸º `k`ã€‚

> è¿™é‡Œç€é‡æé†’ä¸€ä¸‹ï¼Œ**æ—¶åˆ»ç‰¢è®°ã€ŒçŠ¶æ€ã€çš„å®šä¹‰**ï¼ŒçŠ¶æ€ `k` çš„å®šä¹‰å¹¶ä¸æ˜¯ã€Œå·²è¿›è¡Œçš„äº¤æ˜“æ¬¡æ•°ã€ï¼Œè€Œæ˜¯ã€Œæœ€å¤§äº¤æ˜“æ¬¡æ•°çš„ä¸Šé™é™åˆ¶ã€ã€‚å¦‚æœç¡®å®šä»Šå¤©è¿›è¡Œä¸€æ¬¡äº¤æ˜“ï¼Œä¸”è¦ä¿è¯æˆªè‡³ä»Šå¤©æœ€å¤§äº¤æ˜“æ¬¡æ•°ä¸Šé™ä¸º `k`ï¼Œé‚£ä¹ˆæ˜¨å¤©çš„æœ€å¤§äº¤æ˜“æ¬¡æ•°ä¸Šé™å¿…é¡»æ˜¯ `k - 1`ã€‚ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œæ¯”æ–¹è¯´è¦æ±‚ä½ çš„é“¶è¡Œå¡é‡Œä»Šå¤©è‡³å°‘æœ‰ 100 å—é’±ï¼Œä¸”ä½ ç¡®å®šä½ ä»Šå¤©å¯ä»¥èµš 10 å—é’±ï¼Œé‚£ä¹ˆä½ å°±è¦ä¿è¯æ˜¨å¤©çš„é“¶è¡Œå¡è¦è‡³å°‘å‰©ä¸‹ 90 å—é’±ã€‚

è¿™ä¸ªè§£é‡Šåº”è¯¥å¾ˆæ¸…æ¥šäº†ï¼Œå¦‚æœ `buy`ï¼Œå°±è¦ä»åˆ©æ¶¦ä¸­å‡å» `prices[i]`ï¼Œå¦‚æœ `sell`ï¼Œå°±è¦ç»™åˆ©æ¶¦å¢åŠ  `prices[i]`ã€‚ä»Šå¤©çš„æœ€å¤§åˆ©æ¶¦å°±æ˜¯è¿™ä¸¤ç§å¯èƒ½é€‰æ‹©ä¸­è¾ƒå¤§çš„é‚£ä¸ªã€‚

æ³¨æ„ `k` çš„é™åˆ¶ï¼Œåœ¨é€‰æ‹© `buy` çš„æ—¶å€™ç›¸å½“äºå¼€å¯äº†ä¸€æ¬¡äº¤æ˜“ï¼Œé‚£ä¹ˆå¯¹äºæ˜¨å¤©æ¥è¯´ï¼Œäº¤æ˜“æ¬¡æ•°çš„ä¸Šé™ `k` åº”è¯¥å‡å° 1ã€‚

> è¿™é‡Œè¡¥å……ä¿®æ­£ä¸€ç‚¹ï¼Œä»¥å‰æˆ‘ä»¥ä¸ºåœ¨ `sell` çš„æ—¶å€™ç»™ `k` å‡å° 1 å’Œåœ¨ `buy` çš„æ—¶å€™ç»™ `k` å‡å° 1 æ˜¯ç­‰æ•ˆçš„ï¼Œä½†ç»†å¿ƒçš„è¯»è€…å‘æˆ‘æå‡ºè´¨ç–‘ï¼Œç»è¿‡æ·±å…¥æ€è€ƒæˆ‘å‘ç°å‰è€…ç¡®å®æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºäº¤æ˜“æ˜¯ä» `buy` å¼€å§‹ï¼Œå¦‚æœ `buy` çš„é€‰æ‹©ä¸æ”¹å˜äº¤æ˜“æ¬¡æ•° `k` çš„è¯ï¼Œä¼šå‡ºç°äº¤æ˜“æ¬¡æ•°è¶…å‡ºé™åˆ¶çš„çš„é”™è¯¯ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†åŠ¨æ€è§„åˆ’ä¸­æœ€å›°éš¾çš„ä¸€æ­¥ï¼šçŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚**å¦‚æœä¹‹å‰çš„å†…å®¹ä½ éƒ½å¯ä»¥ç†è§£ï¼Œé‚£ä¹ˆä½ å·²ç»å¯ä»¥ç§’æ€æ‰€æœ‰é—®é¢˜äº†ï¼Œåªè¦å¥—è¿™ä¸ªæ¡†æ¶å°±è¡Œäº†**ã€‚ä¸è¿‡è¿˜å·®æœ€åä¸€ç‚¹ç‚¹ï¼Œå°±æ˜¯å®šä¹‰ base caseï¼Œå³æœ€ç®€å•çš„æƒ…å†µã€‚

```cpp
dp[-1][...][0] = 0
è§£é‡Šï¼šå› ä¸º i æ˜¯ä» 0 å¼€å§‹çš„ï¼Œæ‰€ä»¥ i = -1 æ„å‘³ç€è¿˜æ²¡æœ‰å¼€å§‹ï¼Œè¿™æ—¶å€™çš„åˆ©æ¶¦å½“ç„¶æ˜¯ 0ã€‚

dp[-1][...][1] = -infinity
è§£é‡Šï¼šè¿˜æ²¡å¼€å§‹çš„æ—¶å€™ï¼Œæ˜¯ä¸å¯èƒ½æŒæœ‰è‚¡ç¥¨çš„ã€‚
å› ä¸ºæˆ‘ä»¬çš„ç®—æ³•è¦æ±‚ä¸€ä¸ªæœ€å¤§å€¼ï¼Œæ‰€ä»¥åˆå§‹å€¼è®¾ä¸ºä¸€ä¸ªæœ€å°å€¼ï¼Œæ–¹ä¾¿å–æœ€å¤§å€¼ã€‚

dp[...][0][0] = 0
è§£é‡Šï¼šå› ä¸º k æ˜¯ä» 1 å¼€å§‹çš„ï¼Œæ‰€ä»¥ k = 0 æ„å‘³ç€æ ¹æœ¬ä¸å…è®¸äº¤æ˜“ï¼Œè¿™æ—¶å€™åˆ©æ¶¦å½“ç„¶æ˜¯ 0ã€‚

dp[...][0][1] = -infinity
è§£é‡Šï¼šä¸å…è®¸äº¤æ˜“çš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸å¯èƒ½æŒæœ‰è‚¡ç¥¨çš„ã€‚
å› ä¸ºæˆ‘ä»¬çš„ç®—æ³•è¦æ±‚ä¸€ä¸ªæœ€å¤§å€¼ï¼Œæ‰€ä»¥åˆå§‹å€¼è®¾ä¸ºä¸€ä¸ªæœ€å°å€¼ï¼Œæ–¹ä¾¿å–æœ€å¤§å€¼ã€‚
```

æŠŠä¸Šé¢çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ€»ç»“ä¸€ä¸‹ï¼š

```cpp
base caseï¼š
dp[-1][...][0] = dp[...][0][0] = 0
dp[-1][...][1] = dp[...][0][1] = -infinity

çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š
dp[i][k][0] = max(dp[i-1][k][0], dp[i-1][k][1] + prices[i])
dp[i][k][1] = max(dp[i-1][k][1], dp[i-1][k-1][0] - prices[i])
```

è¯»è€…å¯èƒ½ä¼šé—®ï¼Œè¿™ä¸ªæ•°ç»„ç´¢å¼•æ˜¯ -1 æ€ä¹ˆç¼–ç¨‹è¡¨ç¤ºå‡ºæ¥å‘¢ï¼Œè´Ÿæ— ç©·æ€ä¹ˆè¡¨ç¤ºå‘¢ï¼Ÿè¿™éƒ½æ˜¯ç»†èŠ‚é—®é¢˜ï¼Œæœ‰å¾ˆå¤šæ–¹æ³•å®ç°ã€‚ç°åœ¨å®Œæ•´çš„æ¡†æ¶å·²ç»å®Œæˆï¼Œä¸‹é¢å¼€å§‹å…·ä½“åŒ–ã€‚

### å›¢ç­è‚¡ç¥¨

#### ç¬¬ä¸€é¢˜ï¼šç›¸å½“äº `k = 1` çš„æƒ…å†µ

> é¢˜ç›®

ç»™å®šä¸€ä¸ªæ•°ç»„ `prices` ï¼Œå®ƒçš„ç¬¬ `i` ä¸ªå…ƒç´  `prices[i]` è¡¨ç¤ºä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ `i` å¤©çš„ä»·æ ¼ã€‚

ä½ åªèƒ½é€‰æ‹© **æŸä¸€å¤©** ä¹°å…¥è¿™åªè‚¡ç¥¨ï¼Œå¹¶é€‰æ‹©åœ¨ **æœªæ¥çš„æŸä¸€ä¸ªä¸åŒçš„æ—¥å­** å–å‡ºè¯¥è‚¡ç¥¨ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚

è¿”å›ä½ å¯ä»¥ä»è¿™ç¬”äº¤æ˜“ä¸­è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚å¦‚æœä½ ä¸èƒ½è·å–ä»»ä½•åˆ©æ¶¦ï¼Œè¿”å› `0` ã€‚

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š[7,1,5,3,6,4]
è¾“å‡ºï¼š5
è§£é‡Šï¼šåœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡ºï¼Œæœ€å¤§åˆ©æ¶¦ = 6-1 = 5 ã€‚
     æ³¨æ„åˆ©æ¶¦ä¸èƒ½æ˜¯ 7-1 = 6, å› ä¸ºå–å‡ºä»·æ ¼éœ€è¦å¤§äºä¹°å…¥ä»·æ ¼ï¼›åŒæ—¶ï¼Œä½ ä¸èƒ½åœ¨ä¹°å…¥å‰å–å‡ºè‚¡ç¥¨ã€‚
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šprices = [7,6,4,3,1]
è¾“å‡ºï¼š0
è§£é‡Šï¼šåœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0ã€‚
```

**æç¤ºï¼š**

- `1 <= prices.length <= 105`
- `0 <= prices[i] <= 104`

> è§£å†³

ç›´æ¥å¥—çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œæ ¹æ® base caseï¼Œå¯ä»¥åšä¸€äº›åŒ–ç®€ï¼š

```cpp
dp[i][1][0] = max(dp[i-1][1][0], dp[i-1][1][1] + prices[i])
dp[i][1][1] = max(dp[i-1][1][1], dp[i-1][0][0] - prices[i]) 
            = max(dp[i-1][1][1], -prices[i])
è§£é‡Šï¼šk = 0 çš„ base caseï¼Œæ‰€ä»¥ dp[i-1][0][0] = 0ã€‚

ç°åœ¨å‘ç° k éƒ½æ˜¯ 1ï¼Œä¸ä¼šæ”¹å˜ï¼Œå³ k å¯¹çŠ¶æ€è½¬ç§»å·²ç»æ²¡æœ‰å½±å“äº†ã€‚
å¯ä»¥è¿›è¡Œè¿›ä¸€æ­¥åŒ–ç®€å»æ‰æ‰€æœ‰ kï¼š
dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])
dp[i][1] = max(dp[i-1][1], -prices[i])
```

```cpp
int n = prices.size();
vector<vector<int>> dp(n, vector<int>(2));
dp[0][0] = 0;
dp[0][1] = -prices[0];

for (int i = 1; i < n; ++i) {
    dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i]);
    dp[i][1] = max(dp[i-1][1], -prices[i]);
}

return dp[n-1][0];
```

æ˜¾ç„¶ `i = 0` æ—¶ `i - 1` æ˜¯ä¸åˆæ³•çš„ç´¢å¼•ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å¯¹ `i` çš„ base case è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥è¿™æ ·ç»™ä¸€ä¸ªç‰¹åŒ–å¤„ç†ï¼š

```cpp
if (i - 1 == -1) {
    dp[i][0] = 0;
    // æ ¹æ®çŠ¶æ€è½¬ç§»æ–¹ç¨‹å¯å¾—ï¼š
    //   dp[i][0] 
    // = max(dp[-1][0], dp[-1][1] + prices[i])
    // = max(0, -infinity + prices[i]) = 0

    dp[i][1] = -prices[i];
    // æ ¹æ®çŠ¶æ€è½¬ç§»æ–¹ç¨‹å¯å¾—ï¼š
    //   dp[i][1] 
    // = max(dp[-1][1], dp[-1][0] - prices[i])
    // = max(-infinity, 0 - prices[i]) 
    // = -prices[i]
    continue;
}
```

ç¬¬ä¸€é¢˜å°±è§£å†³äº†ï¼Œä½†æ˜¯è¿™æ ·å¤„ç† base case å¾ˆéº»çƒ¦ï¼Œè€Œä¸”æ³¨æ„ä¸€ä¸‹çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œæ–°çŠ¶æ€åªå’Œç›¸é‚»çš„ä¸€ä¸ªçŠ¶æ€æœ‰å…³ï¼Œä¸éœ€è¦ç”¨æ•´ä¸ª `dp` æ•°ç»„ï¼Œåªéœ€è¦ä¸€ä¸ªå˜é‡å‚¨å­˜ç›¸é‚»çš„é‚£ä¸ªçŠ¶æ€å°±è¶³å¤Ÿäº†ï¼Œè¿™æ ·å¯ä»¥æŠŠç©ºé—´å¤æ‚åº¦é™åˆ° O(1):

```cpp
// ç©ºé—´å¤æ‚åº¦ä¼˜åŒ–ç‰ˆæœ¬
int maxProfit_k_1(vector<int>& prices) {
    int n = prices.size();
    // base case: dp[-1][0] = 0, dp[-1][1] = -infinity
    int dp_i_0 = 0, dp_i_1 = INT_MIN;
    for (int i = 0; i < n; i++) {
        // dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])
        dp_i_0 = max(dp_i_0, dp_i_1 + prices[i]);
        // dp[i][1] = max(dp[i-1][1], -prices[i])
        dp_i_1 = max(dp_i_1, -prices[i]);
    }
    return dp_i_0;

```

#### ç¬¬äºŒé¢˜ï¼š`k` ä¸ºæ­£æ— ç©·çš„æƒ…å†µ

> é¢˜ç›®

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `prices` ï¼Œå…¶ä¸­ `prices[i]` è¡¨ç¤ºæŸæ”¯è‚¡ç¥¨ç¬¬ `i` å¤©çš„ä»·æ ¼ã€‚

åœ¨æ¯ä¸€å¤©ï¼Œä½ å¯ä»¥å†³å®šæ˜¯å¦è´­ä¹°å’Œ/æˆ–å‡ºå”®è‚¡ç¥¨ã€‚ä½ åœ¨ä»»ä½•æ—¶å€™ **æœ€å¤š** åªèƒ½æŒæœ‰ **ä¸€è‚¡** è‚¡ç¥¨ã€‚ä½ ä¹Ÿå¯ä»¥å…ˆè´­ä¹°ï¼Œç„¶ååœ¨ **åŒä¸€å¤©** å‡ºå”®ã€‚

è¿”å› *ä½ èƒ½è·å¾—çš„ **æœ€å¤§** åˆ©æ¶¦* ã€‚

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼šprices = [7,1,5,3,6,4]
è¾“å‡ºï¼š7
è§£é‡Šï¼šåœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5 - 1 = 4 ã€‚
     éšåï¼Œåœ¨ç¬¬ 4 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 3ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 6 - 3 = 3 ã€‚
     æ€»åˆ©æ¶¦ä¸º 4 + 3 = 7 ã€‚
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šprices = [1,2,3,4,5]
è¾“å‡ºï¼š4
è§£é‡Šï¼šåœ¨ç¬¬ 1 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤© ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5 - 1 = 4 ã€‚
     æ€»åˆ©æ¶¦ä¸º 4 ã€‚
```

**ç¤ºä¾‹ 3ï¼š**

```
è¾“å…¥ï¼šprices = [7,6,4,3,1]
è¾“å‡ºï¼š0
è§£é‡Šï¼šåœ¨è¿™ç§æƒ…å†µä¸‹, äº¤æ˜“æ— æ³•è·å¾—æ­£åˆ©æ¶¦ï¼Œæ‰€ä»¥ä¸å‚ä¸äº¤æ˜“å¯ä»¥è·å¾—æœ€å¤§åˆ©æ¶¦ï¼Œæœ€å¤§åˆ©æ¶¦ä¸º 0 ã€‚
```

**æç¤ºï¼š**

- `1 <= prices.length <= 3 * 104`
- `0 <= prices[i] <= 104`

> è§£å†³

é¢˜ç›®è¿˜ä¸“é—¨å¼ºè°ƒå¯ä»¥åœ¨åŒä¸€å¤©å‡ºå”®ï¼Œä½†æˆ‘è§‰å¾—è¿™ä¸ªæ¡ä»¶çº¯å±å¤šä½™ï¼Œå¦‚æœå½“å¤©ä¹°å½“å¤©å–ï¼Œé‚£åˆ©æ¶¦å½“ç„¶å°±æ˜¯ 0ï¼Œè¿™ä¸æ˜¯å’Œæ²¡æœ‰è¿›è¡Œäº¤æ˜“æ˜¯ä¸€æ ·çš„å—ï¼Ÿè¿™é“é¢˜çš„ç‰¹ç‚¹åœ¨äºæ²¡æœ‰ç»™å‡ºäº¤æ˜“æ€»æ•° `k` çš„é™åˆ¶ï¼Œä¹Ÿå°±ç›¸å½“äº `k` ä¸ºæ­£æ— ç©·ã€‚

å¦‚æœ `k` ä¸ºæ­£æ— ç©·ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¤ä¸º `k` å’Œ `k - 1` æ˜¯ä¸€æ ·çš„ã€‚å¯ä»¥è¿™æ ·æ”¹å†™æ¡†æ¶ï¼š

```cpp
dp[i][k][0] = max(dp[i-1][k][0], dp[i-1][k][1] + prices[i])
dp[i][k][1] = max(dp[i-1][k][1], dp[i-1][k-1][0] - prices[i])
            = max(dp[i-1][k][1], dp[i-1][k][0] - prices[i])

æˆ‘ä»¬å‘ç°æ•°ç»„ä¸­çš„ k å·²ç»ä¸ä¼šæ”¹å˜äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸éœ€è¦è®°å½• k è¿™ä¸ªçŠ¶æ€äº†ï¼š
dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])
dp[i][1] = max(dp[i-1][1], dp[i-1][0] - prices[i])
```

ç›´æ¥ç¿»è¯‘æˆä»£ç ï¼š

```cpp
// åŸå§‹ç‰ˆæœ¬
int maxProfit_k_inf(vector<int>& prices) {
    int n = prices.size();
    vector<vector<int>> dp(n, vector<int>(2, 0));
    for (int i = 0; i < n; i++) {
        if (i - 1 == -1) {
            // base case
            dp[i][0] = 0;
            dp[i][1] = -prices[i];
            continue;
        }
        dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i]);
        dp[i][1] = max(dp[i-1][1], dp[i-1][0] - prices[i]);
    }
    return dp[n - 1][0];
}

// ç©ºé—´å¤æ‚åº¦ä¼˜åŒ–ç‰ˆæœ¬
int maxProfit_k_inf(vector<int>& prices) {
    int n = prices.size();
    int dp_i_0 = 0, dp_i_1 = INT_MIN;
    for (int i = 0; i < n; i++) {
        int temp = dp_i_0;
        dp_i_0 = max(dp_i_0, dp_i_1 + prices[i]);
        dp_i_1 = max(dp_i_1, temp - prices[i]);
    }
    return dp_i_0;
}
```

#### ç¬¬ä¸‰é¢˜ï¼š `k` ä¸ºæ­£æ— ç©·ï¼Œä½†å«æœ‰äº¤æ˜“å†·å†»æœŸçš„æƒ…å†µ

> é¢˜ç›®

ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„`prices`ï¼Œå…¶ä¸­ç¬¬ `prices[i]` è¡¨ç¤ºç¬¬ `*i*` å¤©çš„è‚¡ç¥¨ä»·æ ¼ ã€‚

è®¾è®¡ä¸€ä¸ªç®—æ³•è®¡ç®—å‡ºæœ€å¤§åˆ©æ¶¦ã€‚åœ¨æ»¡è¶³ä»¥ä¸‹çº¦æŸæ¡ä»¶ä¸‹ï¼Œä½ å¯ä»¥å°½å¯èƒ½åœ°å®Œæˆæ›´å¤šçš„äº¤æ˜“ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰:

- å–å‡ºè‚¡ç¥¨åï¼Œä½ æ— æ³•åœ¨ç¬¬äºŒå¤©ä¹°å…¥è‚¡ç¥¨ (å³å†·å†»æœŸä¸º 1 å¤©)ã€‚

**æ³¨æ„ï¼š**ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚

**ç¤ºä¾‹ 1:**

```
è¾“å…¥: prices = [1,2,3,0,2]
è¾“å‡º: 3 
è§£é‡Š: å¯¹åº”çš„äº¤æ˜“çŠ¶æ€ä¸º: [ä¹°å…¥, å–å‡º, å†·å†»æœŸ, ä¹°å…¥, å–å‡º]
```

**ç¤ºä¾‹ 2:**

```
è¾“å…¥: prices = [1]
è¾“å‡º: 0
```

**æç¤ºï¼š**

- `1 <= prices.length <= 5000`
- `0 <= prices[i] <= 1000`

> è§£å†³

å’Œä¸Šä¸€é“é¢˜ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ¯æ¬¡ `sell` ä¹‹åè¦ç­‰ä¸€å¤©æ‰èƒ½ç»§ç»­äº¤æ˜“ï¼Œåªè¦æŠŠè¿™ä¸ªç‰¹ç‚¹èå…¥ä¸Šä¸€é¢˜çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹å³å¯ï¼š

```cpp
dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])
dp[i][1] = max(dp[i-1][1], dp[i-2][0] - prices[i])
è§£é‡Šï¼šç¬¬ i å¤©é€‰æ‹© buy çš„æ—¶å€™ï¼Œè¦ä» i-2 çš„çŠ¶æ€è½¬ç§»ï¼Œè€Œä¸æ˜¯ i-1 ã€‚
```

```cpp
// åŸå§‹ç‰ˆæœ¬
int maxProfit_with_cool(vector<int>& prices) {
    int n = prices.size();
    vector<vector<int>> dp(n, vector<int>(2));
    for (int i = 0; i < n; i++) {
        if (i - 1 == -1) {
            // base case 1
            dp[i][0] = 0;
            dp[i][1] = -prices[i];
            continue;
        }
        if (i - 2 == -1) {
            // base case 2
            dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i]);
            // i - 2 å°äº 0 æ—¶æ ¹æ®çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ¨å‡ºå¯¹åº” base case
            dp[i][1] = max(dp[i-1][1], -prices[i]);
            //   dp[i][1] 
            // = max(dp[i-1][1], dp[-1][0] - prices[i])
            // = max(dp[i-1][1], 0 - prices[i])
            // = max(dp[i-1][1], -prices[i])
            continue;
        }
        dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i]);
        dp[i][1] = max(dp[i-1][1], dp[i-2][0] - prices[i]);
    }
    return dp[n - 1][0];
}

// ç©ºé—´å¤æ‚åº¦ä¼˜åŒ–ç‰ˆæœ¬
int maxProfit_with_cool(vector<int>& prices) {
    int n = prices.size();
    int dp_i_0 = 0, dp_i_1 = INT_MIN;
    int dp_pre_0 = 0; // ä»£è¡¨ dp[i-2][0]
    for (int i = 0; i < n; i++) {
        int temp = dp_i_0;
        dp_i_0 = max(dp_i_0, dp_i_1 + prices[i]);
        dp_i_1 = max(dp_i_1, dp_pre_0 - prices[i]);
        dp_pre_0 = temp;
    }
    return dp_i_0;
}
```

#### ç¬¬å››é¢˜ï¼š `k` ä¸ºæ­£æ— ç©·ä¸”è€ƒè™‘äº¤æ˜“æ‰‹ç»­è´¹çš„æƒ…å†µ

> é¢˜ç›®

ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `prices`ï¼Œå…¶ä¸­ `prices[i]`è¡¨ç¤ºç¬¬ `i` å¤©çš„è‚¡ç¥¨ä»·æ ¼ ï¼›æ•´æ•° `fee` ä»£è¡¨äº†äº¤æ˜“è‚¡ç¥¨çš„æ‰‹ç»­è´¹ç”¨ã€‚

ä½ å¯ä»¥æ— é™æ¬¡åœ°å®Œæˆäº¤æ˜“ï¼Œä½†æ˜¯ä½ æ¯ç¬”äº¤æ˜“éƒ½éœ€è¦ä»˜æ‰‹ç»­è´¹ã€‚å¦‚æœä½ å·²ç»è´­ä¹°äº†ä¸€ä¸ªè‚¡ç¥¨ï¼Œåœ¨å–å‡ºå®ƒä¹‹å‰ä½ å°±ä¸èƒ½å†ç»§ç»­è´­ä¹°è‚¡ç¥¨äº†ã€‚

è¿”å›è·å¾—åˆ©æ¶¦çš„æœ€å¤§å€¼ã€‚

**æ³¨æ„ï¼š**è¿™é‡Œçš„ä¸€ç¬”äº¤æ˜“æŒ‡ä¹°å…¥æŒæœ‰å¹¶å–å‡ºè‚¡ç¥¨çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œæ¯ç¬”äº¤æ˜“ä½ åªéœ€è¦ä¸ºæ”¯ä»˜ä¸€æ¬¡æ‰‹ç»­è´¹ã€‚

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼šprices = [1, 3, 2, 8, 4, 9], fee = 2
è¾“å‡ºï¼š8
è§£é‡Šï¼šèƒ½å¤Ÿè¾¾åˆ°çš„æœ€å¤§åˆ©æ¶¦:  
åœ¨æ­¤å¤„ä¹°å…¥ prices[0] = 1
åœ¨æ­¤å¤„å–å‡º prices[3] = 8
åœ¨æ­¤å¤„ä¹°å…¥ prices[4] = 4
åœ¨æ­¤å¤„å–å‡º prices[5] = 9
æ€»åˆ©æ¶¦: ((8 - 1) - 2) + ((9 - 4) - 2) = 8
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šprices = [1,3,7,5,10,3], fee = 3
è¾“å‡ºï¼š6
```

**æç¤ºï¼š**

- `1 <= prices.length <= 5 * 104`
- `1 <= prices[i] < 5 * 104`
- `0 <= fee < 5 * 104`

> è§£å†³

æ¯æ¬¡äº¤æ˜“è¦æ”¯ä»˜æ‰‹ç»­è´¹ï¼Œåªè¦æŠŠæ‰‹ç»­è´¹ä»åˆ©æ¶¦ä¸­å‡å»å³å¯ï¼Œæ”¹å†™æ–¹ç¨‹ï¼š

```cpp
dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])
dp[i][1] = max(dp[i-1][1], dp[i-1][0] - prices[i] - fee)
è§£é‡Šï¼šç›¸å½“äºä¹°å…¥è‚¡ç¥¨çš„ä»·æ ¼å‡é«˜äº†ã€‚
åœ¨ç¬¬ä¸€ä¸ªå¼å­é‡Œå‡ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œç›¸å½“äºå–å‡ºè‚¡ç¥¨çš„ä»·æ ¼å‡å°äº†ã€‚
```

> å¦‚æœç›´æ¥æŠŠ `fee` æ”¾åœ¨ç¬¬ä¸€ä¸ªå¼å­é‡Œå‡ï¼Œä¼šæœ‰ä¸€äº›æµ‹è¯•ç”¨ä¾‹æ— æ³•é€šè¿‡ï¼Œé”™è¯¯åŸå› æ˜¯æ•´å‹æº¢å‡ºè€Œä¸æ˜¯æ€è·¯é—®é¢˜ã€‚ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯æŠŠä»£ç ä¸­çš„ `int` ç±»å‹éƒ½æ”¹æˆ `long` ç±»å‹ï¼Œé¿å… `int` çš„æ•´å‹æº¢å‡ºã€‚

```cpp
// åŸå§‹ç‰ˆæœ¬
int maxProfit_with_fee(vector<int>& prices, int fee) {
    int n = prices.size();
    vector<vector<int>> dp(n, vector<int>(2));
    for (int i = 0; i < n; i++) {
        if (i - 1 == -1) {
            // base case
            dp[i][0] = 0;
            dp[i][1] = -prices[i] - fee;
            //   dp[i][1]
            // = max(dp[i - 1][1], dp[i - 1][0] - prices[i] - fee)
            // = max(dp[-1][1], dp[-1][0] - prices[i] - fee)
            // = max(-inf, 0 - prices[i] - fee)
            // = -prices[i] - fee
            continue;
        }
        dp[i][0] = max(dp[i - 1][0], dp[i - 1][1] + prices[i]);
        dp[i][1] = max(dp[i - 1][1], dp[i - 1][0] - prices[i] - fee);
    }
    return dp[n - 1][0];
}

// ç©ºé—´å¤æ‚åº¦ä¼˜åŒ–ç‰ˆæœ¬
int maxProfit_with_fee(vector<int>& prices, int fee) {
    int n = prices.size();
    int dp_i_0 = 0, dp_i_1 = INT_MIN;
    for (int i = 0; i < n; i++) {
        int temp = dp_i_0;
        dp_i_0 = max(dp_i_0, dp_i_1 + prices[i]);
        dp_i_1 = max(dp_i_1, temp - prices[i] - fee);
    }
    return dp_i_0;
}
```

#### ç¬¬äº”é¢˜ï¼š`k = 2` çš„æƒ…å†µ

> é¢˜ç›®

ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ç¬¬ `i` ä¸ªå…ƒç´ æ˜¯ä¸€æ”¯ç»™å®šçš„è‚¡ç¥¨åœ¨ç¬¬ `i` å¤©çš„ä»·æ ¼ã€‚

è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ æœ€å¤šå¯ä»¥å®Œæˆ **ä¸¤ç¬”** äº¤æ˜“ã€‚

**æ³¨æ„ï¼š**ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚

**ç¤ºä¾‹ 1:**

```
è¾“å…¥ï¼šprices = [3,3,5,0,0,3,1,4]
è¾“å‡ºï¼š6
è§£é‡Šï¼šåœ¨ç¬¬ 4 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 0ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 6 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 3ï¼‰çš„æ—¶å€™å–å‡ºï¼Œè¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 3-0 = 3 ã€‚
     éšåï¼Œåœ¨ç¬¬ 7 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 8 å¤© ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 4ï¼‰çš„æ—¶å€™å–å‡ºï¼Œè¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 4-1 = 3 ã€‚
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šprices = [1,2,3,4,5]
è¾“å‡ºï¼š4
è§£é‡Šï¼šåœ¨ç¬¬ 1 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤© ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5-1 = 4 ã€‚   
     æ³¨æ„ä½ ä¸èƒ½åœ¨ç¬¬ 1 å¤©å’Œç¬¬ 2 å¤©æ¥è¿è´­ä¹°è‚¡ç¥¨ï¼Œä¹‹åå†å°†å®ƒä»¬å–å‡ºã€‚   
     å› ä¸ºè¿™æ ·å±äºåŒæ—¶å‚ä¸äº†å¤šç¬”äº¤æ˜“ï¼Œä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ã€‚
```

**ç¤ºä¾‹ 3ï¼š**

```
è¾“å…¥ï¼šprices = [7,6,4,3,1] 
è¾“å‡ºï¼š0 
è§£é‡Šï¼šåœ¨è¿™ä¸ªæƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0ã€‚
```

**ç¤ºä¾‹ 4ï¼š**

```
è¾“å…¥ï¼šprices = [1]
è¾“å‡ºï¼š0
```

**æç¤ºï¼š**

- `1 <= prices.length <= 105`
- `0 <= prices[i] <= 105`

> è§£å†³

`k = 2` å’Œå‰é¢é¢˜ç›®çš„æƒ…å†µç¨å¾®ä¸åŒï¼Œå› ä¸ºä¸Šé¢çš„æƒ…å†µéƒ½å’Œ `k` çš„å…³ç³»ä¸å¤ªå¤§ï¼šè¦ä¹ˆ `k` æ˜¯æ­£æ— ç©·ï¼ŒçŠ¶æ€è½¬ç§»å’Œ `k` æ²¡å…³ç³»äº†ï¼›è¦ä¹ˆ `k = 1`ï¼Œè·Ÿ `k = 0` è¿™ä¸ª base case æŒ¨å¾—è¿‘ï¼Œæœ€åä¹Ÿæ²¡æœ‰å­˜åœ¨æ„Ÿã€‚

è¿™é“é¢˜ `k = 2` å’Œåé¢è¦è®²çš„ `k` æ˜¯ä»»æ„æ­£æ•´æ•°çš„æƒ…å†µä¸­ï¼Œå¯¹ `k` çš„å¤„ç†å°±å‡¸æ˜¾å‡ºæ¥äº†ï¼Œæˆ‘ä»¬ç›´æ¥å†™ä»£ç ï¼Œè¾¹å†™è¾¹åˆ†æåŸå› ã€‚

```cpp
åŸå§‹çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œæ²¡æœ‰å¯åŒ–ç®€çš„åœ°æ–¹
dp[i][k][0] = max(dp[i-1][k][0], dp[i-1][k][1] + prices[i])
dp[i][k][1] = max(dp[i-1][k][1], dp[i-1][k-1][0] - prices[i])
```

æŒ‰ç…§ä¹‹å‰çš„ä»£ç ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³å½“ç„¶è¿™æ ·å†™ä»£ç ï¼ˆé”™è¯¯çš„ï¼‰ï¼š

```cpp
int k = 2;
vector<vector<vector<int>>> dp(n, vector<vector<int>>(k + 1, vector<int>(2)));
for (int i = 0; i < n; i++) {
    if (i - 1 == -1) {
        // å¤„ç† base case
        dp[i][k][0] = 0;
        dp[i][k][1] = -prices[i];
        continue;
    }
    dp[i][k][0] = max(dp[i-1][k][0], dp[i-1][k][1] + prices[i]);
    dp[i][k][1] = max(dp[i-1][k][1], dp[i-1][k-1][0] - prices[i]);
}
return dp[n - 1][k][0];
```

ä¸ºä»€ä¹ˆé”™è¯¯ï¼Ÿæˆ‘è¿™ä¸æ˜¯ç…§ç€çŠ¶æ€è½¬ç§»æ–¹ç¨‹å†™çš„å—ï¼Ÿ

è¿˜è®°å¾—å‰é¢æ€»ç»“çš„ã€Œç©·ä¸¾æ¡†æ¶ã€å—ï¼Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¿…é¡»ç©·ä¸¾æ‰€æœ‰çŠ¶æ€ã€‚å…¶å®æˆ‘ä»¬ä¹‹å‰çš„è§£æ³•ï¼Œéƒ½åœ¨ç©·ä¸¾æ‰€æœ‰çŠ¶æ€ï¼Œåªæ˜¯ä¹‹å‰çš„é¢˜ç›®ä¸­ `k` éƒ½è¢«åŒ–ç®€æ‰äº†ã€‚

å½“ `k = 2` æ—¶ï¼Œç”±äºæ²¡æœ‰æ¶ˆæ‰ `k` çš„å½±å“ï¼Œæ‰€ä»¥å¿…é¡»è¦å¯¹ `k` è¿›è¡Œç©·ä¸¾ï¼š

```cpp
// åŸå§‹ç‰ˆæœ¬
int maxProfit_k_2(vector<int>& prices) {
    int max_k = 2, n = prices.size();
    vector<vector<vector<int>>> dp(n, vector<vector<int>>(max_k + 1, vector<int>(2)));
    for (int i = 0; i < n; i++) {
        for (int k = max_k; k >= 1; k--) {
            if (i - 1 == -1) {
                // å¤„ç† base case
                dp[i][k][0] = 0;
                dp[i][k][1] = -prices[i];
                continue;
            }
            dp[i][k][0] = max(dp[i-1][k][0], dp[i-1][k][1] + prices[i]);
            dp[i][k][1] = max(dp[i-1][k][1], dp[i-1][k-1][0] - prices[i]);
        }
    }
    // ç©·ä¸¾äº† n Ã— max_k Ã— 2 ä¸ªçŠ¶æ€ï¼Œæ­£ç¡®ã€‚
    return dp[n - 1][max_k][0];
}
```

> **è¿™é‡Œè‚¯å®šä¼šæœ‰è¯»è€…ç–‘æƒ‘ï¼Œ`k` çš„ base case æ˜¯ 0ï¼ŒæŒ‰ç†è¯´åº”è¯¥ä» `k = 1, k++` è¿™æ ·ç©·ä¸¾çŠ¶æ€ `k` æ‰å¯¹ï¼Ÿè€Œä¸”å¦‚æœä½ çœŸçš„è¿™æ ·ä»å°åˆ°å¤§éå† `k`ï¼Œæäº¤å‘ç°ä¹Ÿæ˜¯å¯ä»¥çš„**ã€‚

 `dp` æ•°ç»„çš„éå†é¡ºåºæ˜¯æ€ä¹ˆç¡®å®šçš„ï¼Œä¸»è¦æ˜¯æ ¹æ® base caseï¼Œä»¥ base case ä¸ºèµ·ç‚¹ï¼Œé€æ­¥å‘ç»“æœé è¿‘ã€‚

ä½†ä¸ºä»€ä¹ˆæˆ‘ä»å¤§åˆ°å°éå† `k` ä¹Ÿå¯ä»¥æ­£ç¡®æäº¤å‘¢ï¼Ÿå› ä¸ºä½ æ³¨æ„çœ‹ï¼Œ`dp[i][k][..]` ä¸ä¼šä¾èµ– `dp[i][k - 1][..]`ï¼Œè€Œæ˜¯ä¾èµ– `dp[i - 1][k - 1][..]`ï¼Œè€Œ `dp[i - 1][..][..]`ï¼Œéƒ½æ˜¯å·²ç»è®¡ç®—å‡ºæ¥çš„ï¼Œæ‰€ä»¥ä¸ç®¡ä½ æ˜¯ `k = max_k, k--`ï¼Œè¿˜æ˜¯ `k = 1, k++`ï¼Œéƒ½æ˜¯å¯ä»¥å¾—å‡ºæ­£ç¡®ç­”æ¡ˆçš„ã€‚

é‚£ä¸ºä»€ä¹ˆæˆ‘ä½¿ç”¨ `k = max_k, k--` çš„æ–¹å¼å‘¢ï¼Ÿå› ä¸ºè¿™æ ·ç¬¦åˆè¯­ä¹‰ï¼š

ä½ ä¹°è‚¡ç¥¨ï¼Œåˆå§‹çš„ã€ŒçŠ¶æ€ã€æ˜¯ä»€ä¹ˆï¼Ÿåº”è¯¥æ˜¯ä»ç¬¬ 0 å¤©å¼€å§‹ï¼Œè€Œä¸”è¿˜æ²¡æœ‰è¿›è¡Œè¿‡ä¹°å–ï¼Œæ‰€ä»¥æœ€å¤§äº¤æ˜“æ¬¡æ•°é™åˆ¶ `k` åº”è¯¥æ˜¯ `max_k`ï¼›è€Œéšç€ã€ŒçŠ¶æ€ã€çš„æ¨ç§»ï¼Œä½ ä¼šè¿›è¡Œäº¤æ˜“ï¼Œé‚£ä¹ˆäº¤æ˜“æ¬¡æ•°ä¸Šé™ `k` åº”è¯¥ä¸æ–­å‡å°‘ï¼Œè¿™æ ·ä¸€æƒ³ï¼Œ`k = max_k, k--` çš„æ–¹å¼æ˜¯æ¯”è¾ƒåˆä¹å®é™…åœºæ™¯çš„ã€‚

å½“ç„¶ï¼Œè¿™é‡Œ `k` å–å€¼èŒƒå›´æ¯”è¾ƒå°ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ä¸ç”¨ for å¾ªç¯ï¼Œç›´æ¥æŠŠ k = 1 å’Œ 2 çš„æƒ…å†µå…¨éƒ¨åˆ—ä¸¾å‡ºæ¥ä¹Ÿå¯ä»¥ï¼š

```cpp
// çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š
// dp[i][2][0] = max(dp[i-1][2][0], dp[i-1][2][1] + prices[i])
// dp[i][2][1] = max(dp[i-1][2][1], dp[i-1][1][0] - prices[i])
// dp[i][1][0] = max(dp[i-1][1][0], dp[i-1][1][1] + prices[i])
// dp[i][1][1] = max(dp[i-1][1][1], -prices[i])

// ç©ºé—´å¤æ‚åº¦ä¼˜åŒ–ç‰ˆæœ¬
class Solution {
public:
    int maxProfit_k_2(vector<int>& prices) {
        // base case
        int dp_i10 = 0, dp_i11 = INT_MIN;
        int dp_i20 = 0, dp_i21 = INT_MIN;
        for (int price : prices) {
            dp_i20 = max(dp_i20, dp_i21 + price);
            dp_i21 = max(dp_i21, dp_i10 - price);
            dp_i10 = max(dp_i10, dp_i11 + price);
            dp_i11 = max(dp_i11, -price);
        }
        return dp_i20;
    }
};
```

#### ç¬¬å…­é¢˜ï¼š`k` å¯ä»¥æ˜¯é¢˜ç›®ç»™å®šçš„ä»»ä½•æ•°çš„æƒ…å†µ

> é¢˜ç›®

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `prices` å’Œä¸€ä¸ªæ•´æ•° `k` ï¼Œå…¶ä¸­ `prices[i]` æ˜¯æŸæ”¯ç»™å®šçš„è‚¡ç¥¨åœ¨ç¬¬ `i` å¤©çš„ä»·æ ¼ã€‚

è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ æœ€å¤šå¯ä»¥å®Œæˆ `k` ç¬”äº¤æ˜“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ æœ€å¤šå¯ä»¥ä¹° `k` æ¬¡ï¼Œå– `k` æ¬¡ã€‚

**æ³¨æ„ï¼š**ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼šk = 2, prices = [2,4,1]
è¾“å‡ºï¼š2
è§£é‡Šï¼šåœ¨ç¬¬ 1 å¤© (è‚¡ç¥¨ä»·æ ¼ = 2) çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 2 å¤© (è‚¡ç¥¨ä»·æ ¼ = 4) çš„æ—¶å€™å–å‡ºï¼Œè¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 4-2 = 2 ã€‚
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šk = 2, prices = [3,2,6,5,0,3]
è¾“å‡ºï¼š7
è§£é‡Šï¼šåœ¨ç¬¬ 2 å¤© (è‚¡ç¥¨ä»·æ ¼ = 2) çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤© (è‚¡ç¥¨ä»·æ ¼ = 6) çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 6-2 = 4 ã€‚
     éšåï¼Œåœ¨ç¬¬ 5 å¤© (è‚¡ç¥¨ä»·æ ¼ = 0) çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 6 å¤© (è‚¡ç¥¨ä»·æ ¼ = 3) çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 3-0 = 3 ã€‚
```

**æç¤ºï¼š**

- `1 <= k <= 100`
- `1 <= prices.length <= 1000`
- `0 <= prices[i] <= 1000`

> è§£å†³

æœ‰äº†ä¸Šä¸€é¢˜ `k = 2` çš„é“ºå«ï¼Œè¿™é¢˜åº”è¯¥å’Œä¸Šä¸€é¢˜çš„ç¬¬ä¸€ä¸ªè§£æ³•æ²¡å•¥åŒºåˆ«ï¼Œä½ æŠŠä¸Šä¸€é¢˜çš„ `k = 2` æ¢æˆé¢˜ç›®è¾“å…¥çš„ `k` å°±è¡Œäº†ã€‚

ä½†è¯•ä¸€ä¸‹å‘ç°ä¼šå‡ºä¸€ä¸ªå†…å­˜è¶…é™çš„é”™è¯¯ï¼ŒåŸæ¥æ˜¯ä¼ å…¥çš„ `k` å€¼ä¼šéå¸¸å¤§ï¼Œ`dp` æ•°ç»„å¤ªå¤§äº†ã€‚é‚£ä¹ˆç°åœ¨æƒ³æƒ³ï¼Œäº¤æ˜“æ¬¡æ•° `k` æœ€å¤šæœ‰å¤šå¤§å‘¢ï¼Ÿ

ä¸€æ¬¡äº¤æ˜“ç”±ä¹°å…¥å’Œå–å‡ºæ„æˆï¼Œè‡³å°‘éœ€è¦ä¸¤å¤©ã€‚æ‰€ä»¥è¯´æœ‰æ•ˆçš„é™åˆ¶ `k` åº”è¯¥ä¸è¶…è¿‡ `n/2`ï¼Œå¦‚æœè¶…è¿‡ï¼Œå°±æ²¡æœ‰çº¦æŸä½œç”¨äº†ï¼Œç›¸å½“äº `k` æ²¡æœ‰é™åˆ¶çš„æƒ…å†µï¼Œè€Œè¿™ç§æƒ…å†µæ˜¯ä¹‹å‰è§£å†³è¿‡çš„ã€‚

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠä¹‹å‰çš„ä»£ç é‡ç”¨ï¼š

```cpp
int maxProfit_k_any(int max_k, vector<int>& prices) {
    int n = prices.size();
    if (n <= 0) {
        return 0;
    }
    if (max_k > n / 2) {
        // å¤ç”¨ä¹‹å‰äº¤æ˜“æ¬¡æ•° k æ²¡æœ‰é™åˆ¶çš„æƒ…å†µ
        return maxProfit_k_inf(prices);
    }

    // base caseï¼š
    // dp[-1][...][0] = dp[...][0][0] = 0
    // dp[-1][...][1] = dp[...][0][1] = -infinity
    vector<vector<vector<int>>> dp(n, vector<vector<int>>(max_k + 1, vector<int>(2)));
    // k = 0 æ—¶çš„ base case
    for (int i = 0; i < n; i++) {
        dp[i][0][1] = INT_MIN;
        dp[i][0][0] = 0;
    }

    for (int i = 0; i < n; i++){ 
        for (int k = max_k; k >= 1; k--) {
            if (i - 1 == -1) {
                // å¤„ç† i = -1 æ—¶çš„ base case
                dp[i][k][0] = 0;
                dp[i][k][1] = -prices[i];
                continue;
            }
            dp[i][k][0] = max(dp[i-1][k][0], dp[i-1][k][1] + prices[i]);
            dp[i][k][1] = max(dp[i-1][k][1], dp[i-1][k-1][0] - prices[i]);     
        }
    }
    return dp[n - 1][max_k][0];
}
```

### ä¸‡æ³•å½’ä¸€

**å®ç°å¦‚ä¸‹å‡½æ•°**ï¼š

```cpp
int maxProfit_all_in_one(int max_k, int[] prices, int cooldown, int fee);
```

è¾“å…¥è‚¡ç¥¨ä»·æ ¼æ•°ç»„ `prices`ï¼Œä½ æœ€å¤šè¿›è¡Œ `max_k` æ¬¡äº¤æ˜“ï¼Œæ¯æ¬¡äº¤æ˜“éœ€è¦é¢å¤–æ¶ˆè€— `fee` çš„æ‰‹ç»­è´¹ï¼Œè€Œä¸”æ¯æ¬¡äº¤æ˜“ä¹‹åéœ€è¦ç»è¿‡ `cooldown` å¤©çš„å†·å†»æœŸæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ¬¡äº¤æ˜“ï¼Œè¯·ä½ è®¡ç®—å¹¶è¿”å›å¯ä»¥è·å¾—çš„æœ€å¤§åˆ©æ¶¦ã€‚

å¾ˆå®¹æ˜“å‘ç°è¿™é“é¢˜ç›®å°±æ˜¯ä¹‹å‰æˆ‘ä»¬æ¢è®¨çš„å‡ ç§æƒ…å†µçš„ç»„åˆä½“å˜›ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦æŠŠä¹‹å‰å®ç°çš„å‡ ç§ä»£ç æºå’Œåˆ°ä¸€å—ï¼Œ**åœ¨ base case å’ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸­åŒæ—¶åŠ ä¸Š `cooldown` å’Œ `fee` çš„çº¦æŸå°±è¡Œäº†**ï¼š

```cpp
// åŒæ—¶è€ƒè™‘äº¤æ˜“æ¬¡æ•°çš„é™åˆ¶ã€å†·å†»æœŸå’Œæ‰‹ç»­è´¹
int maxProfit_all_in_one(int max_k, vector<int>& prices, int cooldown, int fee) {
    int n = prices.size();
    if (n <= 0) {
        return 0;
    }
    if (max_k > n / 2) {
        // äº¤æ˜“æ¬¡æ•° k æ²¡æœ‰é™åˆ¶çš„æƒ…å†µ
        return maxProfit_k_inf(prices, cooldown, fee);
    }

    vector<vector<vector<int>>> dp(n, vector<vector<int>>(max_k + 1, vector<int>(2)));
    // k = 0 æ—¶çš„ base case
    for (int i = 0; i < n; i++) {
        dp[i][0][1] = INT_MIN;
        dp[i][0][0] = 0;
    }

    for (int i = 0; i < n; i++) {
        for (int k = max_k; k >= 1; k--) {
            if (i - 1 == -1) {
                // base case 1
                dp[i][k][0] = 0;
                dp[i][k][1] = -prices[i] - fee;
                continue;
            }

            // åŒ…å« cooldown çš„ base case
            if (i - cooldown - 1 < 0) {
                // base case 2
                dp[i][k][0] = max(dp[i-1][k][0], dp[i-1][k][1] + prices[i]);
                // åˆ«å¿˜äº†å‡ fee
                dp[i][k][1] = max(dp[i-1][k][1], -prices[i] - fee);
                continue;
            }
            dp[i][k][0] = max(dp[i-1][k][0], dp[i-1][k][1] + prices[i]);
            // åŒæ—¶è€ƒè™‘ cooldown å’Œ fee
            dp[i][k][1] = max(dp[i-1][k][1], dp[i-cooldown-1][k-1][0] - prices[i] - fee);     
        }
    }
    return dp[n - 1][max_k][0];
}

// k æ— é™åˆ¶ï¼ŒåŒ…å«æ‰‹ç»­è´¹å’Œå†·å†»æœŸ
int maxProfit_k_inf(vector<int>& prices, int cooldown, int fee) {
    int n = prices.size();
    vector<vector<int>> dp(n, vector<int>(2));
    for (int i = 0; i < n; i++) {
        if (i - 1 == -1) {
            // base case 1
            dp[i][0] = 0;
            dp[i][1] = -prices[i] - fee;
            continue;
        }

        // åŒ…å« cooldown çš„ base case
        if (i - cooldown - 1 < 0) {
            // base case 2
            dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i]);
            // åˆ«å¿˜äº†å‡ fee
            dp[i][1] = max(dp[i-1][1], -prices[i] - fee);
            continue;
        }
        dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i]);
        // åŒæ—¶è€ƒè™‘ cooldown å’Œ fee
        dp[i][1] = max(dp[i-1][1], dp[i-cooldown-1][0] - prices[i] - fee);
    }
    return dp[n - 1][0];
}
```

æœ€åæ€»ç»“ä¸€ä¸‹å§ï¼Œæœ¬æ–‡è®²äº†å¦‚ä½•é€šè¿‡çŠ¶æ€è½¬ç§»çš„æ–¹æ³•è§£å†³å¤æ‚çš„é—®é¢˜ï¼Œç”¨ä¸€ä¸ªçŠ¶æ€è½¬ç§»æ–¹ç¨‹ç§’æ€äº† 6 é“è‚¡ç¥¨ä¹°å–é—®é¢˜ã€‚

å…³é”®å°±åœ¨äºåˆ—ä¸¾å‡ºæ‰€æœ‰å¯èƒ½çš„ã€ŒçŠ¶æ€ã€ï¼Œç„¶åæƒ³æƒ³æ€ä¹ˆç©·ä¸¾æ›´æ–°è¿™äº›ã€ŒçŠ¶æ€ã€ã€‚ä¸€èˆ¬ç”¨ä¸€ä¸ªå¤šç»´ `dp` æ•°ç»„å‚¨å­˜è¿™äº›çŠ¶æ€ï¼Œä» base case å¼€å§‹å‘åæ¨è¿›ï¼Œæ¨è¿›åˆ°æœ€åçš„çŠ¶æ€ï¼Œå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆã€‚æƒ³æƒ³è¿™ä¸ªè¿‡ç¨‹ï¼Œä½ æ˜¯ä¸æ˜¯æœ‰ç‚¹ç†è§£ã€ŒåŠ¨æ€è§„åˆ’ã€è¿™ä¸ªåè¯çš„æ„ä¹‰äº†å‘¢ï¼Ÿ

# è´ªå¿ƒç±»å‹é—®é¢˜

## è€å¸æœºåŠ æ²¹ç®—æ³•

> é¢˜ç›®

åœ¨ä¸€æ¡ç¯è·¯ä¸Šæœ‰ `n` ä¸ªåŠ æ²¹ç«™ï¼Œå…¶ä¸­ç¬¬ `i` ä¸ªåŠ æ²¹ç«™æœ‰æ±½æ²¹ `gas[i]` å‡ã€‚

ä½ æœ‰ä¸€è¾†æ²¹ç®±å®¹é‡æ— é™çš„çš„æ±½è½¦ï¼Œä»ç¬¬ `i` ä¸ªåŠ æ²¹ç«™å¼€å¾€ç¬¬ `i+1` ä¸ªåŠ æ²¹ç«™éœ€è¦æ¶ˆè€—æ±½æ²¹ `cost[i]` å‡ã€‚ä½ ä»å…¶ä¸­çš„ä¸€ä¸ªåŠ æ²¹ç«™å‡ºå‘ï¼Œå¼€å§‹æ—¶æ²¹ç®±ä¸ºç©ºã€‚

ç»™å®šä¸¤ä¸ªæ•´æ•°æ•°ç»„ `gas` å’Œ `cost` ï¼Œå¦‚æœä½ å¯ä»¥æŒ‰é¡ºåºç»•ç¯è·¯è¡Œé©¶ä¸€å‘¨ï¼Œåˆ™è¿”å›å‡ºå‘æ—¶åŠ æ²¹ç«™çš„ç¼–å·ï¼Œå¦åˆ™è¿”å› `-1` ã€‚å¦‚æœå­˜åœ¨è§£ï¼Œåˆ™ **ä¿è¯** å®ƒæ˜¯ **å”¯ä¸€** çš„ã€‚

**ç¤ºä¾‹ 1:**

```
è¾“å…¥: gas = [1,2,3,4,5], cost = [3,4,5,1,2]
è¾“å‡º: 3
è§£é‡Š:
ä» 3 å·åŠ æ²¹ç«™(ç´¢å¼•ä¸º 3 å¤„)å‡ºå‘ï¼Œå¯è·å¾— 4 å‡æ±½æ²¹ã€‚æ­¤æ—¶æ²¹ç®±æœ‰ = 0 + 4 = 4 å‡æ±½æ²¹
å¼€å¾€ 4 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 4 - 1 + 5 = 8 å‡æ±½æ²¹
å¼€å¾€ 0 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 8 - 2 + 1 = 7 å‡æ±½æ²¹
å¼€å¾€ 1 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 7 - 3 + 2 = 6 å‡æ±½æ²¹
å¼€å¾€ 2 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 6 - 4 + 3 = 5 å‡æ±½æ²¹
å¼€å¾€ 3 å·åŠ æ²¹ç«™ï¼Œä½ éœ€è¦æ¶ˆè€— 5 å‡æ±½æ²¹ï¼Œæ­£å¥½è¶³å¤Ÿä½ è¿”å›åˆ° 3 å·åŠ æ²¹ç«™ã€‚
å› æ­¤ï¼Œ3 å¯ä¸ºèµ·å§‹ç´¢å¼•ã€‚
```

**ç¤ºä¾‹ 2:**

```
è¾“å…¥: gas = [2,3,4], cost = [3,4,3]
è¾“å‡º: -1
è§£é‡Š:
ä½ ä¸èƒ½ä» 0 å·æˆ– 1 å·åŠ æ²¹ç«™å‡ºå‘ï¼Œå› ä¸ºæ²¡æœ‰è¶³å¤Ÿçš„æ±½æ²¹å¯ä»¥è®©ä½ è¡Œé©¶åˆ°ä¸‹ä¸€ä¸ªåŠ æ²¹ç«™ã€‚
æˆ‘ä»¬ä» 2 å·åŠ æ²¹ç«™å‡ºå‘ï¼Œå¯ä»¥è·å¾— 4 å‡æ±½æ²¹ã€‚ æ­¤æ—¶æ²¹ç®±æœ‰ = 0 + 4 = 4 å‡æ±½æ²¹
å¼€å¾€ 0 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 4 - 3 + 2 = 3 å‡æ±½æ²¹
å¼€å¾€ 1 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 3 - 3 + 3 = 3 å‡æ±½æ²¹
ä½ æ— æ³•è¿”å› 2 å·åŠ æ²¹ç«™ï¼Œå› ä¸ºè¿”ç¨‹éœ€è¦æ¶ˆè€— 4 å‡æ±½æ²¹ï¼Œä½†æ˜¯ä½ çš„æ²¹ç®±åªæœ‰ 3 å‡æ±½æ²¹ã€‚
å› æ­¤ï¼Œæ— è®ºæ€æ ·ï¼Œä½ éƒ½ä¸å¯èƒ½ç»•ç¯è·¯è¡Œé©¶ä¸€å‘¨ã€‚
```

**æç¤º:**

- `gas.length == n`
- `cost.length == n`
- `1 <= n <= 105`
- `0 <= gas[i], cost[i] <= 104`

> æ€è·¯

é¢˜ç›®åº”è¯¥ä¸éš¾ç†è§£ï¼Œå°±æ˜¯æ¯åˆ°è¾¾ä¸€ä¸ªç«™ç‚¹ `i`ï¼Œå¯ä»¥åŠ  `gas[i]` å‡æ²¹ï¼Œä½†ç¦»å¼€ç«™ç‚¹ `i` éœ€è¦æ¶ˆè€— `cost[i]` å‡æ²¹ï¼Œé—®ä½ ä»å“ªä¸ªç«™ç‚¹å‡ºå‘ï¼Œå¯ä»¥å…œä¸€åœˆå›æ¥ã€‚

è¦è¯´æš´åŠ›è§£æ³•ï¼Œè‚¯å®šå¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œç”¨ä¸€ä¸ª for å¾ªç¯éå†æ‰€æœ‰ç«™ç‚¹ï¼Œå‡è®¾ä¸ºèµ·ç‚¹ï¼Œç„¶åå†å¥—ä¸€å±‚ for å¾ªç¯ï¼Œåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦èƒ½å¤Ÿè½¬ä¸€åœˆå›åˆ°èµ·ç‚¹ï¼š

```cpp
int n = gas.length;
for (int start = 0; start < n; start++) {
    for (int step = 0; step < n; step++) {
        int i = (start + step) % n;
        tank += gas[i];
        tank -= cost[i];
        // åˆ¤æ–­æ²¹ç®±ä¸­çš„æ²¹æ˜¯å¦è€—å°½
    }
}
```

å¾ˆæ˜æ˜¾æ—¶é—´å¤æ‚åº¦æ˜¯ `O(N^2)`ï¼Œè¿™ä¹ˆç®€å•ç²—æš´çš„è§£æ³•ä¸€å®šä¸æ˜¯æœ€ä¼˜çš„ï¼Œæˆ‘ä»¬è¯•å›¾åˆ†æä¸€ä¸‹æ˜¯å¦æœ‰ä¼˜åŒ–çš„ä½™åœ°ã€‚

æš´åŠ›è§£æ³•æ˜¯å¦æœ‰é‡å¤è®¡ç®—çš„éƒ¨åˆ†ï¼Ÿæ˜¯å¦å¯ä»¥æŠ½è±¡å‡ºã€ŒçŠ¶æ€ã€ï¼Œæ˜¯å¦å¯¹åŒä¸€ä¸ªã€ŒçŠ¶æ€ã€é‡å¤è®¡ç®—äº†å¤šæ¬¡ï¼Ÿ

å‰æ–‡ [åŠ¨æ€è§„åˆ’è¯¦è§£](https://labuladong.online/algo/essential-technique/dynamic-programming-framework/) è¯´è¿‡ï¼Œå˜åŒ–çš„é‡å°±æ˜¯ã€ŒçŠ¶æ€ã€ã€‚é‚£ä¹ˆè§‚å¯Ÿè¿™ä¸ªæš´åŠ›ç©·ä¸¾çš„è¿‡ç¨‹ï¼Œå˜åŒ–çš„é‡æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯ã€Œèµ·ç‚¹ã€å’Œã€Œå½“å‰æ²¹ç®±çš„æ²¹é‡ã€ï¼Œä½†è¿™ä¸¤ä¸ªçŠ¶æ€çš„ç»„åˆè‚¯å®šæœ‰ä¸ä¸‹ `O(N^2)` ç§ï¼Œæ˜¾ç„¶æ²¡æœ‰ä»»ä½•ä¼˜åŒ–çš„ç©ºé—´ã€‚

**æ‰€ä»¥è¯´è¿™é“é¢˜è‚¯å®šä¸æ˜¯é€šè¿‡ç®€å•çš„å‰ªææ¥ä¼˜åŒ–æš´åŠ›è§£æ³•çš„æ•ˆç‡ï¼Œè€Œæ˜¯éœ€è¦æˆ‘ä»¬å‘ç°ä¸€äº›éšè—è¾ƒæ·±çš„è§„å¾‹ï¼Œä»è€Œå‡å°‘ä¸€äº›å†—ä½™çš„è®¡ç®—**ã€‚

### å›¾åƒè§£æ³•

æ±½è½¦è¿›å…¥ç«™ç‚¹ `i` å¯ä»¥åŠ  `gas[i]` çš„æ²¹ï¼ˆå›¾ä¸­ç»¿è‰²æ•°å­—ï¼‰ï¼Œç¦»å¼€ç«™ç‚¹ä¼šæŸè€— `cost[i]` çš„æ²¹ï¼ˆå›¾ä¸­çº¢è‰²æ•°å­—ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠç«™ç‚¹å’Œä¸å…¶ç›¸è¿çš„è·¯çœ‹åšä¸€ä¸ªæ•´ä½“ï¼Œå°† `gas[i] - cost[i]` ä½œä¸ºç»è¿‡ç«™ç‚¹ `i` çš„æ²¹é‡å˜åŒ–å€¼ï¼ˆå›¾ä¸­æ©™è‰²æ•°å­—ï¼‰ï¼š

![img](https://labuladong.online/algo/images/%E8%80%81%E5%8F%B8%E6%9C%BA/1.jpeg)

è¿™æ ·ï¼Œé¢˜ç›®æè¿°çš„åœºæ™¯å°±è¢«æŠ½è±¡æˆäº†ä¸€ä¸ªç¯å½¢æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„ç¬¬ `i` ä¸ªå…ƒç´ å°±æ˜¯ `gas[i] - cost[i]`ã€‚

**æœ‰äº†è¿™ä¸ªç¯å½¢æ•°ç»„ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­è¿™ä¸ªç¯å½¢æ•°ç»„ä¸­æ˜¯å¦èƒ½å¤Ÿæ‰¾åˆ°ä¸€ä¸ªèµ·ç‚¹ `start`ï¼Œä½¿å¾—ä»è¿™ä¸ªèµ·ç‚¹å¼€å§‹çš„ç´¯åŠ å’Œä¸€ç›´å¤§äºç­‰äº 0**ã€‚

å¦‚ä½•åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™æ ·ä¸€ä¸ªèµ·ç‚¹ `start`ï¼Ÿåˆå¦‚ä½•è®¡ç®—è¿™ä¸ªèµ·ç‚¹ `start` çš„å€¼å‘¢ï¼Ÿ

æˆ‘ä»¬ä¸å¦¨å°±æŠŠ 0 ä½œä¸ºèµ·ç‚¹ï¼Œè®¡ç®—ç´¯åŠ å’Œçš„ä»£ç éå¸¸ç®€å•ï¼š

```cpp
int n = gas.length, sum = 0;
for (int i = 0; i < n; i++) {
    // è®¡ç®—ç´¯åŠ å’Œ
    sum += gas[i] - cost[i];
}
```

ä¸Šè¿°ä»£ç çš„ `sum` å°±ç›¸å½“äºæ˜¯æ²¹ç®±ä¸­æ²¹é‡çš„å˜åŒ–ï¼Œæ¯”å¦‚ç»™ä½ è¾“å…¥è¿™ç»„æµ‹è¯•ç”¨ä¾‹ï¼š



```
gas  = [4,3,1,2,7,4]
cost = [1,2,7,3,2,5]
```

`sum` çš„å˜åŒ–è¿‡ç¨‹å°±æ˜¯è¿™æ ·çš„ï¼š

![img](https://labuladong.online/algo/images/%E8%80%81%E5%8F%B8%E6%9C%BA/2.jpeg)

é‚£ä¹ˆä½ æ˜¯å¦èƒ½æ ¹æ®è¿™å¹…å›¾ï¼Œåˆ¤æ–­æŠŠå“ªä¸€ä¸ªåŠ æ²¹ç«™ä½œä¸ºèµ·ç‚¹å‘¢ï¼Ÿ

æ˜¾ç„¶ï¼Œå°† 0 ä½œä¸ºèµ·ç‚¹è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸º `sum` åœ¨å˜åŒ–çš„è¿‡ç¨‹ä¸­å°äº 0 äº†ï¼Œä¸ç¬¦åˆæˆ‘ä»¬ã€Œç´¯åŠ å’Œä¸€ç›´å¤§äºç­‰äº 0ã€çš„è¦æ±‚ã€‚

é‚£å¦‚æœ 0 ä¸èƒ½ä½œä¸ºèµ·ç‚¹ï¼Œè°å¯ä»¥ä½œä¸ºèµ·ç‚¹å‘¢ï¼Ÿ

çœ‹å›¾è¯´è¯ï¼Œå›¾åƒçš„æœ€ä½ç‚¹æœ€æœ‰å¯èƒ½å¯ä»¥ä½œä¸ºèµ·ç‚¹ï¼š

![img](https://labuladong.online/algo/images/%E8%80%81%E5%8F%B8%E6%9C%BA/3.jpeg)

**å¦‚æœæŠŠè¿™ä¸ªã€Œæœ€ä½ç‚¹ã€ä½œä¸ºèµ·ç‚¹ï¼Œå°±æ˜¯è¯´å°†è¿™ä¸ªç‚¹ä½œä¸ºåæ ‡è½´åŸç‚¹ï¼Œå°±ç›¸å½“äºæŠŠå›¾åƒã€Œæœ€å¤§é™åº¦ã€å‘ä¸Šå¹³ç§»äº†**ã€‚

å†åŠ ä¸Šè¿™ä¸ªæ•°ç»„æ˜¯ç¯å½¢æ•°ç»„ï¼Œæœ€ä½ç‚¹å·¦ä¾§çš„å›¾åƒå¯ä»¥æ¥åˆ°å›¾åƒçš„æœ€å³ä¾§ï¼š

![img](https://labuladong.online/algo/images/%E8%80%81%E5%8F%B8%E6%9C%BA/4.jpeg)

è¿™æ ·ï¼Œæ•´ä¸ªå›¾åƒéƒ½ä¿æŒåœ¨ x è½´ä»¥ä¸Šï¼Œæ‰€ä»¥è¿™ä¸ªæœ€ä½ç‚¹ 4ï¼Œå°±æ˜¯é¢˜ç›®è¦æ±‚æˆ‘ä»¬æ‰¾çš„èµ·ç‚¹ã€‚

ä¸è¿‡ï¼Œç»è¿‡å¹³ç§»åå›¾åƒä¸€å®šå…¨éƒ¨åœ¨ x è½´ä»¥ä¸Šå—ï¼Ÿä¸ä¸€å®šï¼Œå› ä¸ºè¿˜æœ‰æ— è§£çš„æƒ…å†µï¼š

**å¦‚æœ `sum(gas[...]) < sum(cost[...])`ï¼Œæ€»æ²¹é‡å°äºæ€»çš„æ¶ˆè€—ï¼Œé‚£è‚¯å®šæ˜¯æ²¡åŠæ³•ç¯æ¸¸æ‰€æœ‰ç«™ç‚¹çš„**ã€‚

ç»¼ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºä»£ç ï¼š

```cpp
class Solution {
public:
    int canCompleteCircuit(vector<int>& gas, vector<int>& cost) {
        int n = gas.size();
        // ç›¸å½“äºå›¾åƒä¸­çš„åæ ‡ç‚¹å’Œæœ€ä½ç‚¹
        int sum = 0, minSum = 0;
        int start = 0;
        for (int i = 0; i < n; i++) {
            sum += gas[i] - cost[i];
            if (sum < minSum) {
                // ç»è¿‡ç¬¬ i ä¸ªç«™ç‚¹åï¼Œä½¿ sum åˆ°è¾¾æ–°ä½
                // æ‰€ä»¥ç«™ç‚¹ i + 1 å°±æ˜¯æœ€ä½ç‚¹ï¼ˆèµ·ç‚¹ï¼‰
                start = i + 1;
                minSum = sum;
            }
        }
        if (sum < 0) {
            // æ€»æ²¹é‡å°äºæ€»çš„æ¶ˆè€—ï¼Œæ— è§£
            return -1;
        }
        // ç¯å½¢æ•°ç»„ç‰¹æ€§
        return start == n ? 0 : start;
    }
};
```

ä»¥ä¸Šæ˜¯è§‚å¯Ÿå‡½æ•°å›¾åƒå¾—å‡ºçš„è§£æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼Œæ¯”æš´åŠ›è§£æ³•çš„æ•ˆç‡é«˜å¾ˆå¤šã€‚

### è´ªå¿ƒç®—æ³•

ç”¨è´ªå¿ƒæ€è·¯è§£å†³è¿™é“é¢˜çš„å…³é”®åœ¨äºä»¥ä¸‹è¿™ä¸ªç»“è®ºï¼š

**å¦‚æœé€‰æ‹©ç«™ç‚¹ `i` ä½œä¸ºèµ·ç‚¹ã€Œæ°å¥½ã€æ— æ³•èµ°åˆ°ç«™ç‚¹ `j`ï¼Œé‚£ä¹ˆ `i` å’Œ `j` ä¸­é—´çš„ä»»æ„ç«™ç‚¹ `k` éƒ½ä¸å¯èƒ½ä½œä¸ºèµ·ç‚¹**ã€‚

æ¯”å¦‚è¯´ï¼Œå¦‚æœä»ç«™ç‚¹ `1` å‡ºå‘ï¼Œèµ°åˆ°ç«™ç‚¹ `5` æ—¶æ²¹ç®±ä¸­çš„æ²¹é‡ã€Œæ°å¥½ã€å‡åˆ°äº†è´Ÿæ•°ï¼Œé‚£ä¹ˆè¯´æ˜ç«™ç‚¹ `1`ã€Œæ°å¥½ã€æ— æ³•åˆ°è¾¾ç«™ç‚¹ `5`ï¼›é‚£ä¹ˆä½ ä»ç«™ç‚¹ `2,3,4` ä»»æ„ä¸€ä¸ªç«™ç‚¹å‡ºå‘éƒ½æ— æ³•åˆ°è¾¾ `5`ï¼Œå› ä¸ºåˆ°è¾¾ç«™ç‚¹ `5` æ—¶æ²¹ç®±çš„æ²¹é‡ä¹Ÿå¿…ç„¶è¢«å‡åˆ°è´Ÿæ•°ã€‚

> å¦‚ä½•è¯æ˜è¿™ä¸ªç»“è®ºï¼Ÿ

å‡è®¾ `tank` è®°å½•å½“å‰æ²¹ç®±ä¸­çš„æ²¹é‡ï¼Œå¦‚æœä»ç«™ç‚¹ `i` å‡ºå‘ï¼ˆ`tank = 0`ï¼‰ï¼Œèµ°åˆ° `j` æ—¶æ°å¥½å‡ºç° `tank < 0` çš„æƒ…å†µï¼Œé‚£è¯´æ˜èµ°åˆ° `i, j` ä¹‹é—´çš„ä»»æ„ç«™ç‚¹ `k` æ—¶éƒ½æ»¡è¶³ `tank > 0`ï¼Œå¯¹å§ã€‚

å¦‚æœæŠŠ `k` ä½œä¸ºèµ·ç‚¹çš„è¯ï¼Œç›¸å½“äºåœ¨ç«™ç‚¹ `k` æ—¶ `tank = 0`ï¼Œé‚£èµ°åˆ° `j` æ—¶å¿…ç„¶æœ‰ `tank < 0`ï¼Œä¹Ÿå°±æ˜¯è¯´ `k` è‚¯å®šä¸èƒ½æ˜¯èµ·ç‚¹ã€‚

æ‹œæ‰˜ï¼Œä» `i` å‡ºå‘èµ°åˆ° `k` å¥½æ­¹ `tank > 0`ï¼Œéƒ½æ— æ³•è¾¾åˆ° `j`ï¼Œç°åœ¨ä½ è¿˜è®© `tank = 0` äº†ï¼Œé‚£æ›´ä¸å¯èƒ½èµ°åˆ° `j` äº†å¯¹å§ã€‚

**ç»¼ä¸Šï¼Œè¿™ä¸ªç»“è®ºå°±è¢«è¯æ˜äº†**ã€‚

å›æƒ³ä¸€ä¸‹æˆ‘ä»¬å¼€å¤´è¯´çš„æš´åŠ›è§£æ³•æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ

å¦‚æœæˆ‘å‘ç°ä» `i` å‡ºå‘æ— æ³•èµ°åˆ° `j`ï¼Œé‚£ä¹ˆæ˜¾ç„¶ `i` ä¸å¯èƒ½æ˜¯èµ·ç‚¹ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªæ–°è§„å¾‹ï¼Œå¯ä»¥æ¨å¯¼å‡ºä»€ä¹ˆï¼Ÿ

å¦‚æœæˆ‘å‘ç°ä» `i` å‡ºå‘æ— æ³•èµ°åˆ° `j`ï¼Œé‚£ä¹ˆ `i` ä»¥åŠ `i, j` ä¹‹é—´çš„æ‰€æœ‰ç«™ç‚¹éƒ½ä¸å¯èƒ½ä½œä¸ºèµ·ç‚¹ã€‚

çœ‹åˆ°å†—ä½™è®¡ç®—äº†å—ï¼Ÿçœ‹åˆ°ä¼˜åŒ–çš„ç‚¹äº†å—ï¼Ÿ

**è¿™å°±æ˜¯è´ªå¿ƒæ€è·¯çš„æœ¬è´¨ï¼Œå¦‚æœæ‰¾ä¸åˆ°é‡å¤è®¡ç®—ï¼Œé‚£å°±é€šè¿‡é—®é¢˜ä¸­ä¸€äº›éšè—è¾ƒæ·±çš„è§„å¾‹ï¼Œæ¥å‡å°‘å†—ä½™è®¡ç®—**ã€‚

æ ¹æ®è¿™ä¸ªç»“è®ºï¼Œå°±å¯ä»¥å†™å‡ºå¦‚ä¸‹ä»£ç ï¼š

```cpp
class Solution {
public:
    int canCompleteCircuit(vector<int>& gas, vector<int>& cost) {
        int n = gas.size();
        int sum = 0;
        for (int i = 0; i < n; i++) {
            sum += gas[i] - cost[i];
        }
        if (sum < 0) {
            // æ€»æ²¹é‡å°äºæ€»çš„æ¶ˆè€—ï¼Œæ— è§£
            return -1;
        }
        // è®°å½•æ²¹ç®±ä¸­çš„æ²¹é‡
        int tank = 0;
        // è®°å½•èµ·ç‚¹
        int start = 0;
        for (int i = 0; i < n; i++) {
            tank += gas[i] - cost[i];
            if (tank < 0) {
                // æ— æ³•ä» start åˆ°è¾¾ i + 1
                // æ‰€ä»¥ç«™ç‚¹ i + 1 åº”è¯¥æ˜¯èµ·ç‚¹
                tank = 0;
                start = i + 1;
            }
        }
        return start == n ? 0 : start;
    }
};
```

è¿™ä¸ªè§£æ³•çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(N)ï¼Œå’Œä¹‹å‰å›¾åƒæ³•çš„è§£é¢˜æ€è·¯æœ‰æ‰€ä¸åŒï¼Œä½†ä»£ç éå¸¸ç±»ä¼¼ã€‚

**å…¶å®ï¼Œä½ å¯ä»¥æŠŠè¿™ä¸ªè§£æ³•çš„æ€è·¯ç»“åˆå›¾åƒæ¥æ€è€ƒï¼Œå¯ä»¥å‘ç°å®ƒä»¬æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ç†è§£æ–¹å¼ä¸åŒè€Œå·²**ã€‚

å¯¹äºè¿™ç§è´ªå¿ƒç®—æ³•ï¼Œæ²¡æœ‰ç‰¹åˆ«å¥—è·¯åŒ–çš„æ€ç»´æ¡†æ¶ï¼Œä¸»è¦è¿˜æ˜¯é å¤šåšé¢˜å¤šæ€è€ƒï¼Œå°†é¢˜ç›®çš„åœºæ™¯è¿›è¡ŒæŠ½è±¡çš„è”æƒ³ï¼Œæ‰¾å‡ºéšè—å…¶ä¸­çš„è§„å¾‹ï¼Œä»è€Œå‡å°‘è®¡ç®—é‡ï¼Œè¿›è¡Œæ•ˆç‡ä¼˜åŒ–ã€‚



